<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introdução &mdash; Documentação do estudo de câncer colorretal</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=359c27e9"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Introdução" href="Colorretal%20-%20vivo_ano3.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Estudo Câncer Colorretal
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Bibliotecas e Funções</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Fun%C3%A7%C3%B5es.html"><strong>Importações</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Fun%C3%A7%C3%B5es.html#Funções"><strong>Funções</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Análise dos dados</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html"><strong>Leitura dos Dados</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html#Análise-dos-dados"><strong>Análise dos dados</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html#Criação-de-novas-colunas"><strong>Criação de novas colunas</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Óbito geral</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_geral.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_geral.html#Análise---Óbito-geral"><strong>Análise - Óbito geral</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Óbito por câncer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_cancer.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_cancer.html#Análise---Óbito-por-câncer"><strong>Análise - Óbito por câncer</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida um ano</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano1.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano1.html#Análise---Sobrevida-um-ano"><strong>Análise - Sobrevida um ano</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida três anos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano3.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano3.html#Análise---Sobrevida-três-anos"><strong>Análise - Sobrevida três anos</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida cinco anos</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Introdução</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#DataFrame-vivo_ano5"><strong>DataFrame vivo_ano5</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Análise---Sobrevida-cinco-anos"><strong>Análise - Sobrevida cinco anos</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Pré-processamento"><strong>Pré-processamento</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Treinamento-e-validação-dos-modelos-de-machine-learning"><strong>Treinamento e validação dos modelos de machine learning</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Naive-Bayes"><strong>Naive Bayes</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest"><strong>Random Forest</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Optuna">Optuna</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost"><strong>XGBoost</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Optuna</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ROCs"><strong>ROCs</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#RN"><strong>RN</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Importação-das-bibliotecas-e-funções"><strong>Importação das bibliotecas e funções</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Complexa"><strong>Criação e treinamento da RNA Complexa</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Residual"><strong>Criação e treinamento da RNA Residual</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Sequencial"><strong>Criação e treinamento da RNA Sequencial</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Estudo Câncer Colorretal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><strong>Introdução</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Colorretal - vivo_ano5.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Introdução">
<h1><strong>Introdução</strong><a class="headerlink" href="#Introdução" title="Permalink to this heading"></a></h1>
<p><strong>Ideia Geral</strong></p>
<p>Utilizando os dados de câncer da FOSP, somente do tipo colorretal, serão utilizados quatro modelos de machine learning diferentes, com o intuito de testar diferentes tipos de algoritmo na classificação de sobrevida por cinco anos.</p>
<p>O label é 0 se o paciente não sobreviveu após cinco anos do diagnóstico e 1 se sobreviveu.</p>
<p><strong>Modelos de ML</strong></p>
<p>Foram escolhidos os modelos Naive Bayes, que utiliza o Teorema de Bayes para realizar as previsões, Random Forest, XGBoost e LightGBM, que utilizam os conceitos de árvores de decisão, além de bagging e boosting. Além disso, será testado um modelo de votação com os melhores classificadores obtidos, visando obter um algoritmo ainda mais acertivo.</p>
<p><strong>Validação dos modelos</strong></p>
<p>Para validar os modelos treinados foi utilizada primeiramente a matriz de confusão, sendo possível avaliar os acertos em ambas as classes. Para entender de houve overfitting nos modelos, foi utilizada a curva ROC para os conjuntos de treino e teste, comparando a métrica AUC entre ambos os conjuntos.</p>
<p>Por fim, os modelos Random Forest, XGBoost e LightGBM oferecem a possibilidade de saber quais foram as features mais importantes, ou seja, que mais influenciam na previsão das classes. Assim, foram mostradas duas maneiras diferentes de analisar a importância das variáveis de entrada, uma usando a própria função dos modelos e outra usando a biblioteca SHAP, que mostra a influência das features em ambas as classes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leitura dos dados</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/colorretal_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(31916, 37)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-b8ef3aee-615b-4c04-9f37-94e890f28712">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ESCOLARI</th>
      <th>IDADE</th>
      <th>SEXO</th>
      <th>IBGE</th>
      <th>CATEATEND</th>
      <th>DIAGPREV</th>
      <th>EC</th>
      <th>ECGRUP</th>
      <th>TRATHOSP</th>
      <th>NENHUM</th>
      <th>...</th>
      <th>IBGEATEN</th>
      <th>ULTICONS</th>
      <th>ULTIDIAG</th>
      <th>ULTITRAT</th>
      <th>obito_geral</th>
      <th>obito_cancer</th>
      <th>vivo_ano1</th>
      <th>vivo_ano3</th>
      <th>vivo_ano5</th>
      <th>ESCOLARI_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4</td>
      <td>19</td>
      <td>2</td>
      <td>3538709</td>
      <td>9</td>
      <td>2</td>
      <td>IV</td>
      <td>IV</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3538709</td>
      <td>4985</td>
      <td>4985</td>
      <td>4951</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9</td>
      <td>19</td>
      <td>1</td>
      <td>3537107</td>
      <td>2</td>
      <td>2</td>
      <td>IIIA</td>
      <td>III</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3509502</td>
      <td>2680</td>
      <td>2744</td>
      <td>2674</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>19</td>
      <td>1</td>
      <td>3516200</td>
      <td>9</td>
      <td>2</td>
      <td>IIB</td>
      <td>II</td>
      <td>F</td>
      <td>0</td>
      <td>...</td>
      <td>3516200</td>
      <td>4725</td>
      <td>4734</td>
      <td>4719</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 37 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b8ef3aee-615b-4c04-9f37-94e890f28712')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b8ef3aee-615b-4c04-9f37-94e890f28712 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b8ef3aee-615b-4c04-9f37-94e890f28712');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Valores faltantes</span>
<span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ESCOLARI     0
CONSDIAG     0
DIAGTRAT     0
ANODIAG      0
FAIXAETAR    0
DRS          0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlação com a saída</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
The default value of numeric_only in DataFrame.corr is deprecated. In a future version, it will default to False. Select only valid columns or specify the value of numeric_only to silence this warning.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano5       1.000000
ULTIDIAG        0.831968
ULTITRAT        0.829350
ULTICONS        0.829178
vivo_ano3       0.698727
vivo_ano1       0.369942
obito_cancer    0.365039
obito_geral     0.344902
ANODIAG         0.303518
CIRURGIA        0.166547
ULTINFO         0.155014
CATEATEND       0.141150
OUTROS          0.114849
IDADE           0.079483
DIAGPREV        0.043418
SEXO            0.034478
HORMONIO        0.031212
IBGEATEN        0.029063
RECNENHUM       0.028075
NENHUM          0.025816
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quantidade de pacientes em cada classe da saída</span>
<span class="n">df</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    23394
1     8522
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<section id="DataFrame-vivo_ano5">
<h2><strong>DataFrame vivo_ano5</strong><a class="headerlink" href="#DataFrame-vivo_ano5" title="Permalink to this heading"></a></h2>
<p>Antes de realizar o pré-processamento dos dados é necessário filtrar os dados, de modo a retirar pacientes que não foram acompanhados por pelo menos <strong>cinco anos</strong> e que a última informação consta como vivos.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dataset da sobrevida de cinco anos</span>
<span class="n">df_ano5</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">obito_geral</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_ano5</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(23338, 37)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_ano5</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-a130f291-7275-43c8-ad9c-5194659142ca">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ESCOLARI</th>
      <th>IDADE</th>
      <th>SEXO</th>
      <th>IBGE</th>
      <th>CATEATEND</th>
      <th>DIAGPREV</th>
      <th>EC</th>
      <th>ECGRUP</th>
      <th>TRATHOSP</th>
      <th>NENHUM</th>
      <th>...</th>
      <th>IBGEATEN</th>
      <th>ULTICONS</th>
      <th>ULTIDIAG</th>
      <th>ULTITRAT</th>
      <th>obito_geral</th>
      <th>obito_cancer</th>
      <th>vivo_ano1</th>
      <th>vivo_ano3</th>
      <th>vivo_ano5</th>
      <th>ESCOLARI_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4</td>
      <td>19</td>
      <td>2</td>
      <td>3538709</td>
      <td>9</td>
      <td>2</td>
      <td>IV</td>
      <td>IV</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3538709</td>
      <td>4985</td>
      <td>4985</td>
      <td>4951</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9</td>
      <td>19</td>
      <td>1</td>
      <td>3537107</td>
      <td>2</td>
      <td>2</td>
      <td>IIIA</td>
      <td>III</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3509502</td>
      <td>2680</td>
      <td>2744</td>
      <td>2674</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>19</td>
      <td>1</td>
      <td>3516200</td>
      <td>9</td>
      <td>2</td>
      <td>IIB</td>
      <td>II</td>
      <td>F</td>
      <td>0</td>
      <td>...</td>
      <td>3516200</td>
      <td>4725</td>
      <td>4734</td>
      <td>4719</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 37 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-a130f291-7275-43c8-ad9c-5194659142ca')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-a130f291-7275-43c8-ad9c-5194659142ca button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-a130f291-7275-43c8-ad9c-5194659142ca');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
</section>
</section>
<section id="Análise---Sobrevida-cinco-anos">
<h1><strong>Análise - Sobrevida cinco anos</strong><a class="headerlink" href="#Análise---Sobrevida-cinco-anos" title="Permalink to this heading"></a></h1>
<section id="Pré-processamento">
<h2><strong>Pré-processamento</strong><a class="headerlink" href="#Pré-processamento" title="Permalink to this heading"></a></h2>
<p>Como o dataset já foi limpo anteriormente, aqui na etapa de pré-processamento serão realizadas a divisão dos dados em treino e teste, a codificação das colunas textuais para colunas numéricas e a normalização dos dados. Com isso, temos os dados prontos para o treinamento dos modelos de machine learning e consequentemente sua validação.</p>
<p>Neste primeiro momento, serão definidas as colunas que não serão utilizadas como features, assim, foi escolhido manter a coluna <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, então a coluna <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code> será retirada. O mesmo ocorre com a coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code>, retirando a coluna <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>. Por fim, as outras colunas contidas na <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> são possíveis saídas para os modelos, mas estamos interessados somente na sobrevida de cinco anos, por isso só ela será mantida como label e as outras serão retiradas.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_geral&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_cancer&#39;</span><span class="p">,</span> <span class="s1">&#39;ECGRUP&#39;</span><span class="p">,</span> <span class="s1">&#39;ESCOLARI&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano5&#39;</span>
</pre></div>
</div>
</div>
<p>Uma função foi criada para realizar o pré-processamento inteiro, chamada <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, internamente ela utiliza outras funções criadas que são: <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divide os dados em treino e teste), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (prepara os dados de treino) e <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (prepara os dados de teste).</p>
<blockquote>
<div><p>Mais detalhes em <a class="reference external" href="https://colorectal-site.readthedocs.io/en/latest/Fun%C3%A7%C3%B5es.html#Fun%C3%A7%C3%B5es">funções</a>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">,</span> <span class="n">enc</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_ano5</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                       <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                       <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                       <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                       <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">,</span>
                                                                       <span class="n">return_enc_norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (17503, 25), X_test = (5835, 25)
y_train = (17503,), y_test = (5835,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    0.634863
1    0.365137
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    0.63479
1    0.36521
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
</section>
<section id="Treinamento-e-validação-dos-modelos-de-machine-learning">
<h2><strong>Treinamento e validação dos modelos de machine learning</strong><a class="headerlink" href="#Treinamento-e-validação-dos-modelos-de-machine-learning" title="Permalink to this heading"></a></h2>
<p>Depois das etapas de preparação, os dados estão prontos para serem utilizados nos modelos escolhidos.</p>
<section id="Naive-Bayes">
<h3><strong>Naive Bayes</strong><a class="headerlink" href="#Naive-Bayes" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo Naive Bayes</span>
<span class="n">nb</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GaussianNB()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">GaussianNB</label><div class="sk-toggleable__content"><pre>GaussianNB()</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_21_0.png" src="_images/Colorretal_-_vivo_ano5_21_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.769     0.003     0.005      3704
           1      0.366     0.999     0.535      2131

    accuracy                          0.366      5835
   macro avg      0.567     0.501     0.270      5835
weighted avg      0.622     0.366     0.199      5835

</pre></div></div>
</div>
<blockquote>
<div><p>Claramente percebe-se que o modelo previu quase todos os dados como sendo da classe 1, portanto não teve um aprendizado satisfatório.</p>
</div></blockquote>
<blockquote>
<div><p>Na matriz de confusão, buscamos uma diagonal principal equilibrada e com a maior acertividade possível.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_23_0.png" src="_images/Colorretal_-_vivo_ano5_23_0.png" />
</div>
</div>
<blockquote>
<div><p>Pelas curvas ROC, pode-se dizer que não há overfitting, mas o modelo é ruim para a previsão da classe 0, portanto qualquer análise além dessa não possui tanta relevância.</p>
</div></blockquote>
</section>
<section id="Random-Forest">
<h3><strong>Random Forest</strong><a class="headerlink" href="#Random-Forest" title="Permalink to this heading"></a></h3>
<p>O modelo Random Forest é mais complexo em relação ao Naive Bayes, assim alguns hiperparâmetros serão definidos para obter um modelo base e depois será realizada a busca dos melhores parâmetros utilizando o Optuna.</p>
<p>Os parâmetros definidos para este primeiro modelo serão:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code>: para repetibilidade do treinamento do modelo. Será utilizado na busca pelos hiperparâmetros também, sempre como mesmo valor definido na variável <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: será definido como 8, pois o padrão do modelo é não ter profundidade máxima para as árvores, o que dificulta e faz o treinamento ser muito longo, além da maior chance de overfitting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class_weight</span></code>: usado para definir os pesos de cada classe no treinamento do modelo, muito útil quando temos classes desbalanceadas no conjunto de dados, como neste caso.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo RandomForest</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                            <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.206</span><span class="p">},</span>
                            <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                            <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">)</span>

<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(class_weight={0: 1, 1: 1.206}, criterion=&#x27;entropy&#x27;,
                       max_depth=8, random_state=10)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(class_weight={0: 1, 1: 1.206}, criterion=&#x27;entropy&#x27;,
                       max_depth=8, random_state=10)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_28_0.png" src="_images/Colorretal_-_vivo_ano5_28_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.851     0.768     0.807      3704
           1      0.655     0.767     0.707      2131

    accuracy                          0.767      5835
   macro avg      0.753     0.767     0.757      5835
weighted avg      0.780     0.767     0.771      5835

</pre></div></div>
</div>
<blockquote>
<div><p>A matriz obtida para o modelo Random Forest apresentou diagonal equilibrada em ambas as classes, com 77% de acurácia.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_30_0.png" src="_images/Colorretal_-_vivo_ano5_30_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_31_0.png" src="_images/Colorretal_-_vivo_ano5_31_0.png" />
</div>
</div>
<blockquote>
<div><p>Como a métrica AUC possui valores próximos para o conjunto de treino e de teste, 0,871 e 0,848 respectivamente, pode-se dizer que há apenas um pouco de overfitting, não sendo algo de grande preocupação.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features</span>
<span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_33_0.png" src="_images/Colorretal_-_vivo_ano5_33_0.png" />
</div>
</div>
<blockquote>
<div><p>As features mais importantes nesta visualização são <code class="docutils literal notranslate"><span class="pre">EC</span></code>, com uma grande vantagem, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> e <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No data for colormapping provided via &#39;c&#39;. Parameters &#39;vmin&#39;, &#39;vmax&#39; will be ignored
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_35_1.png" src="_images/Colorretal_-_vivo_ano5_35_1.png" />
</div>
</div>
<p>A coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code> foi a mais importante, com isso, os valores mais altos desta variável, mostrados em rosa, influenciaram mais o modelo na previsão da classe 0 (não sobreviveu ao quinto ano após o diagnóstico). Já os valores mais baixos desta coluna, em azul, tem mais peso para previsão ser da classe 1. Este comportamento faz sentido, pois quanto mais alto o estágio, maior é a extensão do câncer, assim menor a chance de sobrevivência.</p>
<p>O raciocínio para analisar as outras colunas é o mesmo utilizado para o estadiamento clínico.</p>
<section id="Optuna">
<h4>Optuna<a class="headerlink" href="#Optuna" title="Permalink to this heading"></a></h4>
<p>Para fazer a busca pelos melhores hiperparâmetros, será utilizado a biblioteca Optuna, definindo o intervalo para os parâmetros do modelo a serem buscados.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Folds com a mesma proporção das classes</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função com o modelos e seus parâmetros, que terá sua métrica maximizada</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">min_samples_split</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">max_samples</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;max_samples&#39;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;criterion&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">])</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                                 <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">,</span>
                                 <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                                 <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                           <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação do estudo e procura pelos hiperparâmetros</span>
<span class="n">studyRF</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhor tentativa</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">best_trial</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FrozenTrial(number=84, state=TrialState.COMPLETE, values=[0.7525312729217559], datetime_start=datetime.datetime(2023, 4, 11, 20, 8, 45, 704682), datetime_complete=datetime.datetime(2023, 4, 11, 20, 9, 3, 809034), params={&#39;n_estimators&#39;: 110, &#39;max_depth&#39;: 15, &#39;min_samples_split&#39;: 4, &#39;min_samples_leaf&#39;: 1, &#39;max_samples&#39;: 0.7, &#39;criterion&#39;: &#39;gini&#39;}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={&#39;n_estimators&#39;: IntDistribution(high=250, log=False, low=50, step=1), &#39;max_depth&#39;: IntDistribution(high=18, log=False, low=3, step=1), &#39;min_samples_split&#39;: IntDistribution(high=10, log=False, low=2, step=1), &#39;min_samples_leaf&#39;: IntDistribution(high=7, log=False, low=1, step=1), &#39;max_samples&#39;: FloatDistribution(high=1.0, log=False, low=0.7, step=0.1), &#39;criterion&#39;: CategoricalDistribution(choices=(&#39;gini&#39;, &#39;entropy&#39;))}, trial_id=84, value=None)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhores parâmetros</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;n_estimators&#39;: 110,
 &#39;max_depth&#39;: 15,
 &#39;min_samples_split&#39;: 4,
 &#39;min_samples_leaf&#39;: 1,
 &#39;max_samples&#39;: 0.7,
 &#39;criterion&#39;: &#39;gini&#39;}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">studyRF</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modelo com os melhores parâmetros</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">studyRF</span><span class="o">.</span><span class="n">best_params</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;random_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;class_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.76</span><span class="p">}</span>

<span class="n">rf_optuna</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rf_optuna</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="n">rf_optuna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-7 {color: black;background-color: white;}#sk-container-id-7 pre{padding: 0;}#sk-container-id-7 div.sk-toggleable {background-color: white;}#sk-container-id-7 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-7 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-7 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-7 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-7 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-7 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-7 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-7 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-7 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-7 div.sk-item {position: relative;z-index: 1;}#sk-container-id-7 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-7 div.sk-item::before, #sk-container-id-7 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-7 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-7 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-7 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-7 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-7 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-7 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-7 div.sk-label-container {text-align: center;}#sk-container-id-7 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-7 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(class_weight={0: 1, 1: 1.76}, max_depth=15,
                       max_samples=0.7, min_samples_split=4, n_estimators=110,
                       random_state=10)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" checked><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(class_weight={0: 1, 1: 1.76}, max_depth=15,
                       max_samples=0.7, min_samples_split=4, n_estimators=110,
                       random_state=10)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão do modelo Random Forest otimizado</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_46_0.png" src="_images/Colorretal_-_vivo_ano5_46_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.855     0.771     0.811      3704
           1      0.660     0.772     0.711      2131

    accuracy                          0.771      5835
   macro avg      0.757     0.771     0.761      5835
weighted avg      0.783     0.771     0.774      5835

</pre></div></div>
</div>
<blockquote>
<div><p>Há uma melhora de acurácia em relação ao primeiro modelo testado, passando um pouco de 77%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC do modelo otimizado</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_48_0.png" src="_images/Colorretal_-_vivo_ano5_48_0.png" />
</div>
</div>
<blockquote>
<div><p>A curva ROC mostra que o modelo possui overfitting, pois para o conjunto de treino temos AUC = 0,969 e para o teste AUC = 0,853, essa diferença caracteriza o problema.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No data for colormapping provided via &#39;c&#39;. Parameters &#39;vmin&#39;, &#39;vmax&#39; will be ignored
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_50_1.png" src="_images/Colorretal_-_vivo_ano5_50_1.png" />
</div>
</div>
</section>
</section>
<section id="XGBoost">
<h3><strong>XGBoost</strong><a class="headerlink" href="#XGBoost" title="Permalink to this heading"></a></h3>
<p>O modelo XGBoost também terá alguns hiperparâmetros definidos para obter um modelo base e depois será realizada a busca dos melhores parâmetros utilizando o Optuna.</p>
<p>Os parâmetros definidos para este primeiro modelo serão:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code>: para repetibilidade do treinamento do modelo. Será utilizado na busca pelos hiperparâmetros também, sempre como mesmo valor definido na variável <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: será utilizado o padrão, com valor 3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>: usado para definir o peso da classe 1 no treinamento do modelo, pois temos classes desbalanceadas.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo XGBoost</span>
<span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.29</span><span class="p">,</span>
                    <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=3, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=3, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_54_0.png" src="_images/Colorretal_-_vivo_ano5_54_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.856     0.774     0.813      3704
           1      0.663     0.774     0.714      2131

    accuracy                          0.774      5835
   macro avg      0.760     0.774     0.764      5835
weighted avg      0.786     0.774     0.777      5835

</pre></div></div>
</div>
<blockquote>
<div><p>A matriz obtida para o modelo XGBoost apresentou diagonal equilibrada em ambas as classes, com 77% de acurácia.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_56_0.png" src="_images/Colorretal_-_vivo_ano5_56_0.png" />
</div>
</div>
<blockquote>
<div><p>Como a métrica AUC possui valores próximos para o conjunto de treino e de teste, 0,879 e 0,855 respectivamente, pode-se dizer que há apenas um pouco de overfitting, não sendo algo de grande preocupação.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features</span>
<span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_58_0.png" src="_images/Colorretal_-_vivo_ano5_58_0.png" />
</div>
</div>
<blockquote>
<div><p>As features mais importantes nesta visualização são <code class="docutils literal notranslate"><span class="pre">EC</span></code>, com uma boa vantagem, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code> e <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_60_0.png" src="_images/Colorretal_-_vivo_ano5_60_0.png" />
</div>
</div>
<p>A coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code> foi a mais importante aqui também, com isso, os valores mais altos desta variável, mostrados em rosa, influenciaram mais o modelo na previsão da classe 0 (não sobreviveu ao quinto ano após o diagnóstico). Já os valores mais baixos desta coluna, em azul, tem mais peso para previsão ser da classe 1. Este comportamento faz sentido, pois quanto mais alto o estágio, maior é a extensão do câncer, assim menor a chance de sobrevivência.</p>
<p>O raciocínio para analisar as outras colunas é o mesmo utilizado para o estadiamento clínico.</p>
<section id="id1">
<h4>Optuna<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h4>
<p>Para fazer a busca pelos melhores hiperparâmetros, será utilizado a biblioteca Optuna, definindo o intervalo para os parâmetros do modelo a serem buscados.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Folds com a mesma proporção das classes</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função com o modelos e seus parâmetros, que terá sua métrica maximizada</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">min_child_weight</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_child_weight&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">colsample_bytree</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;colsample_bytree&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
                        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                        <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
                        <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                        <span class="n">min_child_weight</span><span class="o">=</span><span class="n">min_child_weight</span><span class="p">,</span>
                        <span class="n">colsample_bytree</span><span class="o">=</span><span class="n">colsample_bytree</span><span class="p">,</span>
                        <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                           <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação do estudo e procura pelos hiperparâmetros</span>
<span class="n">studyXGB</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhor tentativa</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">best_trial</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FrozenTrial(number=39, state=TrialState.COMPLETE, values=[0.7584416783669388], datetime_start=datetime.datetime(2023, 4, 11, 20, 32, 30, 674575), datetime_complete=datetime.datetime(2023, 4, 11, 20, 32, 45, 890037), params={&#39;n_estimators&#39;: 162, &#39;max_depth&#39;: 4, &#39;learning_rate&#39;: 0.1, &#39;gamma&#39;: 0.1, &#39;min_child_weight&#39;: 4, &#39;colsample_bytree&#39;: 0.7}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={&#39;n_estimators&#39;: IntDistribution(high=250, log=False, low=50, step=1), &#39;max_depth&#39;: IntDistribution(high=18, log=False, low=3, step=1), &#39;learning_rate&#39;: FloatDistribution(high=0.2, log=False, low=0.05, step=0.05), &#39;gamma&#39;: FloatDistribution(high=0.3, log=False, low=0.0, step=0.1), &#39;min_child_weight&#39;: IntDistribution(high=7, log=False, low=1, step=1), &#39;colsample_bytree&#39;: FloatDistribution(high=0.7, log=False, low=0.3, step=0.1)}, trial_id=39, value=None)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhores parâmetros</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;n_estimators&#39;: 162,
 &#39;max_depth&#39;: 4,
 &#39;learning_rate&#39;: 0.1,
 &#39;gamma&#39;: 0.1,
 &#39;min_child_weight&#39;: 4,
 &#39;colsample_bytree&#39;: 0.7}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">studyXGB</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modelo com os melhores parâmetros</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">studyXGB</span><span class="o">.</span><span class="n">best_params</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;random_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;scale_pos_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.27</span>

<span class="n">xgb_optuna</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">xgb_optuna</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="n">xgb_optuna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-11 {color: black;background-color: white;}#sk-container-id-11 pre{padding: 0;}#sk-container-id-11 div.sk-toggleable {background-color: white;}#sk-container-id-11 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-11 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-11 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-11 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-11 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-11 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-11 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-11 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-11 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-11 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-11 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-11 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-11 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-11 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-11 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-11 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-11 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-11 div.sk-item {position: relative;z-index: 1;}#sk-container-id-11 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-11 div.sk-item::before, #sk-container-id-11 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-11 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-11 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-11 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-11 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-11 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-11 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-11 div.sk-label-container {text-align: center;}#sk-container-id-11 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-11 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-11" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.7, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.1, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.1, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=162, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" checked><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.7, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.1, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.1, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=162, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão do modelo XGBoost otimizado</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_71_0.png" src="_images/Colorretal_-_vivo_ano5_71_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.860     0.778     0.817      3704
           1      0.669     0.779     0.720      2131

    accuracy                          0.778      5835
   macro avg      0.764     0.779     0.768      5835
weighted avg      0.790     0.778     0.781      5835

</pre></div></div>
</div>
<blockquote>
<div><p>Após a escolha dos hiperparâmetros, a acurácia do modelo otimizado aumentou um pouco em relação ao modelo inicial, de 77% para aproximadamente 78%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC do modelo otimizado</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_73_0.png" src="_images/Colorretal_-_vivo_ano5_73_0.png" />
</div>
</div>
<blockquote>
<div><p>A curva ROC mostra que o modelo possui um pouco de overfitting, pois para o conjunto de treino temos AUC = 0,882 e para o teste AUC = 0,858, essa diferença caracteriza o problema.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_75_0.png" src="_images/Colorretal_-_vivo_ano5_75_0.png" />
</div>
</div>
</section>
</section>
<section id="ROCs">
<h3><strong>ROCs</strong><a class="headerlink" href="#ROCs" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Treino</span>
<span class="n">roc_together</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">rf_optuna</span><span class="p">,</span> <span class="n">xgb_optuna</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_77_0.png" src="_images/Colorretal_-_vivo_ano5_77_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Teste</span>
<span class="n">roc_together</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">rf_optuna</span><span class="p">,</span> <span class="n">xgb_optuna</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_78_0.png" src="_images/Colorretal_-_vivo_ano5_78_0.png" />
</div>
</div>
</section>
</section>
<section id="RN">
<h2><strong>RN</strong><a class="headerlink" href="#RN" title="Permalink to this heading"></a></h2>
<section id="Importação-das-bibliotecas-e-funções">
<h3><strong>Importação das bibliotecas e funções</strong><a class="headerlink" href="#Importação-das-bibliotecas-e-funções" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.regularizers</span> <span class="kn">import</span> <span class="n">l2</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definição de cores para gráficos</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot metrics after training the RNA.</span>

<span class="sd">    :param history: RNA training history.</span>

<span class="sd">    :return: no value</span>
<span class="sd">    :rtype: none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">metric</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span> <span class="n">metric</span><span class="p">],</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Val&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;loss&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Complexa">
<h3><strong>Criação e treinamento da RNA Complexa</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Complexa" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">neg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="n">pos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exemplos:</span><span class="se">\n</span><span class="s1"> Total: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="se">\n</span><span class="s1"> Positivos: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">pos</span><span class="o">/</span><span class="n">total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">% do total)&#39;</span><span class="p">)</span>

<span class="c1"># Cálculo dos pesos das duas classe</span>
<span class="n">weight_for_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">neg</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">weight_for_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pos</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

<span class="c1"># Dicionário de pesos das classes para treinamento</span>
<span class="n">class_weight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">weight_for_0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">weight_for_1</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 0: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 1: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Exemplos:
 Total: 17503
 Positivos: 6391 (36.51% do total)
Peso da classe 0: 0.79
Peso da classe 1: 1.37
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;input_features&#39;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;selu&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Concatenate</span>
<span class="n">x_concat</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">()([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">input_features</span><span class="p">])</span>

<span class="n">x4</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">x_concat</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;out_dense&#39;</span><span class="p">)(</span><span class="n">x4</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">input_features</span><span class="p">],</span>
                    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">out</span><span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model&#34;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to
==================================================================================================
 input_features (InputLayer)    [(None, 25)]         0           []

 dense (Dense)                  (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 dense_1 (Dense)                (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 dense_2 (Dense)                (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 concatenate (Concatenate)      (None, 409)          0           [&#39;dense[0][0]&#39;,
                                                                  &#39;dense_1[0][0]&#39;,
                                                                  &#39;dense_2[0][0]&#39;,
                                                                  &#39;input_features[0][0]&#39;]

 dense_3 (Dense)                (None, 32)           13120       [&#39;concatenate[0][0]&#39;]

 out_dense (Dense)              (None, 1)            33          [&#39;dense_3[0][0]&#39;]

==================================================================================================
Total params: 23,137
Trainable params: 23,137
Non-trainable params: 0
__________________________________________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_89_0.png" src="_images/Colorretal_-_vivo_ano5_89_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
547/547 - 5s - loss: 0.9303 - accuracy: 0.7163 - precision: 0.5845 - recall: 0.7708 - auc: 0.7998 - val_loss: 0.5926 - val_accuracy: 0.7244 - val_precision: 0.5884 - val_recall: 0.8165 - val_auc: 0.8197 - 5s/epoch - 9ms/step
Epoch 2/50
547/547 - 2s - loss: 0.5619 - accuracy: 0.7270 - precision: 0.5959 - recall: 0.7838 - auc: 0.8147 - val_loss: 0.5467 - val_accuracy: 0.7323 - val_precision: 0.5971 - val_recall: 0.8207 - val_auc: 0.8283 - 2s/epoch - 3ms/step
Epoch 3/50
547/547 - 2s - loss: 0.5443 - accuracy: 0.7277 - precision: 0.5962 - recall: 0.7880 - auc: 0.8184 - val_loss: 0.5559 - val_accuracy: 0.7229 - val_precision: 0.5820 - val_recall: 0.8564 - val_auc: 0.8335 - 2s/epoch - 3ms/step
Epoch 4/50
547/547 - 2s - loss: 0.5375 - accuracy: 0.7288 - precision: 0.5973 - recall: 0.7899 - auc: 0.8221 - val_loss: 0.5198 - val_accuracy: 0.7520 - val_precision: 0.6292 - val_recall: 0.7818 - val_auc: 0.8342 - 2s/epoch - 3ms/step
Epoch 5/50
547/547 - 2s - loss: 0.5330 - accuracy: 0.7330 - precision: 0.6015 - recall: 0.7958 - auc: 0.8242 - val_loss: 0.5148 - val_accuracy: 0.7587 - val_precision: 0.6467 - val_recall: 0.7480 - val_auc: 0.8338 - 2s/epoch - 4ms/step
Epoch 6/50
547/547 - 3s - loss: 0.5298 - accuracy: 0.7364 - precision: 0.6054 - recall: 0.7988 - auc: 0.8267 - val_loss: 0.6082 - val_accuracy: 0.6893 - val_precision: 0.5446 - val_recall: 0.9108 - val_auc: 0.8354 - 3s/epoch - 5ms/step
Epoch 7/50
547/547 - 2s - loss: 0.5304 - accuracy: 0.7349 - precision: 0.6035 - recall: 0.7985 - auc: 0.8269 - val_loss: 0.5275 - val_accuracy: 0.7464 - val_precision: 0.6118 - val_recall: 0.8358 - val_auc: 0.8372 - 2s/epoch - 4ms/step
Epoch 8/50
547/547 - 2s - loss: 0.5247 - accuracy: 0.7375 - precision: 0.6063 - recall: 0.8014 - auc: 0.8306 - val_loss: 0.5277 - val_accuracy: 0.7417 - val_precision: 0.6089 - val_recall: 0.8189 - val_auc: 0.8346 - 2s/epoch - 3ms/step
Epoch 9/50
547/547 - 2s - loss: 0.5236 - accuracy: 0.7377 - precision: 0.6068 - recall: 0.8000 - auc: 0.8299 - val_loss: 0.5181 - val_accuracy: 0.7482 - val_precision: 0.6209 - val_recall: 0.7977 - val_auc: 0.8344 - 2s/epoch - 3ms/step
Epoch 10/50
547/547 - 2s - loss: 0.5246 - accuracy: 0.7366 - precision: 0.6059 - recall: 0.7972 - auc: 0.8290 - val_loss: 0.5015 - val_accuracy: 0.7604 - val_precision: 0.6431 - val_recall: 0.7729 - val_auc: 0.8390 - 2s/epoch - 3ms/step
Epoch 11/50
547/547 - 2s - loss: 0.5188 - accuracy: 0.7391 - precision: 0.6080 - recall: 0.8032 - auc: 0.8329 - val_loss: 0.5049 - val_accuracy: 0.7573 - val_precision: 0.6409 - val_recall: 0.7630 - val_auc: 0.8353 - 2s/epoch - 3ms/step
Epoch 12/50
547/547 - 2s - loss: 0.5181 - accuracy: 0.7419 - precision: 0.6106 - recall: 0.8093 - auc: 0.8330 - val_loss: 0.5194 - val_accuracy: 0.7446 - val_precision: 0.6118 - val_recall: 0.8231 - val_auc: 0.8393 - 2s/epoch - 3ms/step
Epoch 13/50
547/547 - 2s - loss: 0.5158 - accuracy: 0.7444 - precision: 0.6142 - recall: 0.8068 - auc: 0.8351 - val_loss: 0.5778 - val_accuracy: 0.7009 - val_precision: 0.5556 - val_recall: 0.9052 - val_auc: 0.8418 - 2s/epoch - 3ms/step
Epoch 14/50
547/547 - 3s - loss: 0.5165 - accuracy: 0.7418 - precision: 0.6110 - recall: 0.8061 - auc: 0.8345 - val_loss: 0.5227 - val_accuracy: 0.7433 - val_precision: 0.6090 - val_recall: 0.8297 - val_auc: 0.8377 - 3s/epoch - 5ms/step
Epoch 15/50
547/547 - 2s - loss: 0.5137 - accuracy: 0.7415 - precision: 0.6098 - recall: 0.8115 - auc: 0.8360 - val_loss: 0.4938 - val_accuracy: 0.7704 - val_precision: 0.6689 - val_recall: 0.7349 - val_auc: 0.8402 - 2s/epoch - 4ms/step
Epoch 16/50
547/547 - 2s - loss: 0.5132 - accuracy: 0.7459 - precision: 0.6156 - recall: 0.8100 - auc: 0.8362 - val_loss: 0.4992 - val_accuracy: 0.7611 - val_precision: 0.6449 - val_recall: 0.7696 - val_auc: 0.8395 - 2s/epoch - 3ms/step
Epoch 17/50
547/547 - 2s - loss: 0.5138 - accuracy: 0.7423 - precision: 0.6112 - recall: 0.8085 - auc: 0.8355 - val_loss: 0.5188 - val_accuracy: 0.7498 - val_precision: 0.6161 - val_recall: 0.8353 - val_auc: 0.8407 - 2s/epoch - 3ms/step
Epoch 18/50
547/547 - 2s - loss: 0.5092 - accuracy: 0.7438 - precision: 0.6131 - recall: 0.8088 - auc: 0.8382 - val_loss: 0.5404 - val_accuracy: 0.7347 - val_precision: 0.5932 - val_recall: 0.8710 - val_auc: 0.8404 - 2s/epoch - 3ms/step
Epoch 19/50
547/547 - 2s - loss: 0.5094 - accuracy: 0.7468 - precision: 0.6165 - recall: 0.8111 - auc: 0.8375 - val_loss: 0.5021 - val_accuracy: 0.7609 - val_precision: 0.6366 - val_recall: 0.8048 - val_auc: 0.8441 - 2s/epoch - 4ms/step
Epoch 20/50
547/547 - 2s - loss: 0.5073 - accuracy: 0.7441 - precision: 0.6134 - recall: 0.8091 - auc: 0.8393 - val_loss: 0.5061 - val_accuracy: 0.7582 - val_precision: 0.6370 - val_recall: 0.7855 - val_auc: 0.8386 - 2s/epoch - 3ms/step
Epoch 21/50
547/547 - 2s - loss: 0.5090 - accuracy: 0.7444 - precision: 0.6145 - recall: 0.8050 - auc: 0.8382 - val_loss: 0.5041 - val_accuracy: 0.7568 - val_precision: 0.6303 - val_recall: 0.8081 - val_auc: 0.8433 - 2s/epoch - 4ms/step
Epoch 22/50
547/547 - 3s - loss: 0.5063 - accuracy: 0.7503 - precision: 0.6209 - recall: 0.8119 - auc: 0.8399 - val_loss: 0.5192 - val_accuracy: 0.7481 - val_precision: 0.6126 - val_recall: 0.8437 - val_auc: 0.8434 - 3s/epoch - 5ms/step
Epoch 23/50
547/547 - 2s - loss: 0.5066 - accuracy: 0.7468 - precision: 0.6163 - recall: 0.8124 - auc: 0.8395 - val_loss: 0.5026 - val_accuracy: 0.7597 - val_precision: 0.6359 - val_recall: 0.8006 - val_auc: 0.8443 - 2s/epoch - 4ms/step
Epoch 24/50
547/547 - 2s - loss: 0.5051 - accuracy: 0.7479 - precision: 0.6177 - recall: 0.8119 - auc: 0.8399 - val_loss: 0.5087 - val_accuracy: 0.7577 - val_precision: 0.6279 - val_recall: 0.8259 - val_auc: 0.8424 - 2s/epoch - 3ms/step
Epoch 25/50
547/547 - 2s - loss: 0.5048 - accuracy: 0.7494 - precision: 0.6193 - recall: 0.8144 - auc: 0.8404 - val_loss: 0.4964 - val_accuracy: 0.7635 - val_precision: 0.6435 - val_recall: 0.7902 - val_auc: 0.8430 - 2s/epoch - 3ms/step
Epoch 26/50
547/547 - 2s - loss: 0.5048 - accuracy: 0.7494 - precision: 0.6198 - recall: 0.8113 - auc: 0.8408 - val_loss: 0.5024 - val_accuracy: 0.7578 - val_precision: 0.6299 - val_recall: 0.8170 - val_auc: 0.8450 - 2s/epoch - 3ms/step
Epoch 27/50
547/547 - 2s - loss: 0.5033 - accuracy: 0.7460 - precision: 0.6148 - recall: 0.8152 - auc: 0.8408 - val_loss: 0.4866 - val_accuracy: 0.7681 - val_precision: 0.6648 - val_recall: 0.7363 - val_auc: 0.8431 - 2s/epoch - 3ms/step
Epoch 28/50
547/547 - 2s - loss: 0.5017 - accuracy: 0.7492 - precision: 0.6189 - recall: 0.8154 - auc: 0.8414 - val_loss: 0.4928 - val_accuracy: 0.7644 - val_precision: 0.6463 - val_recall: 0.7837 - val_auc: 0.8435 - 2s/epoch - 3ms/step
Epoch 29/50
547/547 - 3s - loss: 0.5010 - accuracy: 0.7494 - precision: 0.6197 - recall: 0.8118 - auc: 0.8421 - val_loss: 0.5168 - val_accuracy: 0.7464 - val_precision: 0.6105 - val_recall: 0.8437 - val_auc: 0.8409 - 3s/epoch - 5ms/step
Epoch 30/50
547/547 - 3s - loss: 0.5006 - accuracy: 0.7491 - precision: 0.6181 - recall: 0.8188 - auc: 0.8422 - val_loss: 0.4887 - val_accuracy: 0.7668 - val_precision: 0.6496 - val_recall: 0.7846 - val_auc: 0.8445 - 3s/epoch - 5ms/step
Epoch 31/50
547/547 - 2s - loss: 0.4998 - accuracy: 0.7524 - precision: 0.6224 - recall: 0.8190 - auc: 0.8431 - val_loss: 0.4950 - val_accuracy: 0.7599 - val_precision: 0.6352 - val_recall: 0.8048 - val_auc: 0.8438 - 2s/epoch - 3ms/step
Epoch 32/50
547/547 - 2s - loss: 0.5016 - accuracy: 0.7478 - precision: 0.6171 - recall: 0.8149 - auc: 0.8421 - val_loss: 0.5093 - val_accuracy: 0.7536 - val_precision: 0.6215 - val_recall: 0.8320 - val_auc: 0.8434 - 2s/epoch - 4ms/step
Epoch 33/50
547/547 - 2s - loss: 0.4990 - accuracy: 0.7504 - precision: 0.6193 - recall: 0.8215 - auc: 0.8428 - val_loss: 0.4954 - val_accuracy: 0.7621 - val_precision: 0.6395 - val_recall: 0.7992 - val_auc: 0.8441 - 2s/epoch - 3ms/step
Epoch 34/50
547/547 - 2s - loss: 0.5000 - accuracy: 0.7518 - precision: 0.6218 - recall: 0.8174 - auc: 0.8430 - val_loss: 0.5112 - val_accuracy: 0.7501 - val_precision: 0.6134 - val_recall: 0.8541 - val_auc: 0.8472 - 2s/epoch - 3ms/step
Epoch 35/50
547/547 - 2s - loss: 0.4985 - accuracy: 0.7502 - precision: 0.6193 - recall: 0.8197 - auc: 0.8435 - val_loss: 0.5266 - val_accuracy: 0.7410 - val_precision: 0.6026 - val_recall: 0.8545 - val_auc: 0.8403 - 2s/epoch - 3ms/step
Epoch 36/50
547/547 - 2s - loss: 0.4962 - accuracy: 0.7512 - precision: 0.6203 - recall: 0.8218 - auc: 0.8444 - val_loss: 0.5028 - val_accuracy: 0.7558 - val_precision: 0.6239 - val_recall: 0.8339 - val_auc: 0.8463 - 2s/epoch - 3ms/step
Epoch 37/50
547/547 - 3s - loss: 0.4976 - accuracy: 0.7495 - precision: 0.6181 - recall: 0.8219 - auc: 0.8432 - val_loss: 0.4911 - val_accuracy: 0.7654 - val_precision: 0.6501 - val_recall: 0.7743 - val_auc: 0.8422 - 3s/epoch - 5ms/step
Epoch 38/50
547/547 - 2s - loss: 0.4972 - accuracy: 0.7496 - precision: 0.6189 - recall: 0.8183 - auc: 0.8439 - val_loss: 0.5167 - val_accuracy: 0.7474 - val_precision: 0.6104 - val_recall: 0.8522 - val_auc: 0.8443 - 2s/epoch - 4ms/step
Epoch 39/50
547/547 - 2s - loss: 0.4972 - accuracy: 0.7506 - precision: 0.6194 - recall: 0.8218 - auc: 0.8436 - val_loss: 0.4877 - val_accuracy: 0.7611 - val_precision: 0.6396 - val_recall: 0.7921 - val_auc: 0.8476 - 2s/epoch - 4ms/step
Epoch 40/50
547/547 - 2s - loss: 0.4960 - accuracy: 0.7504 - precision: 0.6192 - recall: 0.8216 - auc: 0.8449 - val_loss: 0.4876 - val_accuracy: 0.7666 - val_precision: 0.6496 - val_recall: 0.7837 - val_auc: 0.8446 - 2s/epoch - 3ms/step
Epoch 41/50
547/547 - 2s - loss: 0.4966 - accuracy: 0.7494 - precision: 0.6182 - recall: 0.8199 - auc: 0.8439 - val_loss: 0.5039 - val_accuracy: 0.7537 - val_precision: 0.6203 - val_recall: 0.8395 - val_auc: 0.8452 - 2s/epoch - 3ms/step
Epoch 42/50
547/547 - 2s - loss: 0.4952 - accuracy: 0.7539 - precision: 0.6232 - recall: 0.8243 - auc: 0.8452 - val_loss: 0.5196 - val_accuracy: 0.7434 - val_precision: 0.6041 - val_recall: 0.8634 - val_auc: 0.8470 - 2s/epoch - 3ms/step
Epoch 43/50
547/547 - 2s - loss: 0.4935 - accuracy: 0.7515 - precision: 0.6208 - recall: 0.8208 - auc: 0.8457 - val_loss: 0.5119 - val_accuracy: 0.7476 - val_precision: 0.6105 - val_recall: 0.8531 - val_auc: 0.8450 - 2s/epoch - 3ms/step
Epoch 44/50
547/547 - 5s - loss: 0.4952 - accuracy: 0.7506 - precision: 0.6185 - recall: 0.8266 - auc: 0.8450 - val_loss: 0.4979 - val_accuracy: 0.7578 - val_precision: 0.6278 - val_recall: 0.8278 - val_auc: 0.8482 - 5s/epoch - 10ms/step
Epoch 45/50
547/547 - 2s - loss: 0.4921 - accuracy: 0.7528 - precision: 0.6222 - recall: 0.8224 - auc: 0.8466 - val_loss: 0.4946 - val_accuracy: 0.7609 - val_precision: 0.6332 - val_recall: 0.8207 - val_auc: 0.8466 - 2s/epoch - 4ms/step
Epoch 46/50
547/547 - 2s - loss: 0.4933 - accuracy: 0.7518 - precision: 0.6204 - recall: 0.8246 - auc: 0.8458 - val_loss: 0.5049 - val_accuracy: 0.7539 - val_precision: 0.6206 - val_recall: 0.8390 - val_auc: 0.8463 - 2s/epoch - 3ms/step
Epoch 47/50
547/547 - 2s - loss: 0.4963 - accuracy: 0.7514 - precision: 0.6203 - recall: 0.8227 - auc: 0.8446 - val_loss: 0.5111 - val_accuracy: 0.7512 - val_precision: 0.6143 - val_recall: 0.8564 - val_auc: 0.8473 - 2s/epoch - 3ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_92_0.png" src="_images/Colorretal_-_vivo_ano5_92_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
547/547 [==============================] - 1s 2ms/step
183/183 [==============================] - 0s 2ms/step
Número de exemplos positivos do conjunto de teste = 2131
loss: 0.4866
accuracy: 0.7681
precision: 0.6648
recall: 0.7363
auc: 0.8431
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.6987
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_95_0.png" src="_images/Colorretal_-_vivo_ano5_95_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7613605669875834
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_97_0.png" src="_images/Colorretal_-_vivo_ano5_97_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1"># custo_e_metricas_val = rna_reg.evaluate(X_val_norm, y_val)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
547/547 [==============================] - 1s 2ms/step - loss: 0.4823 - accuracy: 0.7627 - precision: 0.6569 - recall: 0.7326 - auc: 0.8458
183/183 [==============================] - 1s 4ms/step - loss: 0.4866 - accuracy: 0.7681 - precision: 0.6648 - recall: 0.7363 - auc: 0.8431
</pre></div></div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Residual">
<h3><strong>Criação e treinamento da RNA Residual</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Residual" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função que cria o bloco para a RN residual</span>
<span class="k">def</span> <span class="nf">bloco_residual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

    <span class="n">z1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n</span><span class="p">)(</span><span class="n">z1</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">Add</span><span class="p">()([</span><span class="n">x</span><span class="p">,</span> <span class="n">z2</span><span class="p">])</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="nb">sum</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a2</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definição da entrada</span>
<span class="n">input_shape</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>

<span class="n">X1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">input_features</span><span class="p">)</span>

<span class="n">X2</span> <span class="o">=</span> <span class="n">bloco_residual</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">X3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">X2</span><span class="p">)</span>

<span class="n">X4</span> <span class="o">=</span> <span class="n">bloco_residual</span><span class="p">(</span><span class="n">X3</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">X5</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">X4</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)(</span><span class="n">X5</span><span class="p">)</span>

<span class="c1"># Criação da RNA</span>
<span class="n">rna</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">input_features</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

<span class="c1"># Mostra resumo da RNA</span>
<span class="n">rna</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model_1&#34;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to
==================================================================================================
 input_1 (InputLayer)           [(None, 25)]         0           []

 dense_4 (Dense)                (None, 64)           1664        [&#39;input_1[0][0]&#39;]

 dense_5 (Dense)                (None, 64)           4160        [&#39;dense_4[0][0]&#39;]

 dense_6 (Dense)                (None, 64)           4160        [&#39;dense_5[0][0]&#39;]

 add (Add)                      (None, 64)           0           [&#39;dense_4[0][0]&#39;,
                                                                  &#39;dense_6[0][0]&#39;]

 activation (Activation)        (None, 64)           0           [&#39;add[0][0]&#39;]

 dense_7 (Dense)                (None, 64)           4160        [&#39;activation[0][0]&#39;]

 dense_8 (Dense)                (None, 64)           4160        [&#39;dense_7[0][0]&#39;]

 dense_9 (Dense)                (None, 64)           4160        [&#39;dense_8[0][0]&#39;]

 add_1 (Add)                    (None, 64)           0           [&#39;dense_7[0][0]&#39;,
                                                                  &#39;dense_9[0][0]&#39;]

 activation_1 (Activation)      (None, 64)           0           [&#39;add_1[0][0]&#39;]

 dense_10 (Dense)               (None, 16)           1040        [&#39;activation_1[0][0]&#39;]

 dense_11 (Dense)               (None, 1)            17          [&#39;dense_10[0][0]&#39;]

==================================================================================================
Total params: 23,521
Trainable params: 23,521
Non-trainable params: 0
__________________________________________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">rna</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_102_0.png" src="_images/Colorretal_-_vivo_ano5_102_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                        <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">rna</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
547/547 - 4s - loss: 0.5405 - accuracy: 0.7148 - precision: 0.5830 - recall: 0.7691 - auc: 0.7984 - val_loss: 0.5071 - val_accuracy: 0.7378 - val_precision: 0.6039 - val_recall: 0.8198 - val_auc: 0.8267 - 4s/epoch - 8ms/step
Epoch 2/50
547/547 - 2s - loss: 0.4945 - accuracy: 0.7410 - precision: 0.6095 - recall: 0.8091 - auc: 0.8350 - val_loss: 0.5080 - val_accuracy: 0.7349 - val_precision: 0.5968 - val_recall: 0.8451 - val_auc: 0.8373 - 2s/epoch - 3ms/step
Epoch 3/50
547/547 - 2s - loss: 0.4773 - accuracy: 0.7506 - precision: 0.6184 - recall: 0.8273 - auc: 0.8462 - val_loss: 0.5091 - val_accuracy: 0.7436 - val_precision: 0.6093 - val_recall: 0.8306 - val_auc: 0.8382 - 2s/epoch - 3ms/step
Epoch 4/50
547/547 - 2s - loss: 0.4700 - accuracy: 0.7542 - precision: 0.6223 - recall: 0.8313 - auc: 0.8512 - val_loss: 0.4983 - val_accuracy: 0.7477 - val_precision: 0.6171 - val_recall: 0.8146 - val_auc: 0.8378 - 2s/epoch - 3ms/step
Epoch 5/50
547/547 - 3s - loss: 0.4636 - accuracy: 0.7582 - precision: 0.6263 - recall: 0.8376 - auc: 0.8546 - val_loss: 0.4883 - val_accuracy: 0.7587 - val_precision: 0.6360 - val_recall: 0.7935 - val_auc: 0.8421 - 3s/epoch - 5ms/step
Epoch 6/50
547/547 - 3s - loss: 0.4582 - accuracy: 0.7625 - precision: 0.6307 - recall: 0.8435 - auc: 0.8584 - val_loss: 0.5122 - val_accuracy: 0.7517 - val_precision: 0.6225 - val_recall: 0.8132 - val_auc: 0.8351 - 3s/epoch - 5ms/step
Epoch 7/50
547/547 - 2s - loss: 0.4510 - accuracy: 0.7665 - precision: 0.6369 - recall: 0.8384 - auc: 0.8635 - val_loss: 0.5081 - val_accuracy: 0.7537 - val_precision: 0.6294 - val_recall: 0.7921 - val_auc: 0.8369 - 2s/epoch - 3ms/step
Epoch 8/50
547/547 - 2s - loss: 0.4445 - accuracy: 0.7732 - precision: 0.6449 - recall: 0.8432 - auc: 0.8671 - val_loss: 0.5070 - val_accuracy: 0.7498 - val_precision: 0.6222 - val_recall: 0.8015 - val_auc: 0.8363 - 2s/epoch - 3ms/step
Epoch 9/50
547/547 - 2s - loss: 0.4408 - accuracy: 0.7740 - precision: 0.6458 - recall: 0.8443 - auc: 0.8695 - val_loss: 0.5262 - val_accuracy: 0.7465 - val_precision: 0.6127 - val_recall: 0.8315 - val_auc: 0.8390 - 2s/epoch - 3ms/step
Epoch 10/50
547/547 - 2s - loss: 0.4319 - accuracy: 0.7808 - precision: 0.6537 - recall: 0.8501 - auc: 0.8743 - val_loss: 0.5173 - val_accuracy: 0.7506 - val_precision: 0.6241 - val_recall: 0.7977 - val_auc: 0.8363 - 2s/epoch - 3ms/step
Epoch 11/50
547/547 - 2s - loss: 0.4259 - accuracy: 0.7854 - precision: 0.6576 - recall: 0.8596 - auc: 0.8781 - val_loss: 0.5169 - val_accuracy: 0.7601 - val_precision: 0.6548 - val_recall: 0.7255 - val_auc: 0.8353 - 2s/epoch - 3ms/step
Epoch 12/50
547/547 - 2s - loss: 0.4183 - accuracy: 0.7862 - precision: 0.6599 - recall: 0.8551 - auc: 0.8826 - val_loss: 0.5548 - val_accuracy: 0.7383 - val_precision: 0.6044 - val_recall: 0.8207 - val_auc: 0.8322 - 2s/epoch - 4ms/step
Epoch 13/50
547/547 - 3s - loss: 0.4111 - accuracy: 0.7932 - precision: 0.6698 - recall: 0.8556 - auc: 0.8871 - val_loss: 0.5568 - val_accuracy: 0.7419 - val_precision: 0.6138 - val_recall: 0.7912 - val_auc: 0.8285 - 3s/epoch - 5ms/step
Epoch 14/50
547/547 - 2s - loss: 0.4028 - accuracy: 0.7991 - precision: 0.6761 - recall: 0.8632 - auc: 0.8917 - val_loss: 0.5324 - val_accuracy: 0.7410 - val_precision: 0.6173 - val_recall: 0.7654 - val_auc: 0.8239 - 2s/epoch - 4ms/step
Epoch 15/50
547/547 - 2s - loss: 0.3938 - accuracy: 0.8020 - precision: 0.6800 - recall: 0.8643 - auc: 0.8964 - val_loss: 0.5445 - val_accuracy: 0.7527 - val_precision: 0.6327 - val_recall: 0.7696 - val_auc: 0.8275 - 2s/epoch - 3ms/step
Epoch 16/50
547/547 - 2s - loss: 0.3824 - accuracy: 0.8119 - precision: 0.6924 - recall: 0.8726 - auc: 0.9025 - val_loss: 0.5946 - val_accuracy: 0.7361 - val_precision: 0.6028 - val_recall: 0.8132 - val_auc: 0.8240 - 2s/epoch - 3ms/step
Epoch 17/50
547/547 - 2s - loss: 0.3762 - accuracy: 0.8119 - precision: 0.6910 - recall: 0.8770 - auc: 0.9052 - val_loss: 0.5980 - val_accuracy: 0.7385 - val_precision: 0.6126 - val_recall: 0.7724 - val_auc: 0.8203 - 2s/epoch - 3ms/step
Epoch 18/50
547/547 - 2s - loss: 0.3677 - accuracy: 0.8187 - precision: 0.7010 - recall: 0.8781 - auc: 0.9098 - val_loss: 0.5947 - val_accuracy: 0.7326 - val_precision: 0.6019 - val_recall: 0.7916 - val_auc: 0.8188 - 2s/epoch - 3ms/step
Epoch 19/50
547/547 - 2s - loss: 0.3585 - accuracy: 0.8253 - precision: 0.7096 - recall: 0.8830 - auc: 0.9153 - val_loss: 0.6262 - val_accuracy: 0.7412 - val_precision: 0.6187 - val_recall: 0.7593 - val_auc: 0.8162 - 2s/epoch - 3ms/step
Epoch 20/50
547/547 - 2s - loss: 0.3474 - accuracy: 0.8313 - precision: 0.7169 - recall: 0.8894 - auc: 0.9196 - val_loss: 0.6190 - val_accuracy: 0.7381 - val_precision: 0.6118 - val_recall: 0.7743 - val_auc: 0.8145 - 2s/epoch - 5ms/step
Epoch 21/50
547/547 - 3s - loss: 0.3373 - accuracy: 0.8351 - precision: 0.7218 - recall: 0.8925 - auc: 0.9246 - val_loss: 0.6856 - val_accuracy: 0.7290 - val_precision: 0.5990 - val_recall: 0.7809 - val_auc: 0.8078 - 3s/epoch - 5ms/step
Epoch 22/50
547/547 - 2s - loss: 0.3288 - accuracy: 0.8404 - precision: 0.7289 - recall: 0.8963 - auc: 0.9283 - val_loss: 0.6766 - val_accuracy: 0.7263 - val_precision: 0.5965 - val_recall: 0.7748 - val_auc: 0.8054 - 2s/epoch - 3ms/step
Epoch 23/50
547/547 - 2s - loss: 0.3232 - accuracy: 0.8443 - precision: 0.7339 - recall: 0.8999 - auc: 0.9310 - val_loss: 0.7039 - val_accuracy: 0.7323 - val_precision: 0.6146 - val_recall: 0.7161 - val_auc: 0.8029 - 2s/epoch - 3ms/step
Epoch 24/50
547/547 - 2s - loss: 0.3151 - accuracy: 0.8453 - precision: 0.7362 - recall: 0.8985 - auc: 0.9341 - val_loss: 0.7038 - val_accuracy: 0.7378 - val_precision: 0.6213 - val_recall: 0.7222 - val_auc: 0.8094 - 2s/epoch - 3ms/step
Epoch 25/50
547/547 - 2s - loss: 0.3014 - accuracy: 0.8537 - precision: 0.7467 - recall: 0.9072 - auc: 0.9398 - val_loss: 0.7187 - val_accuracy: 0.7290 - val_precision: 0.6095 - val_recall: 0.7184 - val_auc: 0.8002 - 2s/epoch - 3ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_105_0.png" src="_images/Colorretal_-_vivo_ano5_105_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
547/547 [==============================] - 1s 1ms/step
183/183 [==============================] - 0s 2ms/step
Número de exemplos positivos do conjunto de teste = 2131
loss: 0.4883
accuracy: 0.7587
precision: 0.6360
recall: 0.7935
auc: 0.8421
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7061
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_108_0.png" src="_images/Colorretal_-_vivo_ano5_108_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7660925370925746
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_110_0.png" src="_images/Colorretal_-_vivo_ano5_110_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
547/547 [==============================] - 1s 2ms/step - loss: 0.4431 - accuracy: 0.7746 - precision: 0.6528 - recall: 0.8171 - auc: 0.8667
183/183 [==============================] - 0s 2ms/step - loss: 0.4883 - accuracy: 0.7587 - precision: 0.6360 - recall: 0.7935 - auc: 0.8421
</pre></div></div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Sequencial">
<h3><strong>Criação e treinamento da RNA Sequencial</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Sequencial" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">neg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="n">pos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exemplos:</span><span class="se">\n</span><span class="s1"> Total: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="se">\n</span><span class="s1"> Positivos: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">pos</span><span class="o">/</span><span class="n">total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">% do total)&#39;</span><span class="p">)</span>

<span class="c1"># Cálculo dos pesos das duas classe</span>
<span class="n">weight_for_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">neg</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">weight_for_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pos</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

<span class="c1"># Dicionário de pesos das classes para treinamento</span>
<span class="n">class_weight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">weight_for_0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">weight_for_1</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 0: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 1: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Exemplos:
 Total: 17503
 Positivos: 6391 (36.51% do total)
Peso da classe 0: 0.79
Peso da classe 1: 1.37
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rna</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;sequential&#34;
_________________________________________________________________
 Layer (type)                Output Shape              Param #
=================================================================
 dense_12 (Dense)            (None, 128)               3328

 dense_13 (Dense)            (None, 128)               16512

 dense_14 (Dense)            (None, 32)                4128

 dense_15 (Dense)            (None, 1)                 33

=================================================================
Total params: 24,001
Trainable params: 24,001
Non-trainable params: 0
_________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">rna</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_115_0.png" src="_images/Colorretal_-_vivo_ano5_115_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                        <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">rna</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                  <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                  <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                  <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
547/547 - 3s - loss: 0.5279 - accuracy: 0.7226 - precision: 0.5937 - recall: 0.7606 - auc: 0.8093 - val_loss: 0.5045 - val_accuracy: 0.7453 - val_precision: 0.6123 - val_recall: 0.8254 - val_auc: 0.8350 - 3s/epoch - 6ms/step
Epoch 2/50
547/547 - 2s - loss: 0.4905 - accuracy: 0.7448 - precision: 0.6158 - recall: 0.8007 - auc: 0.8371 - val_loss: 0.4897 - val_accuracy: 0.7553 - val_precision: 0.6245 - val_recall: 0.8273 - val_auc: 0.8433 - 2s/epoch - 3ms/step
Epoch 3/50
547/547 - 1s - loss: 0.4770 - accuracy: 0.7529 - precision: 0.6240 - recall: 0.8135 - auc: 0.8465 - val_loss: 0.4956 - val_accuracy: 0.7541 - val_precision: 0.6193 - val_recall: 0.8480 - val_auc: 0.8445 - 1s/epoch - 3ms/step
Epoch 4/50
547/547 - 2s - loss: 0.4678 - accuracy: 0.7568 - precision: 0.6280 - recall: 0.8191 - auc: 0.8528 - val_loss: 0.4944 - val_accuracy: 0.7496 - val_precision: 0.6139 - val_recall: 0.8475 - val_auc: 0.8405 - 2s/epoch - 3ms/step
Epoch 5/50
547/547 - 2s - loss: 0.4618 - accuracy: 0.7599 - precision: 0.6299 - recall: 0.8299 - auc: 0.8564 - val_loss: 0.4804 - val_accuracy: 0.7599 - val_precision: 0.6370 - val_recall: 0.7963 - val_auc: 0.8448 - 2s/epoch - 4ms/step
Epoch 6/50
547/547 - 2s - loss: 0.4543 - accuracy: 0.7648 - precision: 0.6369 - recall: 0.8280 - auc: 0.8609 - val_loss: 0.4858 - val_accuracy: 0.7611 - val_precision: 0.6319 - val_recall: 0.8282 - val_auc: 0.8475 - 2s/epoch - 4ms/step
Epoch 7/50
547/547 - 1s - loss: 0.4488 - accuracy: 0.7700 - precision: 0.6419 - recall: 0.8371 - auc: 0.8640 - val_loss: 0.4840 - val_accuracy: 0.7625 - val_precision: 0.6395 - val_recall: 0.8015 - val_auc: 0.8463 - 1s/epoch - 3ms/step
Epoch 8/50
547/547 - 1s - loss: 0.4437 - accuracy: 0.7752 - precision: 0.6488 - recall: 0.8379 - auc: 0.8681 - val_loss: 0.4789 - val_accuracy: 0.7662 - val_precision: 0.6486 - val_recall: 0.7855 - val_auc: 0.8455 - 1s/epoch - 3ms/step
Epoch 9/50
547/547 - 1s - loss: 0.4377 - accuracy: 0.7755 - precision: 0.6486 - recall: 0.8407 - auc: 0.8714 - val_loss: 0.4916 - val_accuracy: 0.7565 - val_precision: 0.6361 - val_recall: 0.7785 - val_auc: 0.8402 - 1s/epoch - 3ms/step
Epoch 10/50
547/547 - 1s - loss: 0.4320 - accuracy: 0.7778 - precision: 0.6513 - recall: 0.8427 - auc: 0.8749 - val_loss: 0.4997 - val_accuracy: 0.7554 - val_precision: 0.6281 - val_recall: 0.8099 - val_auc: 0.8411 - 1s/epoch - 3ms/step
Epoch 11/50
547/547 - 1s - loss: 0.4231 - accuracy: 0.7840 - precision: 0.6590 - recall: 0.8468 - auc: 0.8803 - val_loss: 0.5076 - val_accuracy: 0.7491 - val_precision: 0.6191 - val_recall: 0.8137 - val_auc: 0.8376 - 1s/epoch - 3ms/step
Epoch 12/50
547/547 - 2s - loss: 0.4171 - accuracy: 0.7904 - precision: 0.6664 - recall: 0.8532 - auc: 0.8843 - val_loss: 0.4952 - val_accuracy: 0.7532 - val_precision: 0.6243 - val_recall: 0.8142 - val_auc: 0.8387 - 2s/epoch - 3ms/step
Epoch 13/50
547/547 - 2s - loss: 0.4100 - accuracy: 0.7918 - precision: 0.6687 - recall: 0.8515 - auc: 0.8879 - val_loss: 0.5125 - val_accuracy: 0.7544 - val_precision: 0.6258 - val_recall: 0.8146 - val_auc: 0.8407 - 2s/epoch - 4ms/step
Epoch 14/50
547/547 - 3s - loss: 0.4014 - accuracy: 0.7975 - precision: 0.6736 - recall: 0.8643 - auc: 0.8926 - val_loss: 0.5128 - val_accuracy: 0.7465 - val_precision: 0.6254 - val_recall: 0.7630 - val_auc: 0.8286 - 3s/epoch - 5ms/step
Epoch 15/50
547/547 - 2s - loss: 0.3923 - accuracy: 0.8056 - precision: 0.6847 - recall: 0.8670 - auc: 0.8980 - val_loss: 0.5160 - val_accuracy: 0.7506 - val_precision: 0.6283 - val_recall: 0.7766 - val_auc: 0.8310 - 2s/epoch - 3ms/step
Epoch 16/50
547/547 - 1s - loss: 0.3849 - accuracy: 0.8046 - precision: 0.6830 - recall: 0.8676 - auc: 0.9013 - val_loss: 0.5142 - val_accuracy: 0.7544 - val_precision: 0.6419 - val_recall: 0.7410 - val_auc: 0.8354 - 1s/epoch - 3ms/step
Epoch 17/50
547/547 - 1s - loss: 0.3769 - accuracy: 0.8133 - precision: 0.6956 - recall: 0.8690 - auc: 0.9063 - val_loss: 0.5279 - val_accuracy: 0.7577 - val_precision: 0.6480 - val_recall: 0.7367 - val_auc: 0.8333 - 1s/epoch - 3ms/step
Epoch 18/50
547/547 - 2s - loss: 0.3703 - accuracy: 0.8168 - precision: 0.6985 - recall: 0.8769 - auc: 0.9092 - val_loss: 0.5795 - val_accuracy: 0.7302 - val_precision: 0.5942 - val_recall: 0.8245 - val_auc: 0.8243 - 2s/epoch - 3ms/step
Epoch 19/50
547/547 - 2s - loss: 0.3618 - accuracy: 0.8218 - precision: 0.7057 - recall: 0.8781 - auc: 0.9131 - val_loss: 0.5585 - val_accuracy: 0.7469 - val_precision: 0.6325 - val_recall: 0.7325 - val_auc: 0.8221 - 2s/epoch - 5ms/step
Epoch 20/50
547/547 - 2s - loss: 0.3525 - accuracy: 0.8273 - precision: 0.7120 - recall: 0.8852 - auc: 0.9178 - val_loss: 0.5763 - val_accuracy: 0.7400 - val_precision: 0.6137 - val_recall: 0.7776 - val_auc: 0.8226 - 2s/epoch - 3ms/step
Epoch 21/50
547/547 - 2s - loss: 0.3454 - accuracy: 0.8297 - precision: 0.7157 - recall: 0.8852 - auc: 0.9215 - val_loss: 0.5698 - val_accuracy: 0.7412 - val_precision: 0.6234 - val_recall: 0.7363 - val_auc: 0.8165 - 2s/epoch - 4ms/step
Epoch 22/50
547/547 - 2s - loss: 0.3363 - accuracy: 0.8371 - precision: 0.7262 - recall: 0.8887 - auc: 0.9254 - val_loss: 0.5880 - val_accuracy: 0.7357 - val_precision: 0.6167 - val_recall: 0.7302 - val_auc: 0.8108 - 2s/epoch - 4ms/step
Epoch 23/50
547/547 - 1s - loss: 0.3256 - accuracy: 0.8446 - precision: 0.7369 - recall: 0.8934 - auc: 0.9302 - val_loss: 0.5983 - val_accuracy: 0.7453 - val_precision: 0.6324 - val_recall: 0.7227 - val_auc: 0.8201 - 1s/epoch - 3ms/step
Epoch 24/50
547/547 - 1s - loss: 0.3192 - accuracy: 0.8485 - precision: 0.7405 - recall: 0.9006 - auc: 0.9334 - val_loss: 0.6429 - val_accuracy: 0.7464 - val_precision: 0.6383 - val_recall: 0.7048 - val_auc: 0.8156 - 1s/epoch - 3ms/step
Epoch 25/50
547/547 - 1s - loss: 0.3099 - accuracy: 0.8544 - precision: 0.7503 - recall: 0.9010 - auc: 0.9374 - val_loss: 0.6291 - val_accuracy: 0.7345 - val_precision: 0.6176 - val_recall: 0.7170 - val_auc: 0.8081 - 1s/epoch - 3ms/step
Epoch 26/50
547/547 - 1s - loss: 0.3038 - accuracy: 0.8552 - precision: 0.7503 - recall: 0.9046 - auc: 0.9395 - val_loss: 0.6688 - val_accuracy: 0.7352 - val_precision: 0.6095 - val_recall: 0.7654 - val_auc: 0.8130 - 1s/epoch - 3ms/step
Epoch 27/50
547/547 - 1s - loss: 0.2917 - accuracy: 0.8615 - precision: 0.7606 - recall: 0.9058 - auc: 0.9446 - val_loss: 0.7091 - val_accuracy: 0.7344 - val_precision: 0.6070 - val_recall: 0.7733 - val_auc: 0.8105 - 1s/epoch - 3ms/step
Epoch 28/50
547/547 - 1s - loss: 0.2878 - accuracy: 0.8641 - precision: 0.7629 - recall: 0.9108 - auc: 0.9460 - val_loss: 0.6956 - val_accuracy: 0.7282 - val_precision: 0.6044 - val_recall: 0.7405 - val_auc: 0.8027 - 1s/epoch - 3ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_118_0.png" src="_images/Colorretal_-_vivo_ano5_118_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
547/547 [==============================] - 1s 1ms/step
183/183 [==============================] - 0s 1ms/step
Número de exemplos positivos do conjunto de teste = 2131
loss: 0.4789
accuracy: 0.7662
precision: 0.6486
recall: 0.7855
auc: 0.8455
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7105
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_121_0.png" src="_images/Colorretal_-_vivo_ano5_121_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7703381406634349
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_vivo_ano5_123_0.png" src="_images/Colorretal_-_vivo_ano5_123_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
547/547 [==============================] - 1s 2ms/step - loss: 0.4205 - accuracy: 0.7927 - precision: 0.6789 - recall: 0.8202 - auc: 0.8808
183/183 [==============================] - 0s 2ms/step - loss: 0.4789 - accuracy: 0.7662 - precision: 0.6486 - recall: 0.7855 - auc: 0.8455
</pre></div></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Colorretal%20-%20vivo_ano3.html" class="btn btn-neutral float-left" title="Introdução" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Lucas Buk Cardoso.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>