<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introdução &mdash; Documentação do estudo de câncer colorretal</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=359c27e9"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introdução" href="Colorretal%20-%20vivo_ano1.html" />
    <link rel="prev" title="Introdução" href="Colorretal%20-%20obito_geral.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Estudo Câncer Colorretal
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Bibliotecas e Funções</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Fun%C3%A7%C3%B5es.html"><strong>Importações</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Fun%C3%A7%C3%B5es.html#Funções"><strong>Funções</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Análise dos dados</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html"><strong>Leitura dos Dados</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html#Análise-dos-dados"><strong>Análise dos dados</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html#Criação-de-novas-colunas"><strong>Criação de novas colunas</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Óbito geral</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_geral.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_geral.html#Análise---Óbito-geral"><strong>Análise - Óbito geral</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Óbito por câncer</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="#Análise---Óbito-por-câncer"><strong>Análise - Óbito por câncer</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Pré-processamento"><strong>Pré-processamento</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Treinamento-e-validação-dos-modelos-de-machine-learning"><strong>Treinamento e validação dos modelos de machine learning</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Naive-Bayes"><strong>Naive Bayes</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest"><strong>Random Forest</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Optuna">Optuna</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost"><strong>XGBoost</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Optuna</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ROCs"><strong>ROCs</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#RN"><strong>RN</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Importação-das-bibliotecas-e-funções"><strong>Importação das bibliotecas e funções</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Complexa"><strong>Criação e treinamento da RNA Complexa</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Residual"><strong>Criação e treinamento da RNA Residual</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Sequencial"><strong>Criação e treinamento da RNA Sequencial</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida um ano</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano1.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano1.html#Análise---Sobrevida-um-ano"><strong>Análise - Sobrevida um ano</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida três anos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano3.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano3.html#Análise---Sobrevida-três-anos"><strong>Análise - Sobrevida três anos</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida cinco anos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano5.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano5.html#Análise---Sobrevida-cinco-anos"><strong>Análise - Sobrevida cinco anos</strong></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Estudo Câncer Colorretal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><strong>Introdução</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Colorretal - obito_cancer.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Introdução">
<h1><strong>Introdução</strong><a class="headerlink" href="#Introdução" title="Permalink to this heading"></a></h1>
<p><strong>Ideia Geral</strong></p>
<p>Utilizando os dados de câncer da FOSP, somente do tipo colorretal, serão utilizados quatro modelos de machine learning diferentes, com o intuito de testar diferentes tipos de algoritmo na classificação do óbito por câncer.</p>
<p>O label é 0 se o paciente está vivo e 1 se ele morreu devido ao câncer.</p>
<p><strong>Modelos de ML</strong></p>
<p>Foram escolhidos os modelos Naive Bayes, que utiliza o Teorema de Bayes para realizar as previsões, Random Forest, XGBoost e LightGBM, que utilizam os conceitos de árvores de decisão, além de bagging e boosting. Além disso, será testado um modelo de votação com os melhores classificadores obtidos, visando obter um algoritmo ainda mais acertivo.</p>
<p><strong>Validação dos modelos</strong></p>
<p>Para validar os modelos treinados foi utilizada primeiramente a matriz de confusão, sendo possível avaliar os acertos em ambas as classes. Para entender de houve overfitting nos modelos, foi utilizada a curva ROC para os conjuntos de treino e teste, comparando a métrica AUC entre ambos os conjuntos.</p>
<p>Por fim, os modelos Random Forest, XGBoost e LightGBM oferecem a possibilidade de saber quais foram as features mais importantes, ou seja, que mais influenciam na previsão das classes. Assim, foram mostradas duas maneiras diferentes de analisar a importância das variáveis de entrada, uma usando a própria função dos modelos e outra usando a biblioteca SHAP, que mostra a influência das features em ambas as classes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leitura dos dados</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/colorretal_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(31916, 37)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-561040c1-8a58-4afa-b3cd-6ed714f84c6b">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ESCOLARI</th>
      <th>IDADE</th>
      <th>SEXO</th>
      <th>IBGE</th>
      <th>CATEATEND</th>
      <th>DIAGPREV</th>
      <th>EC</th>
      <th>ECGRUP</th>
      <th>TRATHOSP</th>
      <th>NENHUM</th>
      <th>...</th>
      <th>IBGEATEN</th>
      <th>ULTICONS</th>
      <th>ULTIDIAG</th>
      <th>ULTITRAT</th>
      <th>obito_geral</th>
      <th>obito_cancer</th>
      <th>vivo_ano1</th>
      <th>vivo_ano3</th>
      <th>vivo_ano5</th>
      <th>ESCOLARI_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4</td>
      <td>19</td>
      <td>2</td>
      <td>3538709</td>
      <td>9</td>
      <td>2</td>
      <td>IV</td>
      <td>IV</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3538709</td>
      <td>4985</td>
      <td>4985</td>
      <td>4951</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9</td>
      <td>19</td>
      <td>1</td>
      <td>3537107</td>
      <td>2</td>
      <td>2</td>
      <td>IIIA</td>
      <td>III</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3509502</td>
      <td>2680</td>
      <td>2744</td>
      <td>2674</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>19</td>
      <td>1</td>
      <td>3516200</td>
      <td>9</td>
      <td>2</td>
      <td>IIB</td>
      <td>II</td>
      <td>F</td>
      <td>0</td>
      <td>...</td>
      <td>3516200</td>
      <td>4725</td>
      <td>4734</td>
      <td>4719</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 37 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-561040c1-8a58-4afa-b3cd-6ed714f84c6b')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-561040c1-8a58-4afa-b3cd-6ed714f84c6b button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-561040c1-8a58-4afa-b3cd-6ed714f84c6b');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Valores faltantes</span>
<span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ESCOLARI     0
CONSDIAG     0
DIAGTRAT     0
ANODIAG      0
FAIXAETAR    0
DRS          0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlação com a saída</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;obito_cancer&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
The default value of numeric_only in DataFrame.corr is deprecated. In a future version, it will default to False. Select only valid columns or specify the value of numeric_only to silence this warning.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
obito_cancer    1.000000
obito_geral     0.788496
ULTINFO         0.472244
ULTIDIAG        0.396297
ULTITRAT        0.394160
ULTICONS        0.392998
vivo_ano3       0.384454
vivo_ano5       0.365039
vivo_ano1       0.279604
RECNENHUM       0.231324
ANODIAG         0.175160
CATEATEND       0.158817
CIRURGIA        0.155553
QUIMIO          0.086075
RRAS            0.065750
ESCOLARI_2      0.056375
RADIO           0.051821
IBGEATEN        0.049655
DIAGPREV        0.047864
OUTROS          0.043201
Name: obito_cancer, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quantidade de pacientes em cada classe da saída</span>
<span class="n">df</span><span class="o">.</span><span class="n">obito_cancer</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    18780
1    13136
Name: obito_cancer, dtype: int64
</pre></div></div>
</div>
</section>
<section id="Análise---Óbito-por-câncer">
<h1><strong>Análise - Óbito por câncer</strong><a class="headerlink" href="#Análise---Óbito-por-câncer" title="Permalink to this heading"></a></h1>
<section id="Pré-processamento">
<h2><strong>Pré-processamento</strong><a class="headerlink" href="#Pré-processamento" title="Permalink to this heading"></a></h2>
<p>Como o dataset já foi limpo anteriormente, aqui na etapa de pré-processamento serão realizadas a divisão dos dados em treino e teste, a codificação das colunas textuais para colunas numéricas e a normalização dos dados. Com isso, temos os dados prontos para o treinamento dos modelos de machine learning e consequentemente sua validação.</p>
<p>Neste primeiro momento, serão definidas as colunas que não serão utilizadas como features, assim, foi escolhido manter a coluna <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, então a coluna <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code> será retirada. O mesmo ocorre com a coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code>, retirando a coluna <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>. Por fim, as outras colunas contidas na <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> são possíveis saídas para os modelos, mas estamos interessados somente no óbito por câncer, por isso só ela será mantida como label e as outras serão retiradas.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_geral&#39;</span><span class="p">,</span> <span class="s1">&#39;ECGRUP&#39;</span><span class="p">,</span> <span class="s1">&#39;ESCOLARI&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;obito_cancer&#39;</span>
</pre></div>
</div>
</div>
<p>Uma função foi criada para realizar o pré-processamento inteiro, chamada <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, internamente ela utiliza outras funções criadas que são: <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divide os dados em treino e teste), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (prepara os dados de treino) e <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (prepara os dados de teste).</p>
<blockquote>
<div><p>Mais detalhes em <a class="reference external" href="https://colorectal-site.readthedocs.io/en/latest/Fun%C3%A7%C3%B5es.html#Fun%C3%A7%C3%B5es">funções</a>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">feat_cols</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                            <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                            <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                            <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                            <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (23937, 25), X_test = (7979, 25)
y_train = (23937,), y_test = (7979,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feat_cols</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;IDADE&#39;, &#39;SEXO&#39;, &#39;IBGE&#39;, &#39;CATEATEND&#39;, &#39;DIAGPREV&#39;, &#39;EC&#39;, &#39;TRATHOSP&#39;,
       &#39;NENHUM&#39;, &#39;CIRURGIA&#39;, &#39;RADIO&#39;, &#39;QUIMIO&#39;, &#39;HORMONIO&#39;, &#39;TMO&#39;, &#39;IMUNO&#39;,
       &#39;OUTROS&#39;, &#39;NENHUMANT&#39;, &#39;CONSDIAG&#39;, &#39;TRATCONS&#39;, &#39;DIAGTRAT&#39;, &#39;ANODIAG&#39;,
       &#39;DRS&#39;, &#39;RRAS&#39;, &#39;RECNENHUM&#39;, &#39;IBGEATEN&#39;, &#39;ESCOLARI_2&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    0.58842
1    0.41158
Name: obito_cancer, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    0.58842
1    0.41158
Name: obito_cancer, dtype: float64
</pre></div></div>
</div>
</section>
<section id="Treinamento-e-validação-dos-modelos-de-machine-learning">
<h2><strong>Treinamento e validação dos modelos de machine learning</strong><a class="headerlink" href="#Treinamento-e-validação-dos-modelos-de-machine-learning" title="Permalink to this heading"></a></h2>
<p>Depois das etapas de preparação, os dados estão prontos para serem utilizados nos modelos escolhidos.</p>
<section id="Naive-Bayes">
<h3><strong>Naive Bayes</strong><a class="headerlink" href="#Naive-Bayes" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo Naive Bayes</span>
<span class="n">nb</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GaussianNB()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">GaussianNB</label><div class="sk-toggleable__content"><pre>GaussianNB()</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_18_0.png" src="_images/Colorretal_-_obito_cancer_18_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.702     0.013     0.025      4695
           1      0.413     0.992     0.583      3284

    accuracy                          0.416      7979
   macro avg      0.558     0.502     0.304      7979
weighted avg      0.583     0.416     0.255      7979

</pre></div></div>
</div>
<blockquote>
<div><p>Claramente percebe-se que o modelo previu quase todos os dados como sendo da classe 1, portanto não teve um aprendizado satisfatório.</p>
</div></blockquote>
<blockquote>
<div><p>Na matriz de confusão, buscamos uma diagonal principal equilibrada e com a maior acertividade possível.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_20_0.png" src="_images/Colorretal_-_obito_cancer_20_0.png" />
</div>
</div>
<blockquote>
<div><p>Pelas curvas ROC, pode-se dizer que não há overfitting, mas o modelo é ruim para a previsão da classe 0, portanto qualquer análise além dessa não possui tanta relevância.</p>
</div></blockquote>
</section>
<section id="Random-Forest">
<h3><strong>Random Forest</strong><a class="headerlink" href="#Random-Forest" title="Permalink to this heading"></a></h3>
<p>O modelo Random Forest é mais complexo em relação ao Naive Bayes, assim alguns hiperparâmetros serão definidos para obter um modelo base e depois será realizada a busca dos melhores parâmetros utilizando o Optuna.</p>
<p>Os parâmetros definidos para este primeiro modelo serão:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code>: para repetibilidade do treinamento do modelo. Será utilizado na busca pelos hiperparâmetros também, sempre como mesmo valor definido na variável <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: será definido como 8, pois o padrão do modelo é não ter profundidade máxima para as árvores, o que dificulta e faz o treinamento ser muito longo, além da maior chance de overfitting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class_weight</span></code>: usado para definir os pesos de cada classe no treinamento do modelo, muito útil quando temos classes desbalanceadas no conjunto de dados, como neste caso.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo Random Forest</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                            <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                            <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.77</span><span class="p">},</span>
                            <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">)</span>

<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(class_weight={0: 1, 1: 1.77}, criterion=&#x27;entropy&#x27;,
                       max_depth=8, random_state=10)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(class_weight={0: 1, 1: 1.77}, criterion=&#x27;entropy&#x27;,
                       max_depth=8, random_state=10)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_25_0.png" src="_images/Colorretal_-_obito_cancer_25_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.817     0.757     0.786      4695
           1      0.686     0.757     0.720      3284

    accuracy                          0.757      7979
   macro avg      0.751     0.757     0.753      7979
weighted avg      0.763     0.757     0.759      7979

</pre></div></div>
</div>
<blockquote>
<div><p>A matriz obtida para o modelo Random Forest apresentou diagonal equilibrada em ambas as classes, com 76% de acurácia.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pedaço de uma das árvores do modelo Random Forest</span>
<span class="n">show_tree</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_27_0.png" src="_images/Colorretal_-_obito_cancer_27_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_28_0.png" src="_images/Colorretal_-_obito_cancer_28_0.png" />
</div>
</div>
<blockquote>
<div><p>Como a métrica AUC possui valores próximos para o conjunto de treino e de teste, 0,864 e 0,837 respectivamente, pode-se dizer que há apenas um pouco de overfitting, não sendo algo de grande preocupação.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features</span>
<span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_30_0.png" src="_images/Colorretal_-_obito_cancer_30_0.png" />
</div>
</div>
<blockquote>
<div><p>As features mais importantes nesta visualização são <code class="docutils literal notranslate"><span class="pre">EC</span></code>, com uma grande vantagem, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code> e <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_32_0.png" src="_images/Colorretal_-_obito_cancer_32_0.png" />
</div>
</div>
<p>A coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code> foi a mais importante aqui também, com isso, os valores mais altos desta variável, mostrados em rosa, influenciaram mais o modelo na previsão da classe 1 (óbito por câncer). Já os valores mais baixos desta coluna, em azul, tem mais peso para previsão ser da classe 0. Este comportamento faz sentido, pois quanto mais alto o estágio, maior é a extensão do câncer, assim menor a chance de sobrevivência.</p>
<p>O raciocínio para analisar as outras colunas é o mesmo utilizado para o estadiamento clínico.</p>
<section id="Optuna">
<h4>Optuna<a class="headerlink" href="#Optuna" title="Permalink to this heading"></a></h4>
<p>Para fazer a busca pelos melhores hiperparâmetros, será utilizado a biblioteca Optuna, definindo o intervalo para os parâmetros do modelo a serem buscados.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Folds com a mesma proporção das classes</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função com o modelos e seus parâmetros, que terá sua métrica maximizada</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">min_samples_split</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">max_samples</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;max_samples&#39;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;criterion&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">])</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                                 <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">,</span>
                                 <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                                 <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                           <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação do estudo e procura pelos hiperparâmetros</span>
<span class="n">studyRF</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhor tentativa</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">best_trial</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FrozenTrial(number=92, state=TrialState.COMPLETE, values=[0.759440917196401], datetime_start=datetime.datetime(2023, 4, 12, 0, 56, 52, 730637), datetime_complete=datetime.datetime(2023, 4, 12, 0, 58, 1, 911801), params={&#39;n_estimators&#39;: 201, &#39;max_depth&#39;: 17, &#39;min_samples_split&#39;: 2, &#39;min_samples_leaf&#39;: 3, &#39;max_samples&#39;: 1.0, &#39;criterion&#39;: &#39;gini&#39;}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={&#39;n_estimators&#39;: IntDistribution(high=250, log=False, low=50, step=1), &#39;max_depth&#39;: IntDistribution(high=18, log=False, low=3, step=1), &#39;min_samples_split&#39;: IntDistribution(high=10, log=False, low=2, step=1), &#39;min_samples_leaf&#39;: IntDistribution(high=7, log=False, low=1, step=1), &#39;max_samples&#39;: FloatDistribution(high=1.0, log=False, low=0.7, step=0.1), &#39;criterion&#39;: CategoricalDistribution(choices=(&#39;gini&#39;, &#39;entropy&#39;))}, trial_id=92, value=None)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhores parâmetros</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;n_estimators&#39;: 201,
 &#39;max_depth&#39;: 17,
 &#39;min_samples_split&#39;: 2,
 &#39;min_samples_leaf&#39;: 3,
 &#39;max_samples&#39;: 1.0,
 &#39;criterion&#39;: &#39;gini&#39;}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">studyRF</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modelo com os melhores parâmetros</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">studyRF</span><span class="o">.</span><span class="n">best_params</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;random_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;class_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">2.3</span><span class="p">}</span>

<span class="n">rf_optuna</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rf_optuna</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="n">rf_optuna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(class_weight={0: 1, 1: 2.3}, max_depth=17,
                       max_samples=1.0, min_samples_leaf=3, n_estimators=201,
                       random_state=10)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(class_weight={0: 1, 1: 2.3}, max_depth=17,
                       max_samples=1.0, min_samples_leaf=3, n_estimators=201,
                       random_state=10)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão do modelo Random Forest otimizado</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_43_0.png" src="_images/Colorretal_-_obito_cancer_43_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.825     0.768     0.796      4695
           1      0.699     0.768     0.731      3284

    accuracy                          0.768      7979
   macro avg      0.762     0.768     0.764      7979
weighted avg      0.773     0.768     0.769      7979

</pre></div></div>
</div>
<blockquote>
<div><p>Há uma melhora de acurácia em relação ao primeiro modelo testado, de 76% para 77%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC do modelo otimizado</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_45_0.png" src="_images/Colorretal_-_obito_cancer_45_0.png" />
</div>
</div>
<blockquote>
<div><p>A curva ROC mostra que o modelo possui overfitting, pois para o conjunto de treino temos AUC = 0,974 e para o teste AUC = 0,844, essa diferença caracteriza o problema.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP, para o modelo com os melhores hiperparâmetros</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No data for colormapping provided via &#39;c&#39;. Parameters &#39;vmin&#39;, &#39;vmax&#39; will be ignored
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_47_1.png" src="_images/Colorretal_-_obito_cancer_47_1.png" />
</div>
</div>
</section>
</section>
<section id="XGBoost">
<h3><strong>XGBoost</strong><a class="headerlink" href="#XGBoost" title="Permalink to this heading"></a></h3>
<p>O modelo XGBoost também terá alguns hiperparâmetros definidos para obter um modelo base e depois será realizada a busca dos melhores parâmetros utilizando o Optuna.</p>
<p>Os parâmetros definidos para este primeiro modelo serão:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code>: para repetibilidade do treinamento do modelo. Será utilizado na busca pelos hiperparâmetros também, sempre como mesmo valor definido na variável <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: será definido como 4, pois o padrão do modelo é 3 de profundidade máxima para as árvores, deixando o modelo muito simples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>: usado para definir o peso da classe 1 no treinamento do modelo, pois temos classes desbalanceadas.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo XGBoost</span>
<span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.58</span><span class="p">,</span>
                    <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_51_0.png" src="_images/Colorretal_-_obito_cancer_51_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.823     0.765     0.793      4695
           1      0.695     0.764     0.728      3284

    accuracy                          0.765      7979
   macro avg      0.759     0.765     0.760      7979
weighted avg      0.770     0.765     0.766      7979

</pre></div></div>
</div>
<blockquote>
<div><p>A matriz obtida para o modelo XGBoost apresentou diagonal equilibrada em ambas as classes, com 77% de acurácia.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_53_0.png" src="_images/Colorretal_-_obito_cancer_53_0.png" />
</div>
</div>
<blockquote>
<div><p>Como a métrica AUC possui valores próximos para o conjunto de treino e de teste, 0,887 e 0,842 respectivamente, pode-se dizer que há apenas um pouco de overfitting, não sendo algo de grande preocupação.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features</span>
<span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_55_0.png" src="_images/Colorretal_-_obito_cancer_55_0.png" />
</div>
</div>
<blockquote>
<div><p>As features mais importantes nesta visualização são <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code> e <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_57_0.png" src="_images/Colorretal_-_obito_cancer_57_0.png" />
</div>
</div>
<p>A coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code> foi a mais importante, com isso, os valores mais altos desta variável, mostrados em rosa, influenciaram mais o modelo na previsão da classe 1 (óbito por câncer). Já os valores mais baixos desta coluna, em azul, tem mais peso para previsão ser da classe 0. Este comportamento faz sentido, pois quanto mais alto o estágio, maior é a extensão do câncer, assim menor a chance de sobrevivência.</p>
<p>O raciocínio para analisar as outras colunas é o mesmo utilizado para o estadiamento clínico.</p>
<section id="id1">
<h4>Optuna<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h4>
<p>Para fazer a busca pelos melhores hiperparâmetros, será utilizado a biblioteca Optuna, definindo o intervalo para os parâmetros do modelo a serem buscados.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Folds com a mesma proporção das classes</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função com o modelos e seus parâmetros, que terá sua métrica maximizada</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">min_child_weight</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_child_weight&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">colsample_bytree</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;colsample_bytree&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
                        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                        <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
                        <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                        <span class="n">min_child_weight</span><span class="o">=</span><span class="n">min_child_weight</span><span class="p">,</span>
                        <span class="n">colsample_bytree</span><span class="o">=</span><span class="n">colsample_bytree</span><span class="p">,</span>
                        <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                           <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação do estudo e procura pelos hiperparâmetros</span>
<span class="n">studyXGB</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhor tentativa</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">best_trial</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FrozenTrial(number=61, state=TrialState.COMPLETE, values=[0.7643089701876458], datetime_start=datetime.datetime(2023, 4, 12, 2, 1, 32, 43835), datetime_complete=datetime.datetime(2023, 4, 12, 2, 2, 5, 449827), params={&#39;n_estimators&#39;: 205, &#39;max_depth&#39;: 5, &#39;learning_rate&#39;: 0.15000000000000002, &#39;gamma&#39;: 0.3, &#39;min_child_weight&#39;: 2, &#39;colsample_bytree&#39;: 0.5}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={&#39;n_estimators&#39;: IntDistribution(high=250, log=False, low=50, step=1), &#39;max_depth&#39;: IntDistribution(high=18, log=False, low=3, step=1), &#39;learning_rate&#39;: FloatDistribution(high=0.2, log=False, low=0.05, step=0.05), &#39;gamma&#39;: FloatDistribution(high=0.3, log=False, low=0.0, step=0.1), &#39;min_child_weight&#39;: IntDistribution(high=7, log=False, low=1, step=1), &#39;colsample_bytree&#39;: FloatDistribution(high=0.7, log=False, low=0.3, step=0.1)}, trial_id=61, value=None)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhores parâmetros</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;n_estimators&#39;: 205,
 &#39;max_depth&#39;: 5,
 &#39;learning_rate&#39;: 0.15000000000000002,
 &#39;gamma&#39;: 0.3,
 &#39;min_child_weight&#39;: 2,
 &#39;colsample_bytree&#39;: 0.5}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">studyXGB</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modelo com os melhores parâmetros</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">studyXGB</span><span class="o">.</span><span class="n">best_params</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;random_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;scale_pos_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.575</span>

<span class="n">xgb_optuna</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">xgb_optuna</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="n">xgb_optuna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-9 {color: black;background-color: white;}#sk-container-id-9 pre{padding: 0;}#sk-container-id-9 div.sk-toggleable {background-color: white;}#sk-container-id-9 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-9 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-9 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-9 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-9 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-9 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-9 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-9 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-9 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-9 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-9 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-9 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-9 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-9 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-9 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-9 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-9 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-9 div.sk-item {position: relative;z-index: 1;}#sk-container-id-9 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-9 div.sk-item::before, #sk-container-id-9 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-9 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-9 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-9 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-9 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-9 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-9 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-9 div.sk-label-container {text-align: center;}#sk-container-id-9 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-9 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-9" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.5, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.3, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.15000000000000002,
              max_bin=None, max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=2, missing=nan, monotone_constraints=None,
              n_estimators=205, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" checked><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.5, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.3, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.15000000000000002,
              max_bin=None, max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=2, missing=nan, monotone_constraints=None,
              n_estimators=205, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão do modelo XGBoost otimizado</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_68_0.png" src="_images/Colorretal_-_obito_cancer_68_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.828     0.770     0.798      4695
           1      0.701     0.771     0.735      3284

    accuracy                          0.771      7979
   macro avg      0.765     0.771     0.766      7979
weighted avg      0.776     0.771     0.772      7979

</pre></div></div>
</div>
<blockquote>
<div><p>Após a escolha dos hiperparâmetros, a acurácia de ambos os modelos ficou em torno de 77%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC do modelo otimizado</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_70_0.png" src="_images/Colorretal_-_obito_cancer_70_0.png" />
</div>
</div>
<blockquote>
<div><p>A curva ROC mostra que o modelo possui um pouco de overfitting, pois para o conjunto de treino temos AUC = 0,908 e para o teste AUC = 0,845, essa diferença caracteriza o problema.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP, para o modelo com os melhores hiperparâmetros</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ntree_limit is deprecated, use `iteration_range` or model slicing instead.
No data for colormapping provided via &#39;c&#39;. Parameters &#39;vmin&#39;, &#39;vmax&#39; will be ignored
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_72_1.png" src="_images/Colorretal_-_obito_cancer_72_1.png" />
</div>
</div>
</section>
</section>
<section id="ROCs">
<h3><strong>ROCs</strong><a class="headerlink" href="#ROCs" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Treino</span>
<span class="n">roc_together</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">rf_optuna</span><span class="p">,</span> <span class="n">xgb_optuna</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_74_0.png" src="_images/Colorretal_-_obito_cancer_74_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Teste</span>
<span class="n">roc_together</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">rf_optuna</span><span class="p">,</span> <span class="n">xgb_optuna</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_75_0.png" src="_images/Colorretal_-_obito_cancer_75_0.png" />
</div>
</div>
</section>
</section>
<section id="RN">
<h2><strong>RN</strong><a class="headerlink" href="#RN" title="Permalink to this heading"></a></h2>
<section id="Importação-das-bibliotecas-e-funções">
<h3><strong>Importação das bibliotecas e funções</strong><a class="headerlink" href="#Importação-das-bibliotecas-e-funções" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.regularizers</span> <span class="kn">import</span> <span class="n">l2</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definição de cores para gráficos</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot metrics after training the RNA.</span>

<span class="sd">    :param history: RNA training history.</span>

<span class="sd">    :return: no value</span>
<span class="sd">    :rtype: none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">metric</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span> <span class="n">metric</span><span class="p">],</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Val&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;loss&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Complexa">
<h3><strong>Criação e treinamento da RNA Complexa</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Complexa" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">neg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="n">pos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exemplos:</span><span class="se">\n</span><span class="s1"> Total: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="se">\n</span><span class="s1"> Positivos: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">pos</span><span class="o">/</span><span class="n">total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">% do total)&#39;</span><span class="p">)</span>

<span class="c1"># Cálculo dos pesos das duas classe</span>
<span class="n">weight_for_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">neg</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">weight_for_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pos</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

<span class="c1"># Dicionário de pesos das classes para treinamento</span>
<span class="n">class_weight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">weight_for_0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">weight_for_1</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 0: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 1: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Exemplos:
 Total: 23937
 Positivos: 9852 (41.16% do total)
Peso da classe 0: 0.85
Peso da classe 1: 1.21
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;input_features&#39;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;selu&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Concatenate</span>
<span class="n">x_concat</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">()([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">input_features</span><span class="p">])</span>

<span class="n">x4</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">x_concat</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;out_dense&#39;</span><span class="p">)(</span><span class="n">x4</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">input_features</span><span class="p">],</span>
                    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">out</span><span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model&#34;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to
==================================================================================================
 input_features (InputLayer)    [(None, 25)]         0           []

 dense (Dense)                  (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 dense_1 (Dense)                (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 dense_2 (Dense)                (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 concatenate (Concatenate)      (None, 409)          0           [&#39;dense[0][0]&#39;,
                                                                  &#39;dense_1[0][0]&#39;,
                                                                  &#39;dense_2[0][0]&#39;,
                                                                  &#39;input_features[0][0]&#39;]

 dense_3 (Dense)                (None, 32)           13120       [&#39;concatenate[0][0]&#39;]

 out_dense (Dense)              (None, 1)            33          [&#39;dense_3[0][0]&#39;]

==================================================================================================
Total params: 23,137
Trainable params: 23,137
Non-trainable params: 0
__________________________________________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_86_0.png" src="_images/Colorretal_-_obito_cancer_86_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
749/749 - 4s - loss: 0.8618 - accuracy: 0.7352 - precision: 0.6591 - recall: 0.7387 - auc: 0.8048 - val_loss: 0.5659 - val_accuracy: 0.7424 - val_precision: 0.6691 - val_recall: 0.7403 - val_auc: 0.8121 - 4s/epoch - 5ms/step
Epoch 2/50
749/749 - 2s - loss: 0.5535 - accuracy: 0.7409 - precision: 0.6676 - recall: 0.7379 - auc: 0.8120 - val_loss: 0.5461 - val_accuracy: 0.7422 - val_precision: 0.6704 - val_recall: 0.7351 - val_auc: 0.8110 - 2s/epoch - 3ms/step
Epoch 3/50
749/749 - 2s - loss: 0.5464 - accuracy: 0.7420 - precision: 0.6677 - recall: 0.7427 - auc: 0.8128 - val_loss: 0.5326 - val_accuracy: 0.7501 - val_precision: 0.7014 - val_recall: 0.6839 - val_auc: 0.8146 - 2s/epoch - 3ms/step
Epoch 4/50
749/749 - 2s - loss: 0.5435 - accuracy: 0.7435 - precision: 0.6704 - recall: 0.7413 - auc: 0.8137 - val_loss: 0.5366 - val_accuracy: 0.7431 - val_precision: 0.7247 - val_recall: 0.6060 - val_auc: 0.8113 - 2s/epoch - 3ms/step
Epoch 5/50
749/749 - 3s - loss: 0.5426 - accuracy: 0.7461 - precision: 0.6747 - recall: 0.7397 - auc: 0.8151 - val_loss: 0.5340 - val_accuracy: 0.7475 - val_precision: 0.6820 - val_recall: 0.7241 - val_auc: 0.8165 - 3s/epoch - 5ms/step
Epoch 6/50
749/749 - 3s - loss: 0.5405 - accuracy: 0.7482 - precision: 0.6754 - recall: 0.7473 - auc: 0.8165 - val_loss: 0.5477 - val_accuracy: 0.7413 - val_precision: 0.6560 - val_recall: 0.7811 - val_auc: 0.8201 - 3s/epoch - 4ms/step
Epoch 7/50
749/749 - 1s - loss: 0.5399 - accuracy: 0.7484 - precision: 0.6765 - recall: 0.7449 - auc: 0.8171 - val_loss: 0.5476 - val_accuracy: 0.7374 - val_precision: 0.6492 - val_recall: 0.7878 - val_auc: 0.8202 - 1s/epoch - 2ms/step
Epoch 8/50
749/749 - 1s - loss: 0.5384 - accuracy: 0.7475 - precision: 0.6766 - recall: 0.7408 - auc: 0.8176 - val_loss: 0.5310 - val_accuracy: 0.7512 - val_precision: 0.6816 - val_recall: 0.7424 - val_auc: 0.8212 - 1s/epoch - 2ms/step
Epoch 9/50
749/749 - 1s - loss: 0.5370 - accuracy: 0.7471 - precision: 0.6754 - recall: 0.7424 - auc: 0.8193 - val_loss: 0.5320 - val_accuracy: 0.7466 - val_precision: 0.6829 - val_recall: 0.7174 - val_auc: 0.8180 - 1s/epoch - 2ms/step
Epoch 10/50
749/749 - 1s - loss: 0.5357 - accuracy: 0.7500 - precision: 0.6790 - recall: 0.7443 - auc: 0.8204 - val_loss: 0.5289 - val_accuracy: 0.7522 - val_precision: 0.7172 - val_recall: 0.6571 - val_auc: 0.8191 - 1s/epoch - 2ms/step
Epoch 11/50
749/749 - 1s - loss: 0.5343 - accuracy: 0.7483 - precision: 0.6765 - recall: 0.7443 - auc: 0.8210 - val_loss: 0.5287 - val_accuracy: 0.7531 - val_precision: 0.7035 - val_recall: 0.6915 - val_auc: 0.8194 - 1s/epoch - 2ms/step
Epoch 12/50
749/749 - 2s - loss: 0.5349 - accuracy: 0.7493 - precision: 0.6791 - recall: 0.7409 - auc: 0.8205 - val_loss: 0.5336 - val_accuracy: 0.7491 - val_precision: 0.6717 - val_recall: 0.7637 - val_auc: 0.8221 - 2s/epoch - 2ms/step
Epoch 13/50
749/749 - 2s - loss: 0.5312 - accuracy: 0.7515 - precision: 0.6803 - recall: 0.7476 - auc: 0.8229 - val_loss: 0.5411 - val_accuracy: 0.7433 - val_precision: 0.6580 - val_recall: 0.7838 - val_auc: 0.8232 - 2s/epoch - 2ms/step
Epoch 14/50
749/749 - 1s - loss: 0.5309 - accuracy: 0.7513 - precision: 0.6822 - recall: 0.7407 - auc: 0.8234 - val_loss: 0.5455 - val_accuracy: 0.7432 - val_precision: 0.6641 - val_recall: 0.7610 - val_auc: 0.8187 - 1s/epoch - 2ms/step
Epoch 15/50
749/749 - 1s - loss: 0.5298 - accuracy: 0.7515 - precision: 0.6807 - recall: 0.7460 - auc: 0.8234 - val_loss: 0.5600 - val_accuracy: 0.7305 - val_precision: 0.6346 - val_recall: 0.8139 - val_auc: 0.8231 - 1s/epoch - 2ms/step
Epoch 16/50
749/749 - 1s - loss: 0.5294 - accuracy: 0.7531 - precision: 0.6828 - recall: 0.7472 - auc: 0.8245 - val_loss: 0.5378 - val_accuracy: 0.7427 - val_precision: 0.6606 - val_recall: 0.7710 - val_auc: 0.8224 - 1s/epoch - 2ms/step
Epoch 17/50
749/749 - 1s - loss: 0.5314 - accuracy: 0.7519 - precision: 0.6803 - recall: 0.7493 - auc: 0.8233 - val_loss: 0.5197 - val_accuracy: 0.7579 - val_precision: 0.7060 - val_recall: 0.7055 - val_auc: 0.8254 - 1s/epoch - 2ms/step
Epoch 18/50
749/749 - 1s - loss: 0.5280 - accuracy: 0.7532 - precision: 0.6828 - recall: 0.7477 - auc: 0.8253 - val_loss: 0.5242 - val_accuracy: 0.7496 - val_precision: 0.6895 - val_recall: 0.7125 - val_auc: 0.8225 - 1s/epoch - 2ms/step
Epoch 19/50
749/749 - 1s - loss: 0.5276 - accuracy: 0.7539 - precision: 0.6844 - recall: 0.7463 - auc: 0.8251 - val_loss: 0.5317 - val_accuracy: 0.7492 - val_precision: 0.6703 - val_recall: 0.7689 - val_auc: 0.8250 - 1s/epoch - 2ms/step
Epoch 20/50
749/749 - 1s - loss: 0.5265 - accuracy: 0.7538 - precision: 0.6837 - recall: 0.7477 - auc: 0.8262 - val_loss: 0.5241 - val_accuracy: 0.7527 - val_precision: 0.6821 - val_recall: 0.7476 - val_auc: 0.8251 - 1s/epoch - 2ms/step
Epoch 21/50
749/749 - 2s - loss: 0.5270 - accuracy: 0.7544 - precision: 0.6855 - recall: 0.7452 - auc: 0.8255 - val_loss: 0.5359 - val_accuracy: 0.7452 - val_precision: 0.6626 - val_recall: 0.7762 - val_auc: 0.8254 - 2s/epoch - 3ms/step
Epoch 22/50
749/749 - 2s - loss: 0.5249 - accuracy: 0.7550 - precision: 0.6857 - recall: 0.7475 - auc: 0.8271 - val_loss: 0.5413 - val_accuracy: 0.7421 - val_precision: 0.6546 - val_recall: 0.7905 - val_auc: 0.8270 - 2s/epoch - 2ms/step
Epoch 23/50
749/749 - 1s - loss: 0.5265 - accuracy: 0.7554 - precision: 0.6863 - recall: 0.7472 - auc: 0.8268 - val_loss: 0.5234 - val_accuracy: 0.7537 - val_precision: 0.6892 - val_recall: 0.7314 - val_auc: 0.8248 - 1s/epoch - 2ms/step
Epoch 24/50
749/749 - 1s - loss: 0.5246 - accuracy: 0.7547 - precision: 0.6862 - recall: 0.7446 - auc: 0.8272 - val_loss: 0.5241 - val_accuracy: 0.7536 - val_precision: 0.6852 - val_recall: 0.7424 - val_auc: 0.8262 - 1s/epoch - 2ms/step
Epoch 25/50
749/749 - 1s - loss: 0.5238 - accuracy: 0.7554 - precision: 0.6867 - recall: 0.7462 - auc: 0.8282 - val_loss: 0.5288 - val_accuracy: 0.7490 - val_precision: 0.6758 - val_recall: 0.7497 - val_auc: 0.8261 - 1s/epoch - 2ms/step
Epoch 26/50
749/749 - 1s - loss: 0.5239 - accuracy: 0.7563 - precision: 0.6873 - recall: 0.7482 - auc: 0.8278 - val_loss: 0.5309 - val_accuracy: 0.7477 - val_precision: 0.6688 - val_recall: 0.7667 - val_auc: 0.8264 - 1s/epoch - 2ms/step
Epoch 27/50
749/749 - 1s - loss: 0.5225 - accuracy: 0.7572 - precision: 0.6889 - recall: 0.7478 - auc: 0.8284 - val_loss: 0.5321 - val_accuracy: 0.7448 - val_precision: 0.6684 - val_recall: 0.7543 - val_auc: 0.8240 - 1s/epoch - 2ms/step
Epoch 28/50
749/749 - 2s - loss: 0.5220 - accuracy: 0.7558 - precision: 0.6876 - recall: 0.7452 - auc: 0.8289 - val_loss: 0.5230 - val_accuracy: 0.7570 - val_precision: 0.7006 - val_recall: 0.7153 - val_auc: 0.8231 - 2s/epoch - 2ms/step
Epoch 29/50
749/749 - 3s - loss: 0.5234 - accuracy: 0.7554 - precision: 0.6879 - recall: 0.7427 - auc: 0.8284 - val_loss: 0.5280 - val_accuracy: 0.7477 - val_precision: 0.6722 - val_recall: 0.7555 - val_auc: 0.8265 - 3s/epoch - 4ms/step
Epoch 30/50
749/749 - 2s - loss: 0.5218 - accuracy: 0.7574 - precision: 0.6897 - recall: 0.7464 - auc: 0.8292 - val_loss: 0.5284 - val_accuracy: 0.7475 - val_precision: 0.6726 - val_recall: 0.7530 - val_auc: 0.8258 - 2s/epoch - 2ms/step
Epoch 31/50
749/749 - 1s - loss: 0.5221 - accuracy: 0.7562 - precision: 0.6886 - recall: 0.7441 - auc: 0.8291 - val_loss: 0.5325 - val_accuracy: 0.7467 - val_precision: 0.6714 - val_recall: 0.7533 - val_auc: 0.8230 - 1s/epoch - 2ms/step
Epoch 32/50
749/749 - 1s - loss: 0.5217 - accuracy: 0.7573 - precision: 0.6902 - recall: 0.7444 - auc: 0.8293 - val_loss: 0.5245 - val_accuracy: 0.7537 - val_precision: 0.6832 - val_recall: 0.7488 - val_auc: 0.8266 - 1s/epoch - 2ms/step
Epoch 33/50
749/749 - 1s - loss: 0.5197 - accuracy: 0.7583 - precision: 0.6912 - recall: 0.7462 - auc: 0.8305 - val_loss: 0.5181 - val_accuracy: 0.7572 - val_precision: 0.6993 - val_recall: 0.7195 - val_auc: 0.8274 - 1s/epoch - 2ms/step
Epoch 34/50
749/749 - 1s - loss: 0.5205 - accuracy: 0.7580 - precision: 0.6918 - recall: 0.7429 - auc: 0.8303 - val_loss: 0.5356 - val_accuracy: 0.7433 - val_precision: 0.6606 - val_recall: 0.7741 - val_auc: 0.8260 - 1s/epoch - 2ms/step
Epoch 35/50
749/749 - 1s - loss: 0.5210 - accuracy: 0.7576 - precision: 0.6903 - recall: 0.7454 - auc: 0.8300 - val_loss: 0.5211 - val_accuracy: 0.7549 - val_precision: 0.6928 - val_recall: 0.7266 - val_auc: 0.8273 - 1s/epoch - 2ms/step
Epoch 36/50
749/749 - 1s - loss: 0.5188 - accuracy: 0.7581 - precision: 0.6919 - recall: 0.7430 - auc: 0.8310 - val_loss: 0.5298 - val_accuracy: 0.7491 - val_precision: 0.6721 - val_recall: 0.7622 - val_auc: 0.8246 - 1s/epoch - 2ms/step
Epoch 37/50
749/749 - 2s - loss: 0.5193 - accuracy: 0.7594 - precision: 0.6934 - recall: 0.7446 - auc: 0.8309 - val_loss: 0.5266 - val_accuracy: 0.7520 - val_precision: 0.6825 - val_recall: 0.7430 - val_auc: 0.8255 - 2s/epoch - 2ms/step
Epoch 38/50
749/749 - 2s - loss: 0.5208 - accuracy: 0.7599 - precision: 0.6935 - recall: 0.7463 - auc: 0.8303 - val_loss: 0.5220 - val_accuracy: 0.7570 - val_precision: 0.6886 - val_recall: 0.7476 - val_auc: 0.8284 - 2s/epoch - 3ms/step
Epoch 39/50
749/749 - 1s - loss: 0.5199 - accuracy: 0.7581 - precision: 0.6907 - recall: 0.7468 - auc: 0.8307 - val_loss: 0.5250 - val_accuracy: 0.7552 - val_precision: 0.6874 - val_recall: 0.7433 - val_auc: 0.8266 - 1s/epoch - 2ms/step
Epoch 40/50
749/749 - 1s - loss: 0.5194 - accuracy: 0.7589 - precision: 0.6920 - recall: 0.7463 - auc: 0.8309 - val_loss: 0.5193 - val_accuracy: 0.7586 - val_precision: 0.6949 - val_recall: 0.7372 - val_auc: 0.8294 - 1s/epoch - 2ms/step
Epoch 41/50
749/749 - 1s - loss: 0.5215 - accuracy: 0.7588 - precision: 0.6947 - recall: 0.7387 - auc: 0.8297 - val_loss: 0.5215 - val_accuracy: 0.7512 - val_precision: 0.6790 - val_recall: 0.7503 - val_auc: 0.8288 - 1s/epoch - 2ms/step
Epoch 42/50
749/749 - 1s - loss: 0.5185 - accuracy: 0.7586 - precision: 0.6914 - recall: 0.7469 - auc: 0.8312 - val_loss: 0.5243 - val_accuracy: 0.7542 - val_precision: 0.6825 - val_recall: 0.7533 - val_auc: 0.8286 - 1s/epoch - 2ms/step
Epoch 43/50
749/749 - 2s - loss: 0.5191 - accuracy: 0.7580 - precision: 0.6908 - recall: 0.7457 - auc: 0.8309 - val_loss: 0.5191 - val_accuracy: 0.7571 - val_precision: 0.6951 - val_recall: 0.7302 - val_auc: 0.8279 - 2s/epoch - 2ms/step
Epoch 44/50
749/749 - 2s - loss: 0.5181 - accuracy: 0.7595 - precision: 0.6932 - recall: 0.7454 - auc: 0.8317 - val_loss: 0.5347 - val_accuracy: 0.7512 - val_precision: 0.6755 - val_recall: 0.7613 - val_auc: 0.8242 - 2s/epoch - 2ms/step
Epoch 45/50
749/749 - 2s - loss: 0.5187 - accuracy: 0.7585 - precision: 0.6921 - recall: 0.7446 - auc: 0.8312 - val_loss: 0.5187 - val_accuracy: 0.7546 - val_precision: 0.6879 - val_recall: 0.7390 - val_auc: 0.8287 - 2s/epoch - 2ms/step
Epoch 46/50
749/749 - 2s - loss: 0.5175 - accuracy: 0.7595 - precision: 0.6928 - recall: 0.7469 - auc: 0.8319 - val_loss: 0.5221 - val_accuracy: 0.7549 - val_precision: 0.6904 - val_recall: 0.7333 - val_auc: 0.8277 - 2s/epoch - 3ms/step
Epoch 47/50
749/749 - 1s - loss: 0.5175 - accuracy: 0.7607 - precision: 0.6949 - recall: 0.7461 - auc: 0.8320 - val_loss: 0.5236 - val_accuracy: 0.7531 - val_precision: 0.6819 - val_recall: 0.7500 - val_auc: 0.8289 - 1s/epoch - 2ms/step
Epoch 48/50
749/749 - 1s - loss: 0.5188 - accuracy: 0.7597 - precision: 0.6949 - recall: 0.7419 - auc: 0.8313 - val_loss: 0.5255 - val_accuracy: 0.7502 - val_precision: 0.6780 - val_recall: 0.7488 - val_auc: 0.8255 - 1s/epoch - 2ms/step
Epoch 49/50
749/749 - 1s - loss: 0.5178 - accuracy: 0.7593 - precision: 0.6936 - recall: 0.7438 - auc: 0.8318 - val_loss: 0.5304 - val_accuracy: 0.7515 - val_precision: 0.6786 - val_recall: 0.7527 - val_auc: 0.8263 - 1s/epoch - 2ms/step
Epoch 50/50
749/749 - 1s - loss: 0.5169 - accuracy: 0.7602 - precision: 0.6944 - recall: 0.7455 - auc: 0.8322 - val_loss: 0.5167 - val_accuracy: 0.7591 - val_precision: 0.6951 - val_recall: 0.7387 - val_auc: 0.8305 - 1s/epoch - 2ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_89_0.png" src="_images/Colorretal_-_obito_cancer_89_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 958us/step
250/250 [==============================] - 0s 1ms/step
Número de exemplos positivos do conjunto de teste = 3284
loss: 0.5167
accuracy: 0.7591
precision: 0.6951
recall: 0.7387
auc: 0.8305
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7163
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_92_0.png" src="_images/Colorretal_-_obito_cancer_92_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7560545919869662
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_94_0.png" src="_images/Colorretal_-_obito_cancer_94_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1"># custo_e_metricas_val = rna_reg.evaluate(X_val_norm, y_val)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 1ms/step - loss: 0.5104 - accuracy: 0.7650 - precision: 0.7074 - recall: 0.7314 - auc: 0.8347
250/250 [==============================] - 0s 2ms/step - loss: 0.5167 - accuracy: 0.7591 - precision: 0.6951 - recall: 0.7387 - auc: 0.8305
</pre></div></div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Residual">
<h3><strong>Criação e treinamento da RNA Residual</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Residual" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função que cria o bloco para a RN residual</span>
<span class="k">def</span> <span class="nf">bloco_residual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

    <span class="n">z1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n</span><span class="p">)(</span><span class="n">z1</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">Add</span><span class="p">()([</span><span class="n">x</span><span class="p">,</span> <span class="n">z2</span><span class="p">])</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="nb">sum</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a2</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definição da entrada</span>
<span class="n">input_shape</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>

<span class="n">X1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">input_features</span><span class="p">)</span>

<span class="n">X2</span> <span class="o">=</span> <span class="n">bloco_residual</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">X3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">X2</span><span class="p">)</span>

<span class="n">X4</span> <span class="o">=</span> <span class="n">bloco_residual</span><span class="p">(</span><span class="n">X3</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">X5</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">X4</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)(</span><span class="n">X5</span><span class="p">)</span>

<span class="c1"># Criação da RNA</span>
<span class="n">rna</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">input_features</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

<span class="c1"># Mostra resumo da RNA</span>
<span class="n">rna</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model_1&#34;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to
==================================================================================================
 input_1 (InputLayer)           [(None, 25)]         0           []

 dense_4 (Dense)                (None, 64)           1664        [&#39;input_1[0][0]&#39;]

 dense_5 (Dense)                (None, 64)           4160        [&#39;dense_4[0][0]&#39;]

 dense_6 (Dense)                (None, 64)           4160        [&#39;dense_5[0][0]&#39;]

 add (Add)                      (None, 64)           0           [&#39;dense_4[0][0]&#39;,
                                                                  &#39;dense_6[0][0]&#39;]

 activation (Activation)        (None, 64)           0           [&#39;add[0][0]&#39;]

 dense_7 (Dense)                (None, 64)           4160        [&#39;activation[0][0]&#39;]

 dense_8 (Dense)                (None, 64)           4160        [&#39;dense_7[0][0]&#39;]

 dense_9 (Dense)                (None, 64)           4160        [&#39;dense_8[0][0]&#39;]

 add_1 (Add)                    (None, 64)           0           [&#39;dense_7[0][0]&#39;,
                                                                  &#39;dense_9[0][0]&#39;]

 activation_1 (Activation)      (None, 64)           0           [&#39;add_1[0][0]&#39;]

 dense_10 (Dense)               (None, 16)           1040        [&#39;activation_1[0][0]&#39;]

 dense_11 (Dense)               (None, 1)            17          [&#39;dense_10[0][0]&#39;]

==================================================================================================
Total params: 23,521
Trainable params: 23,521
Non-trainable params: 0
__________________________________________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">rna</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_99_0.png" src="_images/Colorretal_-_obito_cancer_99_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                        <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">rna</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
749/749 - 3s - loss: 0.5443 - accuracy: 0.7289 - precision: 0.6524 - recall: 0.7305 - auc: 0.8009 - val_loss: 0.5188 - val_accuracy: 0.7440 - val_precision: 0.6819 - val_recall: 0.7083 - val_auc: 0.8179 - 3s/epoch - 4ms/step
Epoch 2/50
749/749 - 2s - loss: 0.5139 - accuracy: 0.7531 - precision: 0.6840 - recall: 0.7436 - auc: 0.8261 - val_loss: 0.5108 - val_accuracy: 0.7559 - val_precision: 0.7080 - val_recall: 0.6924 - val_auc: 0.8225 - 2s/epoch - 3ms/step
Epoch 3/50
749/749 - 2s - loss: 0.5093 - accuracy: 0.7594 - precision: 0.6935 - recall: 0.7444 - auc: 0.8294 - val_loss: 0.5188 - val_accuracy: 0.7511 - val_precision: 0.6937 - val_recall: 0.7077 - val_auc: 0.8227 - 2s/epoch - 3ms/step
Epoch 4/50
749/749 - 1s - loss: 0.5017 - accuracy: 0.7619 - precision: 0.6982 - recall: 0.7426 - auc: 0.8351 - val_loss: 0.5082 - val_accuracy: 0.7515 - val_precision: 0.6995 - val_recall: 0.6946 - val_auc: 0.8242 - 1s/epoch - 2ms/step
Epoch 5/50
749/749 - 1s - loss: 0.4954 - accuracy: 0.7666 - precision: 0.7035 - recall: 0.7481 - auc: 0.8397 - val_loss: 0.5096 - val_accuracy: 0.7554 - val_precision: 0.6928 - val_recall: 0.7287 - val_auc: 0.8285 - 1s/epoch - 2ms/step
Epoch 6/50
749/749 - 1s - loss: 0.4902 - accuracy: 0.7694 - precision: 0.7067 - recall: 0.7517 - auc: 0.8435 - val_loss: 0.5427 - val_accuracy: 0.7418 - val_precision: 0.6602 - val_recall: 0.7680 - val_auc: 0.8195 - 1s/epoch - 2ms/step
Epoch 7/50
749/749 - 2s - loss: 0.4839 - accuracy: 0.7722 - precision: 0.7102 - recall: 0.7544 - auc: 0.8480 - val_loss: 0.5038 - val_accuracy: 0.7597 - val_precision: 0.7151 - val_recall: 0.6918 - val_auc: 0.8282 - 2s/epoch - 2ms/step
Epoch 8/50
749/749 - 1s - loss: 0.4799 - accuracy: 0.7742 - precision: 0.7119 - recall: 0.7580 - auc: 0.8509 - val_loss: 0.5149 - val_accuracy: 0.7497 - val_precision: 0.6760 - val_recall: 0.7527 - val_auc: 0.8274 - 1s/epoch - 2ms/step
Epoch 9/50
749/749 - 1s - loss: 0.4727 - accuracy: 0.7774 - precision: 0.7134 - recall: 0.7675 - auc: 0.8555 - val_loss: 0.5340 - val_accuracy: 0.7421 - val_precision: 0.6710 - val_recall: 0.7323 - val_auc: 0.8185 - 1s/epoch - 2ms/step
Epoch 10/50
749/749 - 2s - loss: 0.4698 - accuracy: 0.7764 - precision: 0.7115 - recall: 0.7684 - auc: 0.8578 - val_loss: 0.5105 - val_accuracy: 0.7531 - val_precision: 0.6959 - val_recall: 0.7107 - val_auc: 0.8226 - 2s/epoch - 2ms/step
Epoch 11/50
749/749 - 2s - loss: 0.4644 - accuracy: 0.7822 - precision: 0.7200 - recall: 0.7706 - auc: 0.8615 - val_loss: 0.5178 - val_accuracy: 0.7540 - val_precision: 0.6920 - val_recall: 0.7250 - val_auc: 0.8236 - 2s/epoch - 3ms/step
Epoch 12/50
749/749 - 2s - loss: 0.4561 - accuracy: 0.7849 - precision: 0.7226 - recall: 0.7746 - auc: 0.8669 - val_loss: 0.5277 - val_accuracy: 0.7451 - val_precision: 0.6688 - val_recall: 0.7540 - val_auc: 0.8195 - 2s/epoch - 2ms/step
Epoch 13/50
749/749 - 1s - loss: 0.4499 - accuracy: 0.7889 - precision: 0.7273 - recall: 0.7792 - auc: 0.8704 - val_loss: 0.5375 - val_accuracy: 0.7461 - val_precision: 0.6772 - val_recall: 0.7320 - val_auc: 0.8179 - 1s/epoch - 2ms/step
Epoch 14/50
749/749 - 1s - loss: 0.4460 - accuracy: 0.7915 - precision: 0.7285 - recall: 0.7864 - auc: 0.8731 - val_loss: 0.5371 - val_accuracy: 0.7472 - val_precision: 0.6801 - val_recall: 0.7284 - val_auc: 0.8159 - 1s/epoch - 2ms/step
Epoch 15/50
749/749 - 1s - loss: 0.4370 - accuracy: 0.7951 - precision: 0.7336 - recall: 0.7886 - auc: 0.8784 - val_loss: 0.5339 - val_accuracy: 0.7423 - val_precision: 0.6748 - val_recall: 0.7217 - val_auc: 0.8110 - 1s/epoch - 2ms/step
Epoch 16/50
749/749 - 1s - loss: 0.4322 - accuracy: 0.7976 - precision: 0.7338 - recall: 0.7973 - auc: 0.8813 - val_loss: 0.5394 - val_accuracy: 0.7517 - val_precision: 0.6913 - val_recall: 0.7168 - val_auc: 0.8168 - 1s/epoch - 2ms/step
Epoch 17/50
749/749 - 1s - loss: 0.4236 - accuracy: 0.8026 - precision: 0.7401 - recall: 0.8022 - auc: 0.8862 - val_loss: 0.5462 - val_accuracy: 0.7467 - val_precision: 0.6749 - val_recall: 0.7421 - val_auc: 0.8143 - 1s/epoch - 2ms/step
Epoch 18/50
749/749 - 1s - loss: 0.4163 - accuracy: 0.8082 - precision: 0.7464 - recall: 0.8090 - auc: 0.8907 - val_loss: 0.5631 - val_accuracy: 0.7442 - val_precision: 0.6810 - val_recall: 0.7119 - val_auc: 0.8067 - 1s/epoch - 2ms/step
Epoch 19/50
749/749 - 2s - loss: 0.4081 - accuracy: 0.8124 - precision: 0.7524 - recall: 0.8111 - auc: 0.8952 - val_loss: 0.5986 - val_accuracy: 0.7371 - val_precision: 0.6553 - val_recall: 0.7619 - val_auc: 0.8120 - 2s/epoch - 3ms/step
Epoch 20/50
749/749 - 2s - loss: 0.4022 - accuracy: 0.8146 - precision: 0.7520 - recall: 0.8197 - auc: 0.8981 - val_loss: 0.6122 - val_accuracy: 0.7352 - val_precision: 0.6635 - val_recall: 0.7235 - val_auc: 0.8024 - 2s/epoch - 2ms/step
Epoch 21/50
749/749 - 1s - loss: 0.3944 - accuracy: 0.8179 - precision: 0.7580 - recall: 0.8191 - auc: 0.9021 - val_loss: 0.5927 - val_accuracy: 0.7373 - val_precision: 0.6659 - val_recall: 0.7259 - val_auc: 0.8031 - 1s/epoch - 2ms/step
Epoch 22/50
749/749 - 1s - loss: 0.3879 - accuracy: 0.8202 - precision: 0.7582 - recall: 0.8269 - auc: 0.9053 - val_loss: 0.6061 - val_accuracy: 0.7377 - val_precision: 0.6719 - val_recall: 0.7089 - val_auc: 0.7998 - 1s/epoch - 2ms/step
Epoch 23/50
749/749 - 1s - loss: 0.3816 - accuracy: 0.8246 - precision: 0.7617 - recall: 0.8352 - auc: 0.9086 - val_loss: 0.5976 - val_accuracy: 0.7230 - val_precision: 0.6483 - val_recall: 0.7150 - val_auc: 0.7894 - 1s/epoch - 2ms/step
Epoch 24/50
749/749 - 1s - loss: 0.3694 - accuracy: 0.8307 - precision: 0.7692 - recall: 0.8408 - auc: 0.9144 - val_loss: 0.6403 - val_accuracy: 0.7205 - val_precision: 0.6382 - val_recall: 0.7409 - val_auc: 0.7900 - 1s/epoch - 2ms/step
Epoch 25/50
749/749 - 1s - loss: 0.3690 - accuracy: 0.8309 - precision: 0.7700 - recall: 0.8401 - auc: 0.9154 - val_loss: 0.6345 - val_accuracy: 0.7243 - val_precision: 0.6437 - val_recall: 0.7393 - val_auc: 0.7882 - 1s/epoch - 2ms/step
Epoch 26/50
749/749 - 1s - loss: 0.3586 - accuracy: 0.8357 - precision: 0.7736 - recall: 0.8494 - auc: 0.9195 - val_loss: 0.6612 - val_accuracy: 0.7267 - val_precision: 0.6478 - val_recall: 0.7360 - val_auc: 0.7881 - 1s/epoch - 2ms/step
Epoch 27/50
749/749 - 2s - loss: 0.3494 - accuracy: 0.8395 - precision: 0.7781 - recall: 0.8533 - auc: 0.9240 - val_loss: 0.6771 - val_accuracy: 0.7278 - val_precision: 0.6686 - val_recall: 0.6714 - val_auc: 0.7774 - 2s/epoch - 3ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_102_0.png" src="_images/Colorretal_-_obito_cancer_102_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 1ms/step
250/250 [==============================] - 0s 1ms/step
Número de exemplos positivos do conjunto de teste = 3284
loss: 0.5038
accuracy: 0.7597
precision: 0.7151
recall: 0.6918
auc: 0.8282
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7033
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_105_0.png" src="_images/Colorretal_-_obito_cancer_105_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7495404835008607
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_107_0.png" src="_images/Colorretal_-_obito_cancer_107_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 1ms/step - loss: 0.4650 - accuracy: 0.7830 - precision: 0.7477 - recall: 0.7135 - auc: 0.8567
250/250 [==============================] - 0s 1ms/step - loss: 0.5038 - accuracy: 0.7597 - precision: 0.7151 - recall: 0.6918 - auc: 0.8282
</pre></div></div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Sequencial">
<h3><strong>Criação e treinamento da RNA Sequencial</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Sequencial" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">neg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="n">pos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exemplos:</span><span class="se">\n</span><span class="s1"> Total: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="se">\n</span><span class="s1"> Positivos: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">pos</span><span class="o">/</span><span class="n">total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">% do total)&#39;</span><span class="p">)</span>

<span class="c1"># Cálculo dos pesos das duas classe</span>
<span class="n">weight_for_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">neg</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">weight_for_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pos</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

<span class="c1"># Dicionário de pesos das classes para treinamento</span>
<span class="n">class_weight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">weight_for_0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">weight_for_1</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 0: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 1: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Exemplos:
 Total: 23937
 Positivos: 9852 (41.16% do total)
Peso da classe 0: 0.85
Peso da classe 1: 1.21
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rna</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;sequential&#34;
_________________________________________________________________
 Layer (type)                Output Shape              Param #
=================================================================
 dense_12 (Dense)            (None, 128)               3328

 dense_13 (Dense)            (None, 128)               16512

 dense_14 (Dense)            (None, 32)                4128

 dense_15 (Dense)            (None, 1)                 33

=================================================================
Total params: 24,001
Trainable params: 24,001
Non-trainable params: 0
_________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">rna</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_112_0.png" src="_images/Colorretal_-_obito_cancer_112_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                        <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">rna</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                  <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                  <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                  <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
749/749 - 3s - loss: 0.5337 - accuracy: 0.7377 - precision: 0.6618 - recall: 0.7417 - auc: 0.8104 - val_loss: 0.5140 - val_accuracy: 0.7481 - val_precision: 0.6783 - val_recall: 0.7378 - val_auc: 0.8229 - 3s/epoch - 4ms/step
Epoch 2/50
749/749 - 1s - loss: 0.5105 - accuracy: 0.7567 - precision: 0.6893 - recall: 0.7445 - auc: 0.8287 - val_loss: 0.5029 - val_accuracy: 0.7579 - val_precision: 0.7042 - val_recall: 0.7098 - val_auc: 0.8295 - 1s/epoch - 2ms/step
Epoch 3/50
749/749 - 1s - loss: 0.5022 - accuracy: 0.7598 - precision: 0.6945 - recall: 0.7434 - auc: 0.8346 - val_loss: 0.5179 - val_accuracy: 0.7480 - val_precision: 0.6719 - val_recall: 0.7576 - val_auc: 0.8260 - 1s/epoch - 2ms/step
Epoch 4/50
749/749 - 1s - loss: 0.4969 - accuracy: 0.7619 - precision: 0.6976 - recall: 0.7441 - auc: 0.8384 - val_loss: 0.5003 - val_accuracy: 0.7615 - val_precision: 0.7023 - val_recall: 0.7299 - val_auc: 0.8318 - 1s/epoch - 2ms/step
Epoch 5/50
749/749 - 1s - loss: 0.4918 - accuracy: 0.7656 - precision: 0.7018 - recall: 0.7483 - auc: 0.8421 - val_loss: 0.5060 - val_accuracy: 0.7582 - val_precision: 0.6911 - val_recall: 0.7460 - val_auc: 0.8318 - 1s/epoch - 2ms/step
Epoch 6/50
749/749 - 1s - loss: 0.4891 - accuracy: 0.7686 - precision: 0.7056 - recall: 0.7514 - auc: 0.8442 - val_loss: 0.5045 - val_accuracy: 0.7570 - val_precision: 0.6968 - val_recall: 0.7250 - val_auc: 0.8294 - 1s/epoch - 2ms/step
Epoch 7/50
749/749 - 1s - loss: 0.4821 - accuracy: 0.7728 - precision: 0.7125 - recall: 0.7512 - auc: 0.8491 - val_loss: 0.5081 - val_accuracy: 0.7551 - val_precision: 0.6890 - val_recall: 0.7381 - val_auc: 0.8293 - 1s/epoch - 2ms/step
Epoch 8/50
749/749 - 1s - loss: 0.4787 - accuracy: 0.7734 - precision: 0.7124 - recall: 0.7540 - auc: 0.8513 - val_loss: 0.5085 - val_accuracy: 0.7565 - val_precision: 0.6955 - val_recall: 0.7262 - val_auc: 0.8280 - 1s/epoch - 2ms/step
Epoch 9/50
749/749 - 2s - loss: 0.4731 - accuracy: 0.7772 - precision: 0.7173 - recall: 0.7571 - auc: 0.8551 - val_loss: 0.5122 - val_accuracy: 0.7510 - val_precision: 0.6768 - val_recall: 0.7558 - val_auc: 0.8295 - 2s/epoch - 2ms/step
Epoch 10/50
749/749 - 2s - loss: 0.4682 - accuracy: 0.7795 - precision: 0.7188 - recall: 0.7625 - auc: 0.8585 - val_loss: 0.5319 - val_accuracy: 0.7495 - val_precision: 0.6793 - val_recall: 0.7412 - val_auc: 0.8285 - 2s/epoch - 2ms/step
Epoch 11/50
749/749 - 1s - loss: 0.4635 - accuracy: 0.7824 - precision: 0.7250 - recall: 0.7594 - auc: 0.8616 - val_loss: 0.5161 - val_accuracy: 0.7512 - val_precision: 0.6782 - val_recall: 0.7527 - val_auc: 0.8308 - 1s/epoch - 2ms/step
Epoch 12/50
749/749 - 1s - loss: 0.4569 - accuracy: 0.7836 - precision: 0.7246 - recall: 0.7650 - auc: 0.8656 - val_loss: 0.5176 - val_accuracy: 0.7530 - val_precision: 0.6871 - val_recall: 0.7342 - val_auc: 0.8273 - 1s/epoch - 2ms/step
Epoch 13/50
749/749 - 1s - loss: 0.4532 - accuracy: 0.7864 - precision: 0.7276 - recall: 0.7690 - auc: 0.8679 - val_loss: 0.5247 - val_accuracy: 0.7555 - val_precision: 0.6889 - val_recall: 0.7403 - val_auc: 0.8276 - 1s/epoch - 2ms/step
Epoch 14/50
749/749 - 1s - loss: 0.4460 - accuracy: 0.7908 - precision: 0.7335 - recall: 0.7723 - auc: 0.8726 - val_loss: 0.5253 - val_accuracy: 0.7502 - val_precision: 0.6770 - val_recall: 0.7518 - val_auc: 0.8271 - 1s/epoch - 2ms/step
Epoch 15/50
749/749 - 1s - loss: 0.4392 - accuracy: 0.7950 - precision: 0.7382 - recall: 0.7777 - auc: 0.8766 - val_loss: 0.5582 - val_accuracy: 0.7346 - val_precision: 0.6474 - val_recall: 0.7795 - val_auc: 0.8231 - 1s/epoch - 2ms/step
Epoch 16/50
749/749 - 1s - loss: 0.4348 - accuracy: 0.7992 - precision: 0.7432 - recall: 0.7824 - auc: 0.8791 - val_loss: 0.5233 - val_accuracy: 0.7493 - val_precision: 0.7014 - val_recall: 0.6809 - val_auc: 0.8167 - 1s/epoch - 2ms/step
Epoch 17/50
749/749 - 1s - loss: 0.4272 - accuracy: 0.8012 - precision: 0.7466 - recall: 0.7825 - auc: 0.8835 - val_loss: 0.5361 - val_accuracy: 0.7486 - val_precision: 0.6854 - val_recall: 0.7192 - val_auc: 0.8241 - 1s/epoch - 2ms/step
Epoch 18/50
749/749 - 2s - loss: 0.4214 - accuracy: 0.8045 - precision: 0.7494 - recall: 0.7887 - auc: 0.8868 - val_loss: 0.5432 - val_accuracy: 0.7515 - val_precision: 0.6916 - val_recall: 0.7150 - val_auc: 0.8208 - 2s/epoch - 3ms/step
Epoch 19/50
749/749 - 2s - loss: 0.4149 - accuracy: 0.8098 - precision: 0.7557 - recall: 0.7946 - auc: 0.8907 - val_loss: 0.5579 - val_accuracy: 0.7366 - val_precision: 0.6637 - val_recall: 0.7296 - val_auc: 0.8106 - 2s/epoch - 2ms/step
Epoch 20/50
749/749 - 1s - loss: 0.4107 - accuracy: 0.8110 - precision: 0.7563 - recall: 0.7981 - auc: 0.8932 - val_loss: 0.5552 - val_accuracy: 0.7338 - val_precision: 0.6663 - val_recall: 0.7077 - val_auc: 0.8047 - 1s/epoch - 2ms/step
Epoch 21/50
749/749 - 1s - loss: 0.3979 - accuracy: 0.8180 - precision: 0.7659 - recall: 0.8035 - auc: 0.9006 - val_loss: 0.5671 - val_accuracy: 0.7391 - val_precision: 0.6716 - val_recall: 0.7162 - val_auc: 0.8105 - 1s/epoch - 2ms/step
Epoch 22/50
749/749 - 1s - loss: 0.3959 - accuracy: 0.8178 - precision: 0.7665 - recall: 0.8015 - auc: 0.9012 - val_loss: 0.5803 - val_accuracy: 0.7378 - val_precision: 0.6668 - val_recall: 0.7256 - val_auc: 0.8071 - 1s/epoch - 2ms/step
Epoch 23/50
749/749 - 1s - loss: 0.3872 - accuracy: 0.8230 - precision: 0.7707 - recall: 0.8111 - auc: 0.9058 - val_loss: 0.5791 - val_accuracy: 0.7413 - val_precision: 0.6820 - val_recall: 0.6961 - val_auc: 0.8056 - 1s/epoch - 2ms/step
Epoch 24/50
749/749 - 1s - loss: 0.3807 - accuracy: 0.8264 - precision: 0.7737 - recall: 0.8173 - auc: 0.9092 - val_loss: 0.5840 - val_accuracy: 0.7373 - val_precision: 0.6729 - val_recall: 0.7040 - val_auc: 0.8064 - 1s/epoch - 2ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_115_0.png" src="_images/Colorretal_-_obito_cancer_115_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 939us/step
250/250 [==============================] - 0s 939us/step
Número de exemplos positivos do conjunto de teste = 3284
loss: 0.5003
accuracy: 0.7615
precision: 0.7023
recall: 0.7299
auc: 0.8318
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7158
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_118_0.png" src="_images/Colorretal_-_obito_cancer_118_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7567510659355912
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_cancer_120_0.png" src="_images/Colorretal_-_obito_cancer_120_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 2ms/step - loss: 0.4778 - accuracy: 0.7733 - precision: 0.7230 - recall: 0.7282 - auc: 0.8476
250/250 [==============================] - 0s 2ms/step - loss: 0.5003 - accuracy: 0.7615 - precision: 0.7023 - recall: 0.7299 - auc: 0.8318
</pre></div></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Colorretal%20-%20obito_geral.html" class="btn btn-neutral float-left" title="Introdução" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Colorretal%20-%20vivo_ano1.html" class="btn btn-neutral float-right" title="Introdução" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Lucas Buk Cardoso.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>