<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introdução &mdash; Documentação do estudo de câncer colorretal</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=359c27e9"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introdução" href="Colorretal%20-%20obito_cancer.html" />
    <link rel="prev" title="Leitura dos Dados" href="Colorretal%20-%20preprocessing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Estudo Câncer Colorretal
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Bibliotecas e Funções</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Fun%C3%A7%C3%B5es.html"><strong>Importações</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Fun%C3%A7%C3%B5es.html#Funções"><strong>Funções</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Análise dos dados</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html"><strong>Leitura dos Dados</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html#Análise-dos-dados"><strong>Análise dos dados</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20preprocessing.html#Criação-de-novas-colunas"><strong>Criação de novas colunas</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Óbito geral</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="#Análise---Óbito-geral"><strong>Análise - Óbito geral</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Pré-processamento"><strong>Pré-processamento</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Treinamento-e-validação-dos-modelos-de-machine-learning"><strong>Treinamento e validação dos modelos de machine learning</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Naive-Bayes"><strong>Naive Bayes</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest"><strong>Random Forest</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Optuna">Optuna</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost"><strong>XGBoost</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Optuna</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ROCs"><strong>ROCs</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#RN"><strong>RN</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Importação-das-bibliotecas-e-funções"><strong>Importação das bibliotecas e funções</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Complexa"><strong>Criação e treinamento da RNA Complexa</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Residual"><strong>Criação e treinamento da RNA Residual</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Criação-e-treinamento-da-RNA-Sequencial"><strong>Criação e treinamento da RNA Sequencial</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Óbito por câncer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_cancer.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20obito_cancer.html#Análise---Óbito-por-câncer"><strong>Análise - Óbito por câncer</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida um ano</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano1.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano1.html#Análise---Sobrevida-um-ano"><strong>Análise - Sobrevida um ano</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida três anos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano3.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano3.html#Análise---Sobrevida-três-anos"><strong>Análise - Sobrevida três anos</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sobrevida cinco anos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano5.html"><strong>Introdução</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Colorretal%20-%20vivo_ano5.html#Análise---Sobrevida-cinco-anos"><strong>Análise - Sobrevida cinco anos</strong></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Estudo Câncer Colorretal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><strong>Introdução</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Colorretal - obito_geral.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Introdução">
<h1><strong>Introdução</strong><a class="headerlink" href="#Introdução" title="Permalink to this heading"></a></h1>
<p><strong>Ideia Geral</strong></p>
<p>Utilizando os dados de câncer da FOSP, somente do tipo colorretal, serão utilizados quatro modelos de machine learning diferentes, com o intuito de testar diferentes tipos de algoritmo na classificação do óbito por qualquer razão.</p>
<p>O label é 0 se o paciente está vivo e 1 se ele morreu por qualquer razão.</p>
<p><strong>Modelos de ML</strong></p>
<p>Foram escolhidos os modelos Naive Bayes, que utiliza o Teorema de Bayes para realizar as previsões, Random Forest, XGBoost e LightGBM, que utilizam os conceitos de árvores de decisão, além de bagging e boosting. Além disso, será testado um modelo de votação com os melhores classificadores obtidos, visando obter um algoritmo ainda mais acertivo.</p>
<p><strong>Validação dos modelos</strong></p>
<p>Para validar os modelos treinados foi utilizada primeiramente a matriz de confusão, sendo possível avaliar os acertos em ambas as classes. Para entender de houve overfitting nos modelos, foi utilizada a curva ROC para os conjuntos de treino e teste, comparando a métrica AUC entre ambos os conjuntos.</p>
<p>Por fim, os modelos Random Forest, XGBoost e LightGBM oferecem a possibilidade de saber quais foram as features mais importantes, ou seja, que mais influenciam na previsão das classes. Assim, foram mostradas duas maneiras diferentes de analisar a importância das variáveis de entrada, uma usando a própria função dos modelos e outra usando a biblioteca SHAP, que mostra a influência das features em ambas as classes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leitura dos dados</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/colorretal_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(31916, 37)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-b42eaec6-f63f-490e-a96b-bbcd07c465a4">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ESCOLARI</th>
      <th>IDADE</th>
      <th>SEXO</th>
      <th>IBGE</th>
      <th>CATEATEND</th>
      <th>DIAGPREV</th>
      <th>EC</th>
      <th>ECGRUP</th>
      <th>TRATHOSP</th>
      <th>NENHUM</th>
      <th>...</th>
      <th>IBGEATEN</th>
      <th>ULTICONS</th>
      <th>ULTIDIAG</th>
      <th>ULTITRAT</th>
      <th>obito_geral</th>
      <th>obito_cancer</th>
      <th>vivo_ano1</th>
      <th>vivo_ano3</th>
      <th>vivo_ano5</th>
      <th>ESCOLARI_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4</td>
      <td>19</td>
      <td>2</td>
      <td>3538709</td>
      <td>9</td>
      <td>2</td>
      <td>IV</td>
      <td>IV</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3538709</td>
      <td>4985</td>
      <td>4985</td>
      <td>4951</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9</td>
      <td>19</td>
      <td>1</td>
      <td>3537107</td>
      <td>2</td>
      <td>2</td>
      <td>IIIA</td>
      <td>III</td>
      <td>I</td>
      <td>0</td>
      <td>...</td>
      <td>3509502</td>
      <td>2680</td>
      <td>2744</td>
      <td>2674</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>19</td>
      <td>1</td>
      <td>3516200</td>
      <td>9</td>
      <td>2</td>
      <td>IIB</td>
      <td>II</td>
      <td>F</td>
      <td>0</td>
      <td>...</td>
      <td>3516200</td>
      <td>4725</td>
      <td>4734</td>
      <td>4719</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 37 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b42eaec6-f63f-490e-a96b-bbcd07c465a4')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b42eaec6-f63f-490e-a96b-bbcd07c465a4 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b42eaec6-f63f-490e-a96b-bbcd07c465a4');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Valores faltantes</span>
<span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ESCOLARI     0
CONSDIAG     0
DIAGTRAT     0
ANODIAG      0
FAIXAETAR    0
DRS          0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlação com a saída</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;obito_geral&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
The default value of numeric_only in DataFrame.corr is deprecated. In a future version, it will default to False. Select only valid columns or specify the value of numeric_only to silence this warning.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
obito_geral     1.000000
ULTINFO         0.867403
obito_cancer    0.788496
ULTIDIAG        0.380830
ULTITRAT        0.377590
ULTICONS        0.375966
vivo_ano3       0.370056
vivo_ano5       0.344902
ANODIAG         0.266910
vivo_ano1       0.261431
CATEATEND       0.210779
RECNENHUM       0.189673
CIRURGIA        0.142206
IDADE           0.113836
ESCOLARI_2      0.098022
DIAGPREV        0.097647
IBGEATEN        0.047572
SEXO            0.047430
QUIMIO          0.046282
RADIO           0.045016
Name: obito_geral, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quantidade de pacientes em cada classe da saída</span>
<span class="n">df</span><span class="o">.</span><span class="n">obito_geral</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    16897
0    15019
Name: obito_geral, dtype: int64
</pre></div></div>
</div>
</section>
<section id="Análise---Óbito-geral">
<h1><strong>Análise - Óbito geral</strong><a class="headerlink" href="#Análise---Óbito-geral" title="Permalink to this heading"></a></h1>
<section id="Pré-processamento">
<h2><strong>Pré-processamento</strong><a class="headerlink" href="#Pré-processamento" title="Permalink to this heading"></a></h2>
<p>Como o dataset já foi limpo anteriormente, aqui na etapa de pré-processamento serão realizadas a divisão dos dados em treino e teste, a codificação das colunas textuais para colunas numéricas e a normalização dos dados. Com isso, temos os dados prontos para o treinamento dos modelos de machine learning e consequentemente sua validação.</p>
<p>Neste primeiro momento, serão definidas as colunas que não serão utilizadas como features, assim, foi escolhido manter a coluna <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, então a coluna <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code> será retirada. O mesmo ocorre com a coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code>, retirando a coluna <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>. Por fim, as outras colunas contidas na <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> são possíveis saídas para os modelos, mas estamos interessados somente no óbito geral, por isso só ela será mantida como label e as outras serão retiradas.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_cancer&#39;</span><span class="p">,</span> <span class="s1">&#39;ECGRUP&#39;</span><span class="p">,</span> <span class="s1">&#39;ESCOLARI&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;obito_geral&#39;</span>
</pre></div>
</div>
</div>
<p>Uma função foi criada para realizar o pré-processamento inteiro, chamada <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, internamente ela utiliza outras funções criadas que são: <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divide os dados em treino e teste), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (prepara os dados de treino) e <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (prepara os dados de teste).</p>
<blockquote>
<div><p>Mais detalhes em <a class="reference external" href="https://colorectal-site.readthedocs.io/en/latest/Fun%C3%A7%C3%B5es.html#Fun%C3%A7%C3%B5es">funções</a>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">feat_cols</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                            <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                            <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                            <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                            <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (23937, 25), X_test = (7979, 25)
y_train = (23937,), y_test = (7979,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    0.529431
0    0.470569
Name: obito_geral, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    0.52939
0    0.47061
Name: obito_geral, dtype: float64
</pre></div></div>
</div>
</section>
<section id="Treinamento-e-validação-dos-modelos-de-machine-learning">
<h2><strong>Treinamento e validação dos modelos de machine learning</strong><a class="headerlink" href="#Treinamento-e-validação-dos-modelos-de-machine-learning" title="Permalink to this heading"></a></h2>
<p>Depois das etapas de preparação, os dados estão prontos para serem utilizados nos modelos escolhidos.</p>
<section id="Naive-Bayes">
<h3><strong>Naive Bayes</strong><a class="headerlink" href="#Naive-Bayes" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo Naive Bayes</span>
<span class="n">nb</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GaussianNB()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">GaussianNB</label><div class="sk-toggleable__content"><pre>GaussianNB()</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_17_0.png" src="_images/Colorretal_-_obito_geral_17_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.471     1.000     0.640      3755
           1      1.000     0.001     0.002      4224

    accuracy                          0.471      7979
   macro avg      0.735     0.500     0.321      7979
weighted avg      0.751     0.471     0.302      7979

</pre></div></div>
</div>
<blockquote>
<div><p>Claramente percebe-se que o modelo previu quase todos os dados como sendo da classe 0, portanto não teve um aprendizado satisfatório.</p>
</div></blockquote>
<blockquote>
<div><p>Na matriz de confusão, buscamos uma diagonal principal equilibrada e com a maior acertividade possível.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_19_0.png" src="_images/Colorretal_-_obito_geral_19_0.png" />
</div>
</div>
<blockquote>
<div><p>Pelas curvas ROC, pode-se dizer que não há overfitting, mas o modelo é ruim para a previsão da classe 1, portanto qualquer análise além dessa não possui tanta relevância.</p>
</div></blockquote>
</section>
<section id="Random-Forest">
<h3><strong>Random Forest</strong><a class="headerlink" href="#Random-Forest" title="Permalink to this heading"></a></h3>
<p>O modelo Random Forest é mais complexo em relação ao Naive Bayes, assim alguns hiperparâmetros serão definidos para obter um modelo base e depois será realizada a busca dos melhores parâmetros utilizando o Optuna.</p>
<p>Os parâmetros definidos para este primeiro modelo serão:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code>: para repetibilidade do treinamento do modelo. Será utilizado na busca pelos hiperparâmetros também, sempre como mesmo valor definido na variável <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: será definido como 8, pois o padrão do modelo é não ter profundidade máxima para as árvores, o que dificulta e faz o treinamento ser muito longo, além da maior chance de overfitting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class_weight</span></code>: usado para definir os pesos de cada classe no treinamento do modelo, muito útil quando temos classes desbalanceadas no conjunto de dados, como neste caso.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo Random Forest</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                            <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                            <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.028</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                            <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">)</span>

<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(class_weight={0: 1.028, 1: 1}, criterion=&#x27;entropy&#x27;,
                       max_depth=8, random_state=10)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(class_weight={0: 1.028, 1: 1}, criterion=&#x27;entropy&#x27;,
                       max_depth=8, random_state=10)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_24_0.png" src="_images/Colorretal_-_obito_geral_24_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.738     0.761     0.749      3755
           1      0.781     0.760     0.771      4224

    accuracy                          0.760      7979
   macro avg      0.760     0.760     0.760      7979
weighted avg      0.761     0.760     0.761      7979

</pre></div></div>
</div>
<blockquote>
<div><p>A matriz obtida para o modelo Random Forest apresentou diagonal equilibrada em ambas as classes, com 76% de acurácia.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pedaço de uma das árvores do modelo Random Forest</span>
<span class="n">show_tree</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_26_0.png" src="_images/Colorretal_-_obito_geral_26_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_27_0.png" src="_images/Colorretal_-_obito_geral_27_0.png" />
</div>
</div>
<blockquote>
<div><p>Como a métrica AUC possui valores próximos para o conjunto de treino e de teste, 0,861 e 0,843 respectivamente, pode-se dizer que há apenas um pouco de overfitting, não sendo algo de grande preocupação.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features</span>
<span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_29_0.png" src="_images/Colorretal_-_obito_geral_29_0.png" />
</div>
</div>
<blockquote>
<div><p>As features mais importantes nesta visualização são <code class="docutils literal notranslate"><span class="pre">EC</span></code>, com uma grande vantagem, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> e <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_31_0.png" src="_images/Colorretal_-_obito_geral_31_0.png" />
</div>
</div>
<p>A coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code> foi a mais importante aqui também, com isso, os valores mais altos desta variável, mostrados em rosa, influenciaram mais o modelo na previsão da classe 1 (óbito por qualquer razão). Já os valores mais baixos desta coluna, em azul, tem mais peso para previsão ser da classe 0. Este comportamento faz sentido, pois quanto mais alto o estágio, maior é a extensão do câncer, assim menor a chance de sobrevivência.</p>
<p>O raciocínio para analisar as outras colunas é o mesmo utilizado para o estadiamento clínico.</p>
<section id="Optuna">
<h4>Optuna<a class="headerlink" href="#Optuna" title="Permalink to this heading"></a></h4>
<p>Para fazer a busca pelos melhores hiperparâmetros, será utilizado a biblioteca Optuna, definindo o intervalo para os parâmetros do modelo a serem buscados.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Folds com a mesma proporção das classes</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função com o modelos e seus parâmetros, que terá sua métrica maximizada</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">min_samples_split</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">max_samples</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;max_samples&#39;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;criterion&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">])</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                                 <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">,</span>
                                 <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                                 <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                           <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação do estudo e procura pelos hiperparâmetros</span>
<span class="n">studyRF</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhor tentativa</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">best_trial</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FrozenTrial(number=69, state=TrialState.COMPLETE, values=[0.7659635302997903], datetime_start=datetime.datetime(2023, 4, 11, 23, 41, 4, 440279), datetime_complete=datetime.datetime(2023, 4, 11, 23, 41, 45, 938175), params={&#39;n_estimators&#39;: 173, &#39;max_depth&#39;: 17, &#39;min_samples_split&#39;: 8, &#39;min_samples_leaf&#39;: 4, &#39;max_samples&#39;: 0.7999999999999999, &#39;criterion&#39;: &#39;entropy&#39;}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={&#39;n_estimators&#39;: IntDistribution(high=250, log=False, low=50, step=1), &#39;max_depth&#39;: IntDistribution(high=18, log=False, low=3, step=1), &#39;min_samples_split&#39;: IntDistribution(high=10, log=False, low=2, step=1), &#39;min_samples_leaf&#39;: IntDistribution(high=7, log=False, low=1, step=1), &#39;max_samples&#39;: FloatDistribution(high=1.0, log=False, low=0.7, step=0.1), &#39;criterion&#39;: CategoricalDistribution(choices=(&#39;gini&#39;, &#39;entropy&#39;))}, trial_id=69, value=None)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhores parâmetros</span>
<span class="n">studyRF</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;n_estimators&#39;: 173,
 &#39;max_depth&#39;: 17,
 &#39;min_samples_split&#39;: 8,
 &#39;min_samples_leaf&#39;: 4,
 &#39;max_samples&#39;: 0.7999999999999999,
 &#39;criterion&#39;: &#39;entropy&#39;}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">studyRF</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modelo com os melhores parâmetros</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">studyRF</span><span class="o">.</span><span class="n">best_params</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;random_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;class_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="n">rf_optuna</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rf_optuna</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="n">rf_optuna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(class_weight={0: 1.11, 1: 1}, criterion=&#x27;entropy&#x27;,
                       max_depth=17, max_samples=0.7999999999999999,
                       min_samples_leaf=4, min_samples_split=8,
                       n_estimators=173, random_state=10)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(class_weight={0: 1.11, 1: 1}, criterion=&#x27;entropy&#x27;,
                       max_depth=17, max_samples=0.7999999999999999,
                       min_samples_leaf=4, min_samples_split=8,
                       n_estimators=173, random_state=10)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão do modelo Random Forest otimizado</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_42_0.png" src="_images/Colorretal_-_obito_geral_42_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.751     0.773     0.762      3755
           1      0.793     0.772     0.782      4224

    accuracy                          0.772      7979
   macro avg      0.772     0.772     0.772      7979
weighted avg      0.773     0.772     0.772      7979

</pre></div></div>
</div>
<blockquote>
<div><p>Há uma melhora de acurácia em relação ao primeiro modelo testado, de 76% para 77%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC do modelo otimizado</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_44_0.png" src="_images/Colorretal_-_obito_geral_44_0.png" />
</div>
</div>
<blockquote>
<div><p>A curva ROC mostra que o modelo possui overfitting, pois para o conjunto de treino temos AUC = 0,958 e para o teste AUC = 0,852, essa diferença caracteriza o problema.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelos valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No data for colormapping provided via &#39;c&#39;. Parameters &#39;vmin&#39;, &#39;vmax&#39; will be ignored
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_46_1.png" src="_images/Colorretal_-_obito_geral_46_1.png" />
</div>
</div>
</section>
</section>
<section id="XGBoost">
<h3><strong>XGBoost</strong><a class="headerlink" href="#XGBoost" title="Permalink to this heading"></a></h3>
<p>O modelo XGBoost também terá alguns hiperparâmetros definidos para obter um modelo base e depois será realizada a busca dos melhores parâmetros utilizando o Optuna.</p>
<p>Os parâmetros definidos para este primeiro modelo serão:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code>: para repetibilidade do treinamento do modelo. Será utilizado na busca pelos hiperparâmetros também, sempre como mesmo valor definido na variável <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: será definido como 4, pois o padrão do modelo é 3 de profundidade máxima para as árvores, deixando o modelo muito simples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>: usado para definir o peso da classe 1 no treinamento do modelo, pois temos classes desbalanceadas.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação e treinamento do modelo XGBoost</span>
<span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.918</span><span class="p">,</span>
                    <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_50_0.png" src="_images/Colorretal_-_obito_geral_50_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.755     0.777     0.766      3755
           1      0.797     0.776     0.786      4224

    accuracy                          0.776      7979
   macro avg      0.776     0.776     0.776      7979
weighted avg      0.777     0.776     0.777      7979

</pre></div></div>
</div>
<blockquote>
<div><p>A matriz obtida para o modelo XGBoost apresentou diagonal equilibrada em ambas as classes, com 78% de acurácia.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_52_0.png" src="_images/Colorretal_-_obito_geral_52_0.png" />
</div>
</div>
<blockquote>
<div><p>Como a métrica AUC possui valores próximos para o conjunto de treino e de teste, 0,887 e 0,854 respectivamente, pode-se dizer que há bem pouco overfitting, não sendo algo de grande preocupação.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features</span>
<span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_54_0.png" src="_images/Colorretal_-_obito_geral_54_0.png" />
</div>
</div>
<blockquote>
<div><p>As features mais importantes nesta visualização são <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code> e <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelo valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_56_0.png" src="_images/Colorretal_-_obito_geral_56_0.png" />
</div>
</div>
<p>A coluna <code class="docutils literal notranslate"><span class="pre">EC</span></code> foi a mais importante também, com isso, os valores mais altos desta variável, mostrados em rosa, influenciaram mais o modelo na previsão da classe 1 (óbito por câncer). Já os valores mais baixos desta coluna, em azul, tem mais peso para previsão ser da classe 0. Este comportamento faz sentido, pois quanto mais alto o estágio, maior é a extensão do câncer, assim menor a chance de sobrevivência.</p>
<p>O raciocínio para analisar as outras colunas é o mesmo utilizado para o estadiamento clínico.</p>
<section id="id1">
<h4>Optuna<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h4>
<p>Para fazer a busca pelos melhores hiperparâmetros, será utilizado a biblioteca Optuna, definindo o intervalo para os parâmetros do modelo a serem buscados.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Folds com a mesma proporção das classes</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função com o modelos e seus parâmetros, que terá sua métrica maximizada</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">min_child_weight</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_child_weight&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">colsample_bytree</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;colsample_bytree&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
                        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                        <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
                        <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                        <span class="n">min_child_weight</span><span class="o">=</span><span class="n">min_child_weight</span><span class="p">,</span>
                        <span class="n">colsample_bytree</span><span class="o">=</span><span class="n">colsample_bytree</span><span class="p">,</span>
                        <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                           <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Criação do estudo e procura pelos hiperparâmetros</span>
<span class="n">studyXGB</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhor tentativa</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">best_trial</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melhores parâmetros</span>
<span class="n">studyXGB</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;n_estimators&#39;: 170,
 &#39;max_depth&#39;: 4,
 &#39;learning_rate&#39;: 0.1,
 &#39;gamma&#39;: 0.2,
 &#39;min_child_weight&#39;: 4,
 &#39;colsample_bytree&#39;: 0.7}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">studyXGB</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modelo com os melhores parâmetros</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">studyXGB</span><span class="o">.</span><span class="n">best_params</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;random_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;scale_pos_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.93</span>

<span class="n">xgb_optuna</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">xgb_optuna</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="n">xgb_optuna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-6 {color: black;background-color: white;}#sk-container-id-6 pre{padding: 0;}#sk-container-id-6 div.sk-toggleable {background-color: white;}#sk-container-id-6 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-6 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-6 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-6 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-6 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-6 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-6 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-6 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-6 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-6 div.sk-item {position: relative;z-index: 1;}#sk-container-id-6 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-6 div.sk-item::before, #sk-container-id-6 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-6 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-6 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-6 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-6 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-6 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-6 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-6 div.sk-label-container {text-align: center;}#sk-container-id-6 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-6 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.7, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.2, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.1, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=170, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" checked><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.7, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.2, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.1, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=170, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=10, ...)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusão do modelo XGBoost otimizado</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_67_0.png" src="_images/Colorretal_-_obito_geral_67_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0      0.756     0.777     0.766      3755
           1      0.797     0.777     0.786      4224

    accuracy                          0.777      7979
   macro avg      0.776     0.777     0.776      7979
weighted avg      0.777     0.777     0.777      7979

</pre></div></div>
</div>
<blockquote>
<div><p>Há uma melhora de acurácia em relação ao primeiro modelo testado, de 77% para 78%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva ROC do modelo otimizado</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_69_0.png" src="_images/Colorretal_-_obito_geral_69_0.png" />
</div>
</div>
<blockquote>
<div><p>A curva ROC mostra que o modelo possui um pouco de overfitting, pois para o conjunto de treino temos AUC = 0,873 e para o teste AUC = 0,857, essa diferença caracteriza o problema.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importância das features pelo valores SHAP</span>
<span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_optuna</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">feat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_71_0.png" src="_images/Colorretal_-_obito_geral_71_0.png" />
</div>
</div>
</section>
</section>
<section id="ROCs">
<h3><strong>ROCs</strong><a class="headerlink" href="#ROCs" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Treino</span>
<span class="n">roc_together</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">rf_optuna</span><span class="p">,</span> <span class="n">xgb_optuna</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_73_0.png" src="_images/Colorretal_-_obito_geral_73_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Teste</span>
<span class="n">roc_together</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">rf_optuna</span><span class="p">,</span> <span class="n">xgb_optuna</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_74_0.png" src="_images/Colorretal_-_obito_geral_74_0.png" />
</div>
</div>
</section>
</section>
<section id="RN">
<h2><strong>RN</strong><a class="headerlink" href="#RN" title="Permalink to this heading"></a></h2>
<section id="Importação-das-bibliotecas-e-funções">
<h3><strong>Importação das bibliotecas e funções</strong><a class="headerlink" href="#Importação-das-bibliotecas-e-funções" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.regularizers</span> <span class="kn">import</span> <span class="n">l2</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definição de cores para gráficos</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot metrics after training the RNA.</span>

<span class="sd">    :param history: RNA training history.</span>

<span class="sd">    :return: no value</span>
<span class="sd">    :rtype: none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">metric</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span> <span class="n">metric</span><span class="p">],</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Val&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;loss&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Complexa">
<h3><strong>Criação e treinamento da RNA Complexa</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Complexa" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">neg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="n">pos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exemplos:</span><span class="se">\n</span><span class="s1"> Total: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="se">\n</span><span class="s1"> Positivos: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">pos</span><span class="o">/</span><span class="n">total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">% do total)&#39;</span><span class="p">)</span>

<span class="c1"># Cálculo dos pesos das duas classe</span>
<span class="n">weight_for_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">neg</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">weight_for_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pos</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

<span class="c1"># Dicionário de pesos das classes para treinamento</span>
<span class="n">class_weight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">weight_for_0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">weight_for_1</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 0: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 1: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Exemplos:
 Total: 23937
 Positivos: 12673 (52.94% do total)
Peso da classe 0: 1.06
Peso da classe 1: 0.94
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;input_features&#39;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;selu&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">input_features</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Concatenate</span>
<span class="n">x_concat</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">()([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">input_features</span><span class="p">])</span>

<span class="n">x4</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">())(</span><span class="n">x_concat</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;out_dense&#39;</span><span class="p">)(</span><span class="n">x4</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">input_features</span><span class="p">],</span>
                    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">out</span><span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model&#34;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to
==================================================================================================
 input_features (InputLayer)    [(None, 25)]         0           []

 dense (Dense)                  (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 dense_1 (Dense)                (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 dense_2 (Dense)                (None, 128)          3328        [&#39;input_features[0][0]&#39;]

 concatenate (Concatenate)      (None, 409)          0           [&#39;dense[0][0]&#39;,
                                                                  &#39;dense_1[0][0]&#39;,
                                                                  &#39;dense_2[0][0]&#39;,
                                                                  &#39;input_features[0][0]&#39;]

 dense_3 (Dense)                (None, 32)           13120       [&#39;concatenate[0][0]&#39;]

 out_dense (Dense)              (None, 1)            33          [&#39;dense_3[0][0]&#39;]

==================================================================================================
Total params: 23,137
Trainable params: 23,137
Non-trainable params: 0
__________________________________________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_85_0.png" src="_images/Colorretal_-_obito_geral_85_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
749/749 - 5s - loss: 0.8399 - accuracy: 0.7260 - precision: 0.7473 - recall: 0.7290 - auc: 0.7992 - val_loss: 0.5664 - val_accuracy: 0.7364 - val_precision: 0.7830 - val_recall: 0.6946 - val_auc: 0.8159 - 5s/epoch - 6ms/step
Epoch 2/50
749/749 - 2s - loss: 0.5594 - accuracy: 0.7307 - precision: 0.7530 - recall: 0.7310 - auc: 0.8058 - val_loss: 0.5441 - val_accuracy: 0.7394 - val_precision: 0.7497 - val_recall: 0.7623 - val_auc: 0.8163 - 2s/epoch - 3ms/step
Epoch 3/50
749/749 - 2s - loss: 0.5519 - accuracy: 0.7322 - precision: 0.7556 - recall: 0.7305 - auc: 0.8074 - val_loss: 0.5349 - val_accuracy: 0.7436 - val_precision: 0.7579 - val_recall: 0.7576 - val_auc: 0.8213 - 2s/epoch - 3ms/step
Epoch 4/50
749/749 - 3s - loss: 0.5471 - accuracy: 0.7378 - precision: 0.7616 - recall: 0.7349 - auc: 0.8112 - val_loss: 0.5347 - val_accuracy: 0.7435 - val_precision: 0.7333 - val_recall: 0.8099 - val_auc: 0.8237 - 3s/epoch - 4ms/step
Epoch 5/50
749/749 - 3s - loss: 0.5460 - accuracy: 0.7351 - precision: 0.7583 - recall: 0.7334 - auc: 0.8128 - val_loss: 0.5377 - val_accuracy: 0.7442 - val_precision: 0.7869 - val_recall: 0.7088 - val_auc: 0.8267 - 3s/epoch - 4ms/step
Epoch 6/50
749/749 - 2s - loss: 0.5437 - accuracy: 0.7386 - precision: 0.7623 - recall: 0.7356 - auc: 0.8144 - val_loss: 0.5289 - val_accuracy: 0.7483 - val_precision: 0.7439 - val_recall: 0.8000 - val_auc: 0.8285 - 2s/epoch - 3ms/step
Epoch 7/50
749/749 - 2s - loss: 0.5401 - accuracy: 0.7398 - precision: 0.7627 - recall: 0.7382 - auc: 0.8172 - val_loss: 0.5307 - val_accuracy: 0.7503 - val_precision: 0.7791 - val_recall: 0.7375 - val_auc: 0.8294 - 2s/epoch - 3ms/step
Epoch 8/50
749/749 - 2s - loss: 0.5407 - accuracy: 0.7411 - precision: 0.7631 - recall: 0.7410 - auc: 0.8172 - val_loss: 0.5283 - val_accuracy: 0.7468 - val_precision: 0.7540 - val_recall: 0.7744 - val_auc: 0.8267 - 2s/epoch - 3ms/step
Epoch 9/50
749/749 - 2s - loss: 0.5381 - accuracy: 0.7420 - precision: 0.7652 - recall: 0.7397 - auc: 0.8184 - val_loss: 0.5557 - val_accuracy: 0.7275 - val_precision: 0.8317 - val_recall: 0.6084 - val_auc: 0.8304 - 2s/epoch - 3ms/step
Epoch 10/50
749/749 - 3s - loss: 0.5381 - accuracy: 0.7425 - precision: 0.7645 - recall: 0.7424 - auc: 0.8187 - val_loss: 0.5331 - val_accuracy: 0.7501 - val_precision: 0.7704 - val_recall: 0.7521 - val_auc: 0.8252 - 3s/epoch - 4ms/step
Epoch 11/50
749/749 - 3s - loss: 0.5358 - accuracy: 0.7430 - precision: 0.7666 - recall: 0.7398 - auc: 0.8204 - val_loss: 0.5263 - val_accuracy: 0.7500 - val_precision: 0.7359 - val_recall: 0.8232 - val_auc: 0.8316 - 3s/epoch - 5ms/step
Epoch 12/50
749/749 - 3s - loss: 0.5365 - accuracy: 0.7424 - precision: 0.7638 - recall: 0.7432 - auc: 0.8206 - val_loss: 0.5251 - val_accuracy: 0.7511 - val_precision: 0.7393 - val_recall: 0.8184 - val_auc: 0.8309 - 3s/epoch - 4ms/step
Epoch 13/50
749/749 - 3s - loss: 0.5336 - accuracy: 0.7469 - precision: 0.7677 - recall: 0.7483 - auc: 0.8222 - val_loss: 0.5182 - val_accuracy: 0.7554 - val_precision: 0.7615 - val_recall: 0.7831 - val_auc: 0.8330 - 3s/epoch - 5ms/step
Epoch 14/50
749/749 - 2s - loss: 0.5323 - accuracy: 0.7493 - precision: 0.7722 - recall: 0.7468 - auc: 0.8230 - val_loss: 0.5272 - val_accuracy: 0.7460 - val_precision: 0.7231 - val_recall: 0.8428 - val_auc: 0.8330 - 2s/epoch - 3ms/step
Epoch 15/50
749/749 - 3s - loss: 0.5303 - accuracy: 0.7483 - precision: 0.7704 - recall: 0.7472 - auc: 0.8239 - val_loss: 0.5222 - val_accuracy: 0.7545 - val_precision: 0.7605 - val_recall: 0.7827 - val_auc: 0.8306 - 3s/epoch - 4ms/step
Epoch 16/50
749/749 - 3s - loss: 0.5301 - accuracy: 0.7470 - precision: 0.7691 - recall: 0.7461 - auc: 0.8244 - val_loss: 0.5179 - val_accuracy: 0.7525 - val_precision: 0.7552 - val_recall: 0.7879 - val_auc: 0.8322 - 3s/epoch - 4ms/step
Epoch 17/50
749/749 - 2s - loss: 0.5286 - accuracy: 0.7496 - precision: 0.7708 - recall: 0.7499 - auc: 0.8252 - val_loss: 0.5146 - val_accuracy: 0.7561 - val_precision: 0.7746 - val_recall: 0.7607 - val_auc: 0.8362 - 2s/epoch - 3ms/step
Epoch 18/50
749/749 - 2s - loss: 0.5277 - accuracy: 0.7502 - precision: 0.7718 - recall: 0.7499 - auc: 0.8258 - val_loss: 0.5153 - val_accuracy: 0.7581 - val_precision: 0.7719 - val_recall: 0.7708 - val_auc: 0.8356 - 2s/epoch - 3ms/step
Epoch 19/50
749/749 - 2s - loss: 0.5274 - accuracy: 0.7517 - precision: 0.7743 - recall: 0.7494 - auc: 0.8265 - val_loss: 0.5195 - val_accuracy: 0.7557 - val_precision: 0.7951 - val_recall: 0.7256 - val_auc: 0.8362 - 2s/epoch - 3ms/step
Epoch 20/50
749/749 - 2s - loss: 0.5258 - accuracy: 0.7485 - precision: 0.7722 - recall: 0.7448 - auc: 0.8272 - val_loss: 0.5206 - val_accuracy: 0.7526 - val_precision: 0.7620 - val_recall: 0.7746 - val_auc: 0.8337 - 2s/epoch - 3ms/step
Epoch 21/50
749/749 - 3s - loss: 0.5261 - accuracy: 0.7512 - precision: 0.7753 - recall: 0.7465 - auc: 0.8272 - val_loss: 0.5139 - val_accuracy: 0.7562 - val_precision: 0.7670 - val_recall: 0.7749 - val_auc: 0.8362 - 3s/epoch - 4ms/step
Epoch 22/50
749/749 - 3s - loss: 0.5242 - accuracy: 0.7519 - precision: 0.7740 - recall: 0.7505 - auc: 0.8283 - val_loss: 0.5231 - val_accuracy: 0.7512 - val_precision: 0.7786 - val_recall: 0.7408 - val_auc: 0.8312 - 3s/epoch - 4ms/step
Epoch 23/50
749/749 - 2s - loss: 0.5239 - accuracy: 0.7513 - precision: 0.7749 - recall: 0.7473 - auc: 0.8287 - val_loss: 0.5178 - val_accuracy: 0.7559 - val_precision: 0.7792 - val_recall: 0.7519 - val_auc: 0.8330 - 2s/epoch - 3ms/step
Epoch 24/50
749/749 - 2s - loss: 0.5236 - accuracy: 0.7507 - precision: 0.7739 - recall: 0.7475 - auc: 0.8289 - val_loss: 0.5167 - val_accuracy: 0.7555 - val_precision: 0.7619 - val_recall: 0.7827 - val_auc: 0.8343 - 2s/epoch - 3ms/step
Epoch 25/50
749/749 - 2s - loss: 0.5233 - accuracy: 0.7514 - precision: 0.7755 - recall: 0.7465 - auc: 0.8285 - val_loss: 0.5132 - val_accuracy: 0.7550 - val_precision: 0.7870 - val_recall: 0.7365 - val_auc: 0.8378 - 2s/epoch - 3ms/step
Epoch 26/50
749/749 - 2s - loss: 0.5216 - accuracy: 0.7503 - precision: 0.7731 - recall: 0.7480 - auc: 0.8299 - val_loss: 0.5093 - val_accuracy: 0.7623 - val_precision: 0.7640 - val_recall: 0.7971 - val_auc: 0.8399 - 2s/epoch - 3ms/step
Epoch 27/50
749/749 - 3s - loss: 0.5207 - accuracy: 0.7506 - precision: 0.7749 - recall: 0.7456 - auc: 0.8304 - val_loss: 0.5089 - val_accuracy: 0.7587 - val_precision: 0.7740 - val_recall: 0.7687 - val_auc: 0.8392 - 3s/epoch - 4ms/step
Epoch 28/50
749/749 - 3s - loss: 0.5214 - accuracy: 0.7525 - precision: 0.7760 - recall: 0.7487 - auc: 0.8306 - val_loss: 0.5114 - val_accuracy: 0.7587 - val_precision: 0.7695 - val_recall: 0.7770 - val_auc: 0.8384 - 3s/epoch - 4ms/step
Epoch 29/50
749/749 - 2s - loss: 0.5194 - accuracy: 0.7527 - precision: 0.7767 - recall: 0.7479 - auc: 0.8311 - val_loss: 0.5090 - val_accuracy: 0.7592 - val_precision: 0.7754 - val_recall: 0.7675 - val_auc: 0.8389 - 2s/epoch - 3ms/step
Epoch 30/50
749/749 - 2s - loss: 0.5194 - accuracy: 0.7529 - precision: 0.7756 - recall: 0.7502 - auc: 0.8311 - val_loss: 0.5124 - val_accuracy: 0.7571 - val_precision: 0.7788 - val_recall: 0.7559 - val_auc: 0.8380 - 2s/epoch - 3ms/step
Epoch 31/50
749/749 - 2s - loss: 0.5182 - accuracy: 0.7537 - precision: 0.7777 - recall: 0.7490 - auc: 0.8324 - val_loss: 0.5122 - val_accuracy: 0.7561 - val_precision: 0.7717 - val_recall: 0.7659 - val_auc: 0.8371 - 2s/epoch - 3ms/step
Epoch 32/50
749/749 - 2s - loss: 0.5180 - accuracy: 0.7532 - precision: 0.7771 - recall: 0.7486 - auc: 0.8324 - val_loss: 0.5135 - val_accuracy: 0.7570 - val_precision: 0.7688 - val_recall: 0.7737 - val_auc: 0.8367 - 2s/epoch - 3ms/step
Epoch 33/50
749/749 - 3s - loss: 0.5194 - accuracy: 0.7554 - precision: 0.7787 - recall: 0.7514 - auc: 0.8319 - val_loss: 0.5119 - val_accuracy: 0.7561 - val_precision: 0.7609 - val_recall: 0.7865 - val_auc: 0.8362 - 3s/epoch - 4ms/step
Epoch 34/50
749/749 - 3s - loss: 0.5181 - accuracy: 0.7552 - precision: 0.7774 - recall: 0.7534 - auc: 0.8326 - val_loss: 0.5244 - val_accuracy: 0.7532 - val_precision: 0.7839 - val_recall: 0.7370 - val_auc: 0.8299 - 3s/epoch - 4ms/step
Epoch 35/50
749/749 - 2s - loss: 0.5197 - accuracy: 0.7532 - precision: 0.7792 - recall: 0.7450 - auc: 0.8321 - val_loss: 0.5102 - val_accuracy: 0.7587 - val_precision: 0.7806 - val_recall: 0.7571 - val_auc: 0.8390 - 2s/epoch - 3ms/step
Epoch 36/50
749/749 - 2s - loss: 0.5173 - accuracy: 0.7547 - precision: 0.7793 - recall: 0.7488 - auc: 0.8325 - val_loss: 0.5108 - val_accuracy: 0.7607 - val_precision: 0.7605 - val_recall: 0.8000 - val_auc: 0.8384 - 2s/epoch - 3ms/step
Epoch 37/50
749/749 - 2s - loss: 0.5169 - accuracy: 0.7540 - precision: 0.7779 - recall: 0.7494 - auc: 0.8327 - val_loss: 0.5216 - val_accuracy: 0.7511 - val_precision: 0.7827 - val_recall: 0.7334 - val_auc: 0.8333 - 2s/epoch - 3ms/step
Epoch 38/50
749/749 - 2s - loss: 0.5179 - accuracy: 0.7541 - precision: 0.7776 - recall: 0.7501 - auc: 0.8323 - val_loss: 0.5064 - val_accuracy: 0.7624 - val_precision: 0.7749 - val_recall: 0.7768 - val_auc: 0.8404 - 2s/epoch - 3ms/step
Epoch 39/50
749/749 - 3s - loss: 0.5167 - accuracy: 0.7553 - precision: 0.7783 - recall: 0.7521 - auc: 0.8330 - val_loss: 0.5081 - val_accuracy: 0.7601 - val_precision: 0.7741 - val_recall: 0.7723 - val_auc: 0.8391 - 3s/epoch - 4ms/step
Epoch 40/50
749/749 - 3s - loss: 0.5177 - accuracy: 0.7542 - precision: 0.7797 - recall: 0.7467 - auc: 0.8326 - val_loss: 0.5123 - val_accuracy: 0.7561 - val_precision: 0.7568 - val_recall: 0.7947 - val_auc: 0.8360 - 3s/epoch - 4ms/step
Epoch 41/50
749/749 - 2s - loss: 0.5163 - accuracy: 0.7548 - precision: 0.7785 - recall: 0.7503 - auc: 0.8334 - val_loss: 0.5106 - val_accuracy: 0.7569 - val_precision: 0.7891 - val_recall: 0.7379 - val_auc: 0.8402 - 2s/epoch - 3ms/step
Epoch 42/50
749/749 - 2s - loss: 0.5184 - accuracy: 0.7551 - precision: 0.7798 - recall: 0.7488 - auc: 0.8329 - val_loss: 0.5075 - val_accuracy: 0.7615 - val_precision: 0.7901 - val_recall: 0.7483 - val_auc: 0.8412 - 2s/epoch - 3ms/step
Epoch 43/50
749/749 - 2s - loss: 0.5158 - accuracy: 0.7549 - precision: 0.7787 - recall: 0.7502 - auc: 0.8337 - val_loss: 0.5135 - val_accuracy: 0.7590 - val_precision: 0.7988 - val_recall: 0.7282 - val_auc: 0.8402 - 2s/epoch - 3ms/step
Epoch 44/50
749/749 - 2s - loss: 0.5158 - accuracy: 0.7538 - precision: 0.7794 - recall: 0.7462 - auc: 0.8340 - val_loss: 0.5074 - val_accuracy: 0.7624 - val_precision: 0.7898 - val_recall: 0.7509 - val_auc: 0.8415 - 2s/epoch - 3ms/step
Epoch 45/50
749/749 - 5s - loss: 0.5155 - accuracy: 0.7554 - precision: 0.7799 - recall: 0.7495 - auc: 0.8341 - val_loss: 0.5051 - val_accuracy: 0.7658 - val_precision: 0.7775 - val_recall: 0.7810 - val_auc: 0.8419 - 5s/epoch - 6ms/step
Epoch 46/50
749/749 - 5s - loss: 0.5157 - accuracy: 0.7571 - precision: 0.7809 - recall: 0.7524 - auc: 0.8345 - val_loss: 0.5119 - val_accuracy: 0.7594 - val_precision: 0.7989 - val_recall: 0.7289 - val_auc: 0.8403 - 5s/epoch - 6ms/step
Epoch 47/50
749/749 - 5s - loss: 0.5158 - accuracy: 0.7554 - precision: 0.7811 - recall: 0.7473 - auc: 0.8341 - val_loss: 0.5075 - val_accuracy: 0.7649 - val_precision: 0.7793 - val_recall: 0.7756 - val_auc: 0.8408 - 5s/epoch - 6ms/step
Epoch 48/50
749/749 - 6s - loss: 0.5161 - accuracy: 0.7541 - precision: 0.7780 - recall: 0.7495 - auc: 0.8335 - val_loss: 0.5089 - val_accuracy: 0.7604 - val_precision: 0.7906 - val_recall: 0.7446 - val_auc: 0.8404 - 6s/epoch - 9ms/step
Epoch 49/50
749/749 - 5s - loss: 0.5146 - accuracy: 0.7568 - precision: 0.7813 - recall: 0.7508 - auc: 0.8344 - val_loss: 0.5051 - val_accuracy: 0.7626 - val_precision: 0.7882 - val_recall: 0.7543 - val_auc: 0.8419 - 5s/epoch - 6ms/step
Epoch 50/50
749/749 - 2s - loss: 0.5158 - accuracy: 0.7554 - precision: 0.7796 - recall: 0.7499 - auc: 0.8340 - val_loss: 0.5077 - val_accuracy: 0.7633 - val_precision: 0.7865 - val_recall: 0.7588 - val_auc: 0.8401 - 2s/epoch - 3ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_88_0.png" src="_images/Colorretal_-_obito_geral_88_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 2s 2ms/step
250/250 [==============================] - 0s 2ms/step
Número de exemplos positivos do conjunto de teste = 4224
loss: 0.5077
accuracy: 0.7633
precision: 0.7865
recall: 0.7588
auc: 0.8401
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7724
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_91_0.png" src="_images/Colorretal_-_obito_geral_91_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7635341955675261
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_93_0.png" src="_images/Colorretal_-_obito_geral_93_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1"># custo_e_metricas_val = rna_reg.evaluate(X_val_norm, y_val)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 2ms/step - loss: 0.5117 - accuracy: 0.7564 - precision: 0.7817 - recall: 0.7492 - auc: 0.8366
250/250 [==============================] - 0s 2ms/step - loss: 0.5077 - accuracy: 0.7633 - precision: 0.7865 - recall: 0.7588 - auc: 0.8401
</pre></div></div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Residual">
<h3><strong>Criação e treinamento da RNA Residual</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Residual" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função que cria o bloco para a RN residual</span>
<span class="k">def</span> <span class="nf">bloco_residual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

    <span class="n">z1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n</span><span class="p">)(</span><span class="n">z1</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">Add</span><span class="p">()([</span><span class="n">x</span><span class="p">,</span> <span class="n">z2</span><span class="p">])</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="nb">sum</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a2</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definição da entrada</span>
<span class="n">input_shape</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>

<span class="n">X1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">input_features</span><span class="p">)</span>

<span class="n">X2</span> <span class="o">=</span> <span class="n">bloco_residual</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">X3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">X2</span><span class="p">)</span>

<span class="n">X4</span> <span class="o">=</span> <span class="n">bloco_residual</span><span class="p">(</span><span class="n">X3</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">X5</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">X4</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)(</span><span class="n">X5</span><span class="p">)</span>

<span class="c1"># Criação da RNA</span>
<span class="n">rna</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">input_features</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

<span class="c1"># Mostra resumo da RNA</span>
<span class="n">rna</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model_1&#34;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to
==================================================================================================
 input_1 (InputLayer)           [(None, 25)]         0           []

 dense_4 (Dense)                (None, 64)           1664        [&#39;input_1[0][0]&#39;]

 dense_5 (Dense)                (None, 64)           4160        [&#39;dense_4[0][0]&#39;]

 dense_6 (Dense)                (None, 64)           4160        [&#39;dense_5[0][0]&#39;]

 add (Add)                      (None, 64)           0           [&#39;dense_4[0][0]&#39;,
                                                                  &#39;dense_6[0][0]&#39;]

 activation (Activation)        (None, 64)           0           [&#39;add[0][0]&#39;]

 dense_7 (Dense)                (None, 64)           4160        [&#39;activation[0][0]&#39;]

 dense_8 (Dense)                (None, 64)           4160        [&#39;dense_7[0][0]&#39;]

 dense_9 (Dense)                (None, 64)           4160        [&#39;dense_8[0][0]&#39;]

 add_1 (Add)                    (None, 64)           0           [&#39;dense_7[0][0]&#39;,
                                                                  &#39;dense_9[0][0]&#39;]

 activation_1 (Activation)      (None, 64)           0           [&#39;add_1[0][0]&#39;]

 dense_10 (Dense)               (None, 16)           1040        [&#39;activation_1[0][0]&#39;]

 dense_11 (Dense)               (None, 1)            17          [&#39;dense_10[0][0]&#39;]

==================================================================================================
Total params: 23,521
Trainable params: 23,521
Non-trainable params: 0
__________________________________________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">rna</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_98_0.png" src="_images/Colorretal_-_obito_geral_98_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                        <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">rna</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
749/749 - 5s - loss: 0.5518 - accuracy: 0.7238 - precision: 0.7489 - recall: 0.7196 - auc: 0.7946 - val_loss: 0.5110 - val_accuracy: 0.7500 - val_precision: 0.7364 - val_recall: 0.8220 - val_auc: 0.8298 - 5s/epoch - 6ms/step
Epoch 2/50
749/749 - 4s - loss: 0.5166 - accuracy: 0.7464 - precision: 0.7704 - recall: 0.7421 - auc: 0.8235 - val_loss: 0.5102 - val_accuracy: 0.7468 - val_precision: 0.8176 - val_recall: 0.6716 - val_auc: 0.8377 - 4s/epoch - 5ms/step
Epoch 3/50
749/749 - 2s - loss: 0.5051 - accuracy: 0.7549 - precision: 0.7826 - recall: 0.7436 - auc: 0.8320 - val_loss: 0.4951 - val_accuracy: 0.7572 - val_precision: 0.7858 - val_recall: 0.7443 - val_auc: 0.8404 - 2s/epoch - 3ms/step
Epoch 4/50
749/749 - 2s - loss: 0.4983 - accuracy: 0.7574 - precision: 0.7899 - recall: 0.7383 - auc: 0.8370 - val_loss: 0.4935 - val_accuracy: 0.7617 - val_precision: 0.7896 - val_recall: 0.7498 - val_auc: 0.8407 - 2s/epoch - 3ms/step
Epoch 5/50
749/749 - 2s - loss: 0.4912 - accuracy: 0.7612 - precision: 0.7924 - recall: 0.7439 - auc: 0.8422 - val_loss: 0.4948 - val_accuracy: 0.7581 - val_precision: 0.7976 - val_recall: 0.7277 - val_auc: 0.8412 - 2s/epoch - 3ms/step
Epoch 6/50
749/749 - 2s - loss: 0.4859 - accuracy: 0.7639 - precision: 0.7968 - recall: 0.7437 - auc: 0.8457 - val_loss: 0.4937 - val_accuracy: 0.7610 - val_precision: 0.7878 - val_recall: 0.7507 - val_auc: 0.8406 - 2s/epoch - 3ms/step
Epoch 7/50
749/749 - 3s - loss: 0.4821 - accuracy: 0.7655 - precision: 0.7998 - recall: 0.7431 - auc: 0.8483 - val_loss: 0.4924 - val_accuracy: 0.7626 - val_precision: 0.7815 - val_recall: 0.7656 - val_auc: 0.8420 - 3s/epoch - 4ms/step
Epoch 8/50
749/749 - 3s - loss: 0.4776 - accuracy: 0.7684 - precision: 0.8011 - recall: 0.7483 - auc: 0.8513 - val_loss: 0.5026 - val_accuracy: 0.7576 - val_precision: 0.8101 - val_recall: 0.7081 - val_auc: 0.8419 - 3s/epoch - 4ms/step
Epoch 9/50
749/749 - 2s - loss: 0.4747 - accuracy: 0.7699 - precision: 0.8059 - recall: 0.7448 - auc: 0.8537 - val_loss: 0.4993 - val_accuracy: 0.7591 - val_precision: 0.7957 - val_recall: 0.7332 - val_auc: 0.8375 - 2s/epoch - 3ms/step
Epoch 10/50
749/749 - 2s - loss: 0.4672 - accuracy: 0.7745 - precision: 0.8088 - recall: 0.7518 - auc: 0.8582 - val_loss: 0.5007 - val_accuracy: 0.7597 - val_precision: 0.7948 - val_recall: 0.7363 - val_auc: 0.8377 - 2s/epoch - 3ms/step
Epoch 11/50
749/749 - 2s - loss: 0.4636 - accuracy: 0.7758 - precision: 0.8085 - recall: 0.7555 - auc: 0.8607 - val_loss: 0.5073 - val_accuracy: 0.7566 - val_precision: 0.7857 - val_recall: 0.7429 - val_auc: 0.8350 - 2s/epoch - 3ms/step
Epoch 12/50
749/749 - 2s - loss: 0.4585 - accuracy: 0.7801 - precision: 0.8138 - recall: 0.7581 - auc: 0.8641 - val_loss: 0.5086 - val_accuracy: 0.7551 - val_precision: 0.7890 - val_recall: 0.7337 - val_auc: 0.8346 - 2s/epoch - 3ms/step
Epoch 13/50
749/749 - 4s - loss: 0.4527 - accuracy: 0.7840 - precision: 0.8183 - recall: 0.7610 - auc: 0.8678 - val_loss: 0.5106 - val_accuracy: 0.7619 - val_precision: 0.7785 - val_recall: 0.7689 - val_auc: 0.8329 - 4s/epoch - 5ms/step
Epoch 14/50
749/749 - 3s - loss: 0.4483 - accuracy: 0.7871 - precision: 0.8227 - recall: 0.7620 - auc: 0.8705 - val_loss: 0.5221 - val_accuracy: 0.7496 - val_precision: 0.7986 - val_recall: 0.7048 - val_auc: 0.8310 - 3s/epoch - 3ms/step
Epoch 15/50
749/749 - 2s - loss: 0.4418 - accuracy: 0.7882 - precision: 0.8238 - recall: 0.7633 - auc: 0.8743 - val_loss: 0.5200 - val_accuracy: 0.7506 - val_precision: 0.7744 - val_recall: 0.7462 - val_auc: 0.8254 - 2s/epoch - 3ms/step
Epoch 16/50
749/749 - 2s - loss: 0.4359 - accuracy: 0.7955 - precision: 0.8301 - recall: 0.7718 - auc: 0.8785 - val_loss: 0.5270 - val_accuracy: 0.7501 - val_precision: 0.7745 - val_recall: 0.7448 - val_auc: 0.8279 - 2s/epoch - 3ms/step
Epoch 17/50
749/749 - 2s - loss: 0.4280 - accuracy: 0.7981 - precision: 0.8316 - recall: 0.7756 - auc: 0.8831 - val_loss: 0.5304 - val_accuracy: 0.7574 - val_precision: 0.7819 - val_recall: 0.7512 - val_auc: 0.8302 - 2s/epoch - 3ms/step
Epoch 18/50
749/749 - 3s - loss: 0.4210 - accuracy: 0.8020 - precision: 0.8345 - recall: 0.7808 - auc: 0.8872 - val_loss: 0.5472 - val_accuracy: 0.7468 - val_precision: 0.7709 - val_recall: 0.7424 - val_auc: 0.8201 - 3s/epoch - 4ms/step
Epoch 19/50
749/749 - 3s - loss: 0.4132 - accuracy: 0.8078 - precision: 0.8396 - recall: 0.7873 - auc: 0.8917 - val_loss: 0.5427 - val_accuracy: 0.7498 - val_precision: 0.7798 - val_recall: 0.7351 - val_auc: 0.8241 - 3s/epoch - 4ms/step
Epoch 20/50
749/749 - 2s - loss: 0.4067 - accuracy: 0.8098 - precision: 0.8411 - recall: 0.7900 - auc: 0.8947 - val_loss: 0.5607 - val_accuracy: 0.7458 - val_precision: 0.7827 - val_recall: 0.7197 - val_auc: 0.8184 - 2s/epoch - 3ms/step
Epoch 21/50
749/749 - 2s - loss: 0.3976 - accuracy: 0.8153 - precision: 0.8477 - recall: 0.7937 - auc: 0.8999 - val_loss: 0.5638 - val_accuracy: 0.7368 - val_precision: 0.7541 - val_recall: 0.7462 - val_auc: 0.8132 - 2s/epoch - 3ms/step
Epoch 22/50
749/749 - 2s - loss: 0.3921 - accuracy: 0.8176 - precision: 0.8502 - recall: 0.7958 - auc: 0.9030 - val_loss: 0.5656 - val_accuracy: 0.7368 - val_precision: 0.7695 - val_recall: 0.7178 - val_auc: 0.8100 - 2s/epoch - 3ms/step
Epoch 23/50
749/749 - 2s - loss: 0.3824 - accuracy: 0.8235 - precision: 0.8553 - recall: 0.8023 - auc: 0.9078 - val_loss: 0.5929 - val_accuracy: 0.7381 - val_precision: 0.7721 - val_recall: 0.7169 - val_auc: 0.8075 - 2s/epoch - 3ms/step
Epoch 24/50
749/749 - 4s - loss: 0.3792 - accuracy: 0.8264 - precision: 0.8593 - recall: 0.8037 - auc: 0.9094 - val_loss: 0.6017 - val_accuracy: 0.7323 - val_precision: 0.7592 - val_recall: 0.7240 - val_auc: 0.8014 - 4s/epoch - 5ms/step
Epoch 25/50
749/749 - 3s - loss: 0.3683 - accuracy: 0.8308 - precision: 0.8634 - recall: 0.8083 - auc: 0.9149 - val_loss: 0.6144 - val_accuracy: 0.7388 - val_precision: 0.7567 - val_recall: 0.7467 - val_auc: 0.8101 - 3s/epoch - 3ms/step
Epoch 26/50
749/749 - 2s - loss: 0.3630 - accuracy: 0.8337 - precision: 0.8622 - recall: 0.8164 - auc: 0.9172 - val_loss: 0.6191 - val_accuracy: 0.7320 - val_precision: 0.7589 - val_recall: 0.7237 - val_auc: 0.8027 - 2s/epoch - 3ms/step
Epoch 27/50
749/749 - 2s - loss: 0.3540 - accuracy: 0.8391 - precision: 0.8700 - recall: 0.8184 - auc: 0.9213 - val_loss: 0.6326 - val_accuracy: 0.7366 - val_precision: 0.7603 - val_recall: 0.7337 - val_auc: 0.8029 - 2s/epoch - 3ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_101_0.png" src="_images/Colorretal_-_obito_geral_101_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 1ms/step
250/250 [==============================] - 0s 2ms/step
Número de exemplos positivos do conjunto de teste = 4224
loss: 0.4924
accuracy: 0.7626
precision: 0.7815
recall: 0.7656
auc: 0.8420
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7735
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_104_0.png" src="_images/Colorretal_-_obito_geral_104_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.7624396637816244
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_106_0.png" src="_images/Colorretal_-_obito_geral_106_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 2s 3ms/step - loss: 0.4663 - accuracy: 0.7756 - precision: 0.7976 - recall: 0.7722 - auc: 0.8589
250/250 [==============================] - 0s 2ms/step - loss: 0.4924 - accuracy: 0.7626 - precision: 0.7815 - recall: 0.7656 - auc: 0.8420
</pre></div></div>
</div>
</section>
<section id="Criação-e-treinamento-da-RNA-Sequencial">
<h3><strong>Criação e treinamento da RNA Sequencial</strong><a class="headerlink" href="#Criação-e-treinamento-da-RNA-Sequencial" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">neg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="n">pos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exemplos:</span><span class="se">\n</span><span class="s1"> Total: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="se">\n</span><span class="s1"> Positivos: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">pos</span><span class="o">/</span><span class="n">total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">% do total)&#39;</span><span class="p">)</span>

<span class="c1"># Cálculo dos pesos das duas classe</span>
<span class="n">weight_for_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">neg</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">weight_for_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pos</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

<span class="c1"># Dicionário de pesos das classes para treinamento</span>
<span class="n">class_weight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">weight_for_0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">weight_for_1</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 0: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peso da classe 1: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_for_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Exemplos:
 Total: 23937
 Positivos: 12673 (52.94% do total)
Peso da classe 0: 1.06
Peso da classe 1: 0.94
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rna</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">))</span>
<span class="n">rna</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;sequential&#34;
_________________________________________________________________
 Layer (type)                Output Shape              Param #
=================================================================
 dense_12 (Dense)            (None, 128)               3328

 dense_13 (Dense)            (None, 128)               16512

 dense_14 (Dense)            (None, 32)                4128

 dense_15 (Dense)            (None, 1)                 33

=================================================================
Total params: 24,001
Trainable params: 24,001
Non-trainable params: 0
_________________________________________________________________
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">rna</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_111_0.png" src="_images/Colorretal_-_obito_geral_111_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define métricas</span>
<span class="n">METRICS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;precision&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">),</span>
           <span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;auc&#39;</span><span class="p">)]</span>

<span class="n">call_es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                        <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">rna</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">METRICS</span><span class="p">)</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                  <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                  <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                  <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">call_es</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/50
749/749 - 4s - loss: 0.5358 - accuracy: 0.7334 - precision: 0.7567 - recall: 0.7316 - auc: 0.8085 - val_loss: 0.5022 - val_accuracy: 0.7604 - val_precision: 0.7605 - val_recall: 0.7990 - val_auc: 0.8361 - 4s/epoch - 5ms/step
Epoch 2/50
749/749 - 2s - loss: 0.5106 - accuracy: 0.7494 - precision: 0.7735 - recall: 0.7449 - auc: 0.8279 - val_loss: 0.4973 - val_accuracy: 0.7580 - val_precision: 0.7962 - val_recall: 0.7296 - val_auc: 0.8401 - 2s/epoch - 3ms/step
Epoch 3/50
749/749 - 2s - loss: 0.5016 - accuracy: 0.7560 - precision: 0.7844 - recall: 0.7435 - auc: 0.8348 - val_loss: 0.4937 - val_accuracy: 0.7595 - val_precision: 0.7793 - val_recall: 0.7614 - val_auc: 0.8399 - 2s/epoch - 3ms/step
Epoch 4/50
749/749 - 2s - loss: 0.4953 - accuracy: 0.7574 - precision: 0.7859 - recall: 0.7447 - auc: 0.8393 - val_loss: 0.4940 - val_accuracy: 0.7597 - val_precision: 0.7998 - val_recall: 0.7285 - val_auc: 0.8422 - 2s/epoch - 3ms/step
Epoch 5/50
749/749 - 3s - loss: 0.4892 - accuracy: 0.7615 - precision: 0.7921 - recall: 0.7450 - auc: 0.8433 - val_loss: 0.4907 - val_accuracy: 0.7645 - val_precision: 0.7826 - val_recall: 0.7687 - val_auc: 0.8427 - 3s/epoch - 4ms/step
Epoch 6/50
749/749 - 2s - loss: 0.4854 - accuracy: 0.7643 - precision: 0.7932 - recall: 0.7503 - auc: 0.8461 - val_loss: 0.5065 - val_accuracy: 0.7544 - val_precision: 0.8227 - val_recall: 0.6832 - val_auc: 0.8422 - 2s/epoch - 3ms/step
Epoch 7/50
749/749 - 2s - loss: 0.4831 - accuracy: 0.7674 - precision: 0.7975 - recall: 0.7515 - auc: 0.8479 - val_loss: 0.4959 - val_accuracy: 0.7612 - val_precision: 0.8113 - val_recall: 0.7154 - val_auc: 0.8431 - 2s/epoch - 3ms/step
Epoch 8/50
749/749 - 2s - loss: 0.4758 - accuracy: 0.7693 - precision: 0.8033 - recall: 0.7472 - auc: 0.8524 - val_loss: 0.4903 - val_accuracy: 0.7612 - val_precision: 0.7918 - val_recall: 0.7448 - val_auc: 0.8435 - 2s/epoch - 3ms/step
Epoch 9/50
749/749 - 2s - loss: 0.4708 - accuracy: 0.7751 - precision: 0.8072 - recall: 0.7556 - auc: 0.8558 - val_loss: 0.4937 - val_accuracy: 0.7645 - val_precision: 0.7956 - val_recall: 0.7472 - val_auc: 0.8415 - 2s/epoch - 3ms/step
Epoch 10/50
749/749 - 2s - loss: 0.4659 - accuracy: 0.7767 - precision: 0.8094 - recall: 0.7565 - auc: 0.8595 - val_loss: 0.4994 - val_accuracy: 0.7621 - val_precision: 0.7642 - val_recall: 0.7964 - val_auc: 0.8395 - 2s/epoch - 3ms/step
Epoch 11/50
749/749 - 3s - loss: 0.4627 - accuracy: 0.7793 - precision: 0.8103 - recall: 0.7614 - auc: 0.8615 - val_loss: 0.4941 - val_accuracy: 0.7616 - val_precision: 0.7854 - val_recall: 0.7564 - val_auc: 0.8413 - 3s/epoch - 4ms/step
Epoch 12/50
749/749 - 3s - loss: 0.4562 - accuracy: 0.7824 - precision: 0.8136 - recall: 0.7641 - auc: 0.8654 - val_loss: 0.5038 - val_accuracy: 0.7531 - val_precision: 0.8036 - val_recall: 0.7062 - val_auc: 0.8383 - 3s/epoch - 3ms/step
Epoch 13/50
749/749 - 2s - loss: 0.4508 - accuracy: 0.7844 - precision: 0.8146 - recall: 0.7675 - auc: 0.8691 - val_loss: 0.5031 - val_accuracy: 0.7594 - val_precision: 0.7639 - val_recall: 0.7895 - val_auc: 0.8365 - 2s/epoch - 3ms/step
Epoch 14/50
749/749 - 2s - loss: 0.4457 - accuracy: 0.7884 - precision: 0.8184 - recall: 0.7714 - auc: 0.8720 - val_loss: 0.5099 - val_accuracy: 0.7572 - val_precision: 0.8112 - val_recall: 0.7057 - val_auc: 0.8397 - 2s/epoch - 3ms/step
Epoch 15/50
749/749 - 2s - loss: 0.4397 - accuracy: 0.7914 - precision: 0.8226 - recall: 0.7727 - auc: 0.8758 - val_loss: 0.5073 - val_accuracy: 0.7592 - val_precision: 0.7770 - val_recall: 0.7647 - val_auc: 0.8369 - 2s/epoch - 3ms/step
Epoch 16/50
749/749 - 2s - loss: 0.4338 - accuracy: 0.7949 - precision: 0.8250 - recall: 0.7776 - auc: 0.8795 - val_loss: 0.5237 - val_accuracy: 0.7554 - val_precision: 0.8028 - val_recall: 0.7131 - val_auc: 0.8353 - 2s/epoch - 3ms/step
Epoch 17/50
749/749 - 3s - loss: 0.4286 - accuracy: 0.7974 - precision: 0.8258 - recall: 0.7824 - auc: 0.8826 - val_loss: 0.5227 - val_accuracy: 0.7566 - val_precision: 0.7926 - val_recall: 0.7318 - val_auc: 0.8357 - 3s/epoch - 4ms/step
Epoch 18/50
749/749 - 3s - loss: 0.4235 - accuracy: 0.7997 - precision: 0.8306 - recall: 0.7810 - auc: 0.8855 - val_loss: 0.5222 - val_accuracy: 0.7532 - val_precision: 0.7732 - val_recall: 0.7554 - val_auc: 0.8308 - 3s/epoch - 4ms/step
Epoch 19/50
749/749 - 2s - loss: 0.4148 - accuracy: 0.8073 - precision: 0.8359 - recall: 0.7914 - auc: 0.8903 - val_loss: 0.5332 - val_accuracy: 0.7496 - val_precision: 0.7914 - val_recall: 0.7157 - val_auc: 0.8267 - 2s/epoch - 3ms/step
Epoch 20/50
749/749 - 2s - loss: 0.4109 - accuracy: 0.8069 - precision: 0.8370 - recall: 0.7888 - auc: 0.8927 - val_loss: 0.5356 - val_accuracy: 0.7523 - val_precision: 0.7814 - val_recall: 0.7389 - val_auc: 0.8301 - 2s/epoch - 3ms/step
Epoch 21/50
749/749 - 2s - loss: 0.4016 - accuracy: 0.8140 - precision: 0.8394 - recall: 0.8020 - auc: 0.8978 - val_loss: 0.5497 - val_accuracy: 0.7448 - val_precision: 0.7613 - val_recall: 0.7545 - val_auc: 0.8190 - 2s/epoch - 3ms/step
Epoch 22/50
749/749 - 2s - loss: 0.3946 - accuracy: 0.8147 - precision: 0.8422 - recall: 0.7999 - auc: 0.9015 - val_loss: 0.5507 - val_accuracy: 0.7491 - val_precision: 0.7634 - val_recall: 0.7623 - val_auc: 0.8172 - 2s/epoch - 3ms/step
Epoch 23/50
749/749 - 3s - loss: 0.3885 - accuracy: 0.8203 - precision: 0.8465 - recall: 0.8069 - auc: 0.9046 - val_loss: 0.5611 - val_accuracy: 0.7452 - val_precision: 0.7632 - val_recall: 0.7521 - val_auc: 0.8187 - 3s/epoch - 4ms/step
Epoch 24/50
749/749 - 3s - loss: 0.3811 - accuracy: 0.8240 - precision: 0.8535 - recall: 0.8060 - auc: 0.9084 - val_loss: 0.5730 - val_accuracy: 0.7359 - val_precision: 0.7877 - val_recall: 0.6861 - val_auc: 0.8117 - 3s/epoch - 4ms/step
Epoch 25/50
749/749 - 2s - loss: 0.3751 - accuracy: 0.8269 - precision: 0.8553 - recall: 0.8101 - auc: 0.9112 - val_loss: 0.5810 - val_accuracy: 0.7404 - val_precision: 0.7471 - val_recall: 0.7706 - val_auc: 0.8102 - 2s/epoch - 3ms/step
Epoch 26/50
749/749 - 2s - loss: 0.3678 - accuracy: 0.8304 - precision: 0.8562 - recall: 0.8168 - auc: 0.9152 - val_loss: 0.5891 - val_accuracy: 0.7411 - val_precision: 0.7795 - val_recall: 0.7124 - val_auc: 0.8153 - 2s/epoch - 3ms/step
Epoch 27/50
749/749 - 2s - loss: 0.3616 - accuracy: 0.8322 - precision: 0.8580 - recall: 0.8186 - auc: 0.9176 - val_loss: 0.6028 - val_accuracy: 0.7411 - val_precision: 0.7782 - val_recall: 0.7145 - val_auc: 0.8141 - 2s/epoch - 3ms/step
Epoch 28/50
749/749 - 2s - loss: 0.3541 - accuracy: 0.8377 - precision: 0.8633 - recall: 0.8240 - auc: 0.9216 - val_loss: 0.6265 - val_accuracy: 0.7387 - val_precision: 0.7814 - val_recall: 0.7031 - val_auc: 0.8125 - 2s/epoch - 2ms/step
</pre></div></div>
</div>
<p><strong>Resultados</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_114_0.png" src="_images/Colorretal_-_obito_geral_114_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de exemplos positivos do conjunto de teste =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 1ms/step
250/250 [==============================] - 0s 1ms/step
Número de exemplos positivos do conjunto de teste = 4224
loss: 0.4903
accuracy: 0.7612
precision: 0.7918
recall: 0.7448
auc: 0.8435
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pontuação F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pontuação F1 = 0.7676
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">),</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                                        <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_117_0.png" src="_images/Colorretal_-_obito_geral_117_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.762275993120284
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp_train</span><span class="p">,</span> <span class="n">tp_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_pred</span><span class="p">)</span>
<span class="n">fp_test</span><span class="p">,</span> <span class="n">tp_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_train</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_train</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados treinamento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">fp_test</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">tp_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dados teste&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Positivos falsos [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Positivos verdadeiros [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Colorretal_-_obito_geral_119_0.png" src="_images/Colorretal_-_obito_geral_119_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custo_e_metricas_train</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">custo_e_metricas_test</span> <span class="o">=</span> <span class="n">rna</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
749/749 [==============================] - 1s 2ms/step - loss: 0.4608 - accuracy: 0.7789 - precision: 0.8133 - recall: 0.7558 - auc: 0.8638
250/250 [==============================] - 0s 2ms/step - loss: 0.4903 - accuracy: 0.7612 - precision: 0.7918 - recall: 0.7448 - auc: 0.8435
</pre></div></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Colorretal%20-%20preprocessing.html" class="btn btn-neutral float-left" title="Leitura dos Dados" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Colorretal%20-%20obito_cancer.html" class="btn btn-neutral float-right" title="Introdução" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Lucas Buk Cardoso.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>